<script src="resources/node-red-contrib-home-assistant-websocket/select2.full.min.js?v=4.1.0-rc.0"></script><link rel="stylesheet" href="resources/node-red-contrib-home-assistant-websocket/select2.min.css?v=4.1.0-rc.0"><script src="resources/node-red-contrib-home-assistant-websocket/maximize-select2-height.min.js?v=1.0.4"></script><script type="text/javascript">!function(){"use strict";var e,t,n,a,i,o;!function(e){e.Is="is",e.IsNot="is_not",e.IsLessThan="lt",e.IsLessThanOrEqual="lte",e.IsGreaterThan="gt",e.IsGreaterThanOrEqual="gte",e.Includes="includes",e.DoesNotInclude="does_not_include",e.Contains="cont",e.StartsWith="starts_with",e.InGroup="in_group",e.JSONata="jsonata"}(e||(e={})),function(e){e.BinarySensor="binary_sensor",e.Button="button",e.Sensor="sensor",e.Switch="switch"}(t||(t={})),function(e){e.Exact="exact",e.List="list",e.Regex="regex",e.Substring="substring"}(n||(n={})),function(e){e.API="ha-api",e.CallSevice="api-call-service",e.CurrentState="api-current-state",e.Device="ha-device",e.Entity="ha-entity",e.EventsAll="server-events",e.EventsState="server-state-changed",e.FireEvent="ha-fire-event",e.GetEntities="ha-get-entities",e.GetHistory="api-get-history",e.PollState="poll-state",e.RenderTemplate="api-render-template",e.TriggerState="trigger-state",e.Tag="ha-tag",e.Time="ha-time",e.WaitUntil="ha-wait-until",e.Webhook="ha-webhook",e.Zone="ha-zone",e.Server="server",e.DeviceConfig="ha-device-config",e.EntityConfig="ha-entity-config",e.BinarySensor="ha-binary-sensor",e.Button="ha-button",e.Sensor="ha-sensor",e.Switch="ha-switch",e.UpdateConfig="ha-update-config"}(a||(a={})),function(e){e.Message="msg",e.Flow="flow",e.Global="global",e.Boolean="bool",e.JSON="json",e.Date="date",e.JSONata="jsonata",e.Number="num",e.String="str",e.None="none",e.Config="config",e.Data="data",e.Entity="entity",e.EntityState="entityState",e.EventData="eventData",e.Headers="headers",e.Params="params",e.TriggerId="triggerId",e.PrevEntity="prevEntity",e.Results="results",e.Regex="re"}(i||(i={})),function(e){e.Milliseconds="milliseconds",e.Seconds="seconds",e.Minutes="minutes",e.Hours="hours",e.Days="days"}(o||(o={}));const s=(e,t)=>{let n=RED._(`node-red-contrib-home-assistant-websocket/all:${e}`,t);return-1!==n.indexOf("\n")&&(n=n.split("\n").map((e=>`<p>${e}</p>`)).join("")),n};function r(e,t){if(e===t)return!0;if("object"!=typeof e||"object"!=typeof t||null==e||null==t)return!1;const n=Object.keys(e),a=Object.keys(t);if(n.length<a.length)return!1;for(const i of a){if(!n.includes(i))return!1;if(!r(e[i],t[i]))return!1}return!0}function l(e,t){return e.split(".").reduce(((e,t)=>e[t]),t)}function u(e){return e&&(e instanceof jQuery||e.constructor.prototype.jquery)}const p=e=>{const t=u(e)?e:$(e);t.on("select2:unselecting",(()=>{t.on("select2:opening",(e=>{e.preventDefault(),t.off("select2:opening")}))}))},d={},c={},v={},y={},g={};function h(e){return e.split("/")[2]}function m(e,t){const n=e.label,a=t.label;return n===a?0:n.localeCompare(a)}function f(e){var t;return null!==(t=d[e])&&void 0!==t?t:[]}function b(e){var t;return null!==(t=c[e])&&void 0!==t?t:[]}function _(e,t,n="."){return Object.keys(e).reduce(((a,i)=>{const o=e[i],s=[t,i].filter(Boolean).join(n);return["object"==typeof o,null!==o,!(o instanceof Date),!(o instanceof RegExp),!(Array.isArray(o)&&0===o.length)].every(Boolean)?Object.assign(Object.assign({},a),_(o,s,n)):Object.assign(Object.assign({},a),{[s]:o})}),{})}function T(e){function t(e){let t,n=1;return"string"==typeof e&&e.startsWith("-")?(n=-1,t=e.substring(1)):t=e,function(e,a){const i=e[t],o=a[t];return("string"==typeof i&&"string"==typeof o?i.localeCompare(o):e[t]<a[t]?-1:e[t]>a[t]?1:0)*n}}return function(n,a){let i=0,o=0;const s=null==e?void 0:e.length;for(;0===o&&i<s;)o=t(e[i])(n,a),i++;return o}}let w;const S={show:e=>{RED.view.state(RED.state.EDITING);const t={title:s("home-assistant.label.filter_results_title"),width:"inherit",buttons:[{id:"node-dialog-cancel",text:s("home-assistant.label.cancel"),click:()=>{RED.tray.close()}},{id:"node-dialog-ok",text:s("home-assistant.label.done"),class:"primary",click:()=>{e.complete(w),RED.tray.close()}}],open:t=>{const n=t.find(".red-ui-tray-body");RED.editor.buildEditForm(n,"dialog-form","ha_entity_filter","node-red-contrib-home-assistant-websocket/all"),t.i18n(),$("#dialog-form").addClass("home-assistant"),n.find("select").val(e.filterType),n.find("input").val(e.filter).on("input",(t=>{const a=((e,t,n)=>{let a;if("regex"===n)try{const n=new RegExp(t);a=e.filter((e=>n.test(e.entity_id)))}catch(e){a=[]}else"substring"===n&&(a=e.filter((e=>e.entity_id.includes(t))));return a.sort(T(["entity_id"]))})(e.entities,t.target.value,e.filterType);w=t.target.value,n.find("ul").html((e=>e.length?e.map((e=>`<li>${e.entity_id}</li>`)).join(""):`<li>${s("home-assistant.label.no_matches_found")}</li>`)(a))})).trigger("input")}};RED.tray.show(t)}};let D;const I={};function j(){let e=$("#node-input-server").val();if(function(){const e=[a.Button,a.BinarySensor,a.Sensor,a.Switch];return(null==D?void 0:D.type)&&e.includes(D.type)}()){const t=RED.nodes.node($("#node-input-entityConfig").val());e=null==t?void 0:t.server}if(e&&"_ADD_"!==e)return e}function E(){const e=j();return!(!e||!I[e]||"0"===I[e])}function O(e){D=e,function(){switch(D.type){case a.Webhook:case a.Entity:C();break;case a.BinarySensor:case a.Sensor:case a.Switch:"_ADD_"!==$("#node-input-entityConfig").val()&&C("1.1.0");break;case a.Button:"_ADD_"!==$("#node-input-entityConfig").val()&&C("1.0.4");break;default:!function(){const e=$("<div />",{id:"exposeToHa",class:"form-row checkbox-option"+("trigger-state"===D.type?"-left":"")});$("<input />",{type:"checkbox",id:"node-input-exposeToHomeAssistant",checked:D.exposeToHomeAssistant}).on("change",(function(){$("#haConfigRow").toggle(!0===$("#node-input-exposeToHomeAssistant").is(":checked"))})).appendTo(e),$("<label />",{for:"node-input-exposeToHomeAssistant",text:"Expose to Home Assistant"}).appendTo(e);const t=$("<div />",{class:"form-row",id:"haConfigRow"}),n=$("<ol />",{id:"haConfig"}).appendTo(t),a=D.haConfig||[{property:"name",value:""},{property:"icon",value:""}];n.editableList({addButton:!1,header:$("<div>Home Assistant Config (optional)</div>"),addItem:function(e,t,n){const a=$("<div />").appendTo(e),i=$("<label>").appendTo(a);$("<span>").text(n.property.replace(/_/g," ")).appendTo(i),$("<input />",{type:"hidden",name:"property",value:n.property}).appendTo(i),$("<input />",{type:"text",name:"value",value:n.value}).attr("autocomplete","disable").appendTo(i)}}).editableList("addItems",a),$("#dialog-form").append(e).append(t),$("#node-input-exposeToHomeAssistant").trigger("change")}()}}(),$("#node-input-server, #node-input-entityConfig").on("change",(()=>{switch(D.type){case a.Webhook:case a.Entity:C();break;case a.BinarySensor:case a.Sensor:case a.Switch:"_ADD_"!==$("#node-input-entityConfig").val()&&C("1.1.0");break;case a.Button:"_ADD_"!==$("#node-input-entityConfig").val()&&C("1.0.4");break;case a.Device:C("0.5.0");break;default:!function(){E()||$("#node-input-exposeToHomeAssistant").prop("checked",!1).trigger("change");$("#exposeToHa").toggle(E())}()}}))}function x(){const e=[];return $("#haConfig").editableList("items").each((function(){const t=$(this);e.push({property:t.find("input[name=property]").val(),value:t.find("input[name=value]").val()})})),e}function C(e){const t=void 0===e||(n=e,a=function(){const e=j();return e&&I&&I[e]&&"0"!==I[e]?I[e]:"0"}(),(n=n.split(".").map((e=>e.padStart(5))).join("."))<=a.split(".").map((e=>e.padStart(5))).join("."));var n,a;const i=E()&&t;if(!$("#integrationAlert").length){const n=`\n            <div id="integrationAlert" class="ui-state-error ha-alert-box">\n                <strong>Attention:</strong> \n                This node requires <a href="https://github.com/zachowj/hass-node-red" target="_blank">Node-RED custom integration ${t?"":`version ${e}+`} <i class="fa fa-external-link external-link"></i></a> to be installed in Home Assistant for it to function.\n            </div>`;$("#dialog-form").prepend(n)}$("#integrationAlert").toggle(!i)}var k=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>{const t=Object.assign(Object.assign({},e),{version:1,outputProperties:[],location:void 0,locationType:void 0});return"none"!==e.locationType&&(t.outputProperties=[{property:e.location,propertyType:e.locationType,value:"",valueType:"results"}]),t}}],R=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})}],L=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>{const t=Object.assign(Object.assign({},e),{version:1});try{const n=JSON.parse(e.data);n.entity_id?(t.entityId=n.entity_id,delete n.entity_id,t.data=Object.keys(n).length?JSON.stringify(n):""):t.entityId=""}catch(e){}return t}},{version:2,up:e=>{const t=Object.assign(Object.assign({},e),{version:2,outputProperties:[]});return"none"!==e.output_location_type&&(t.outputProperties=[{property:e.output_location,propertyType:e.output_location_type,value:"",valueType:"data"}]),t}},{version:3,up:e=>Object.assign(Object.assign({},e),{version:3,queue:"none"})},{version:4,up:e=>Object.assign(Object.assign({},e),{version:4,target:{entityId:(null==e?void 0:e.entityId)?e.entityId.split(",").map((e=>e.trim())):[],areaId:[],deviceId:[]},domain:e.service_domain,mergeContext:e.mergecontext,entityId:void 0,service_domain:void 0,mergecontext:void 0})},{version:5,up:e=>{var t,n,a;return Object.assign(Object.assign({},e),{version:5,areaId:null===(t=e.target)||void 0===t?void 0:t.areaId,deviceId:null===(n=e.target)||void 0===n?void 0:n.deviceId,entityId:null===(a=e.target)||void 0===a?void 0:a.entityId,target:void 0})}}],A=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,ha_boolean:e.ha_boolean||"y|yes|true|on|home|open",rejectUnauthorizedCerts:void 0===e.rejectUnauthorizedCerts||e.rejectUnauthorizedCerts,connectionDelay:void 0===e.connectionDelay||e.connectionDelay,cacheJson:void 0===e.cacheJson||e.cacheJson})},{version:2,up:e=>Object.assign(Object.assign({},e),{version:2,heartbeat:!1,heartbeatInterval:30})},{version:3,up:e=>Object.assign(Object.assign({},e),{version:3,areaSelector:"friendlyName",deviceSelector:"friendlyName",entitySelector:"friendlyName"})},{version:4,up:e=>Object.assign(Object.assign({},e),{version:4,statusSeparator:"at: ",statusYear:"hidden",statusMonth:"short",statusDay:"numeric",statusHourCycle:"h23",statusTimeFormat:"h:m"})},{version:5,up:e=>Object.assign(Object.assign({},e),{version:5,enableGlobalContextStore:!0})}],P=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,blockInputOverrides:!1,entity_location:"data",halt_if_compare:"is",override_payload:!1===e.override_payload?"none":"msg",override_data:!1===e.override_data?"none":"msg",state_location:"payload",state_type:"str"})},{version:2,up:e=>{const t=Object.assign(Object.assign({},e),{version:2,outputProperties:[],state_location:void 0,override_payload:void 0,entity_location:void 0,override_data:void 0,override_topic:void 0});return"none"!==e.override_payload&&t.outputProperties.push({property:e.state_location,propertyType:e.override_payload,value:"",valueType:"entityState"}),"none"!==e.override_data&&t.outputProperties.push({property:e.entity_location,propertyType:e.override_data,value:"",valueType:"entity"}),!0===e.override_topic&&t.outputProperties.push({property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}),t}},{version:3,up:e=>Object.assign(Object.assign({},e),{version:3,for:0,forType:"num",forUnits:"minutes"})}],H=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})}],N=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})}],B=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,inputOverride:"allow"})},{version:2,up:e=>{const t=Object.assign(Object.assign({},e),{version:2});return t.config.push({property:"state_class",value:""}),t.config.push({property:"last_reset",value:""}),t}},{version:3,up:e=>Object.assign(Object.assign({},e),{version:3})}],V=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1})},{version:2,up:e=>Object.assign(Object.assign({},e),{version:2})},{version:3,up:e=>Object.assign(Object.assign({},e),{version:3})},{version:4,up:e=>Object.assign(Object.assign({},e),{version:4})},{version:5,up:e=>Object.assign(Object.assign({},e),{version:5})},{version:6,up:e=>Object.assign(Object.assign({},e),{version:6})}],F=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0,waitForRunning:void 0===e.waitForRunning||e.waitForRunning})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,outputProperties:[{property:"payload",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:'$outputData("eventData").event_type',valueType:"jsonata"},{property:"event_type",propertyType:"msg",value:'$outputData("eventData").event_type',valueType:"jsonata"}]})},{version:2,up:e=>Object.assign(Object.assign({},e),{version:2,eventType:e.event_type,event_type:void 0})}],M=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0,state_type:void 0!==e.state_type?e.state_type:"str",halt_if_type:void 0!==e.halt_if_type?e.halt_if_type:"str",halt_if_compare:void 0!==e.halt_if_compare?e.halt_if_compare:"is"})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,ignorePrevStateNull:!1,ignorePrevStateUnknown:!1,ignorePrevStateUnavailable:!1,ignoreCurrentStateUnknown:!1,ignoreCurrentStateUnavailable:!1})},{version:2,up:e=>Object.assign(Object.assign({},e),{version:2,for:void 0!==e.for?e.for:"0",forType:e.forType||"num",forUnits:e.forUnits||"minutes"})},{version:3,up:e=>Object.assign(Object.assign({},e),{version:3,outputProperties:[{property:"payload",propertyType:"msg",value:"",valueType:"entityState"},{property:"data",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}]})},{version:4,up:e=>{var t;const n=Object.assign(Object.assign({},e),{version:4});return"substring"===e.entityidfiltertype&&(null===(t=e.entityidfilter)||void 0===t?void 0:t.includes(","))&&(n.entityidfiltertype="list",n.entityidfilter=e.entityidfilter.split(",").map((e=>e.trim())).filter((e=>e.length>0))),n}}],U=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})}],q=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})}],z=[{version:0,up:e=>{const t=Object.assign(Object.assign({},e),{version:0,output_type:void 0===e.output_type?"array":e.output_type});return void 0===t.output_location&&(t.output_location="payload",t.output_location_type="msg"),t}}],G=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,state_type:"str",halt_if_type:"str",halt_if_compare:"is",updateIntervalUnits:"seconds"})},{version:2,up:e=>Object.assign(Object.assign({},e),{version:2,updateIntervalType:"num"})}],W=[{version:0,up:e=>{const t=Object.assign(Object.assign({},e),{version:0});return void 0===t.templateLocationType&&(t.templateLocation="template",t.templateLocationType="msg"),void 0===t.resultsLocationType&&(t.resultsLocation="payload",t.resultsLocationType="msg"),t}}],J=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})}],K=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})}],X=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,outputProperties:[{property:"payload",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}]})}],Z=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,sunday:!0,monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!0})},{version:2,up:e=>{const t="jsonata"===e.payloadType&&"$entity().state"===e.payload;return Object.assign(Object.assign({},e),{version:2,outputProperties:[{property:"payload",propertyType:"msg",value:t?"":e.payload,valueType:t?"entityState":e.payloadType},{property:"data",propertyType:"msg",value:"",valueType:"entity"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}],payload:void 0,payloadType:void 0})}}],Y=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,inputs:1,enableInput:!0})},{version:2,up:e=>{var t;const n=Object.assign(Object.assign({},e),{version:2});return"substring"===e.entityidfiltertype&&(null===(t=e.entityid)||void 0===t?void 0:t.includes(","))&&(n.entityidfiltertype="list",n.entityid=e.entityid.split(",").map((e=>e.trim())).filter((e=>e.length>0))),n}}],Q=[{version:0,up:e=>{const t=Object.assign(Object.assign({},e),{version:0,entityIdFilterType:e.entityIdFilterType||"exact",timeoutType:e.timeoutType||"num"});return void 0===t.blockInputOverrides&&(t.blockInputOverrides=!0),void 0===t.checkCurrentState&&(t.checkCurrentState=!1),t}},{version:1,up:e=>{var t;const n=Object.assign(Object.assign({},e),{version:1});return"substring"===e.entityIdFilterType&&(null===(t=e.entityId)||void 0===t?void 0:t.includes(","))&&(n.entityIdFilterType="list",n.entityId=e.entityId.split(",").map((e=>e.trim())).filter((e=>e.length>0))),n}},{version:2,up:e=>{const t=Object.assign(Object.assign({},e),{version:2,outputProperties:[],entityLocation:void 0,entityLocationType:void 0});return"none"!==e.entityLocationType&&t.outputProperties.push({property:e.entityLocation,propertyType:e.entityLocationType,value:"",valueType:i.Entity}),t}}],ee=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>{const t=Object.assign(Object.assign({},e),{version:1,outputProperties:[{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}],payloadLocation:void 0,payloadLocationType:void 0,headersLocation:void 0,headersLocationType:void 0});return"none"!==e.payloadLocationType&&t.outputProperties.push({property:e.payloadLocation,propertyType:e.payloadLocationType,value:"",valueType:"data"}),"none"!==e.headersLocationType&&t.outputProperties.push({property:e.headersLocation,propertyType:e.headersLocationType,value:"",valueType:"headers"}),t}}],te=[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})}];const ne={[a.API]:k,[a.BinarySensor]:R,[a.CallSevice]:L,[a.Server]:A,[a.CurrentState]:P,[a.Device]:H,[a.DeviceConfig]:N,[a.Entity]:B,[a.EntityConfig]:V,[a.EventsAll]:F,[a.EventsState]:M,[a.FireEvent]:U,[a.GetEntities]:q,[a.GetHistory]:z,[a.PollState]:G,[a.RenderTemplate]:W,[a.Sensor]:J,[a.Switch]:K,[a.TriggerState]:Y,[a.Tag]:X,[a.Time]:Z,[a.WaitUntil]:Q,[a.Webhook]:ee,[a.Zone]:te};function ae(e){var t;const n=function(e){var t;const n=null!==(t=ie(e))&&void 0!==t?t:[];return n.reduce(((e,t)=>t.version>e?t.version:e),0)}(e.type);if(void 0!==e.version&&e.version>=n)return e;const a=null===(t=function(e,t=-1){const n=ie(e);return null==n?void 0:n.find((e=>e.version===Number(t)+1))}(e.type,e.version))||void 0===t?void 0:t.up;if(a){return ae(a(e))}return e}function ie(e){return ne[e]}const oe=e=>{const n={source:RED.nodes.getNodeLinks(e.id),target:RED.nodes.getNodeLinks(e.id,1)},i=(()=>{let e;do{e=RED.nodes.id()}while(RED.nodes.node(e));return e})();if(e.g){const t=RED.nodes.node(e.id);t&&RED.group.removeFromGroup(RED.nodes.group(e.g),t)}RED.nodes.remove(e.id),(e=>{var t,n;RED.nodes.import({type:a.EntityConfig,id:e.id,server:e.server,deviceConfig:"",name:`${e.entityType.replace("_"," ")} config for ${e.name||e.id}`,version:RED.settings.get("haEntityConfigVersion",0),entityType:e.entityType,haConfig:null!==(t=e.config)&&void 0!==t?t:[],resend:null!==(n=e.resend)&&void 0!==n&&n})})(e),((e,n)=>{var i,o,s,r,l;let u={id:n,name:e.name,inputs:1,outputs:1,version:0,g:e.g,x:e.x,y:e.y,z:e.z,entityConfig:e.id};switch(e.entityType){case t.BinarySensor:case t.Sensor:u=Object.assign(Object.assign({},u),{type:e.entityType===t.Sensor?a.Sensor:a.BinarySensor,state:null!==(i=e.state)&&void 0!==i?i:"payload",stateType:null!==(o=e.stateType)&&void 0!==o?o:"msg",attributes:null!==(s=e.attributes)&&void 0!==s?s:[],inputOverride:null!==(r=e.inputOverride)&&void 0!==r?r:"allow",outputProperties:"none"===e.outputLocationType?[]:[{property:e.outputLocation,propertyType:e.outputLocationType,value:"",valueType:"data"}]});break;case t.Switch:default:u=Object.assign(Object.assign({},u),{type:a.Switch,outputs:2,outputOnStateChange:null!==(l=e.outputOnStateChange)&&void 0!==l&&l,enableInput:!0,outputProperties:"none"===e.outputPayloadType?[]:[{property:"payload",propertyType:"msg",value:e.outputPayload,valueType:e.outputPayloadType}]})}RED.nodes.import(u)})(e,i),((e,t)=>{let n;for(n in t)t[n].forEach((t=>{RED.nodes.addLink(Object.assign(Object.assign({},t),{[n]:RED.nodes.node(e)}))}))})(i,n);const o=RED.nodes.node(i);o&&(RED.nodes.moveNodeToTab(o,e.z),e.g&&RED.group.addToGroup(RED.nodes.group(e.g),o),o.changed=!0),RED.view.redraw(!0)};let se;function re(e){const t=ae(RED.nodes.convertNode(e,!1));let n;for(n in t.type===a.Entity&&oe(t),t)void 0===t[n]?delete e[n]:e[n]=t[n];e.changed=!0,RED.editor.updateNodeProperties(e);const i=$("#upgrade-ha-node");i.is(":visible")&&0===ce()&&i.hide()}function le(){const e="home-assistant.ui.migrations",t=s(`${e}.button_ok`),n=s(`${e}.button_cancel`);$("#ha-dialog-confirm").dialog({resizable:!1,height:"auto",width:400,modal:!0,buttons:{[t]:function(){$(this).dialog("close"),function(){const e=[],t=t=>{pe(t)&&!ue(t)&&e.push(t)};RED.nodes.eachNode(t),RED.nodes.eachConfig(t),e.forEach((e=>re(e))),RED.nodes.dirty(!0),RED.notify(s("home-assistant.ui.migrations.all_nodes_updated")),RED.view.redraw()}()},[n]:function(){$(this).dialog("close")}}})}function ue(e){const t=RED.settings.get(`${e.type.split("-").reduce(((e,t,n)=>e.concat(`${n?t[0].toUpperCase():t[0]}${t.slice(1)}`)),[]).join("")}Version`,-1);const n=de(e)&&void 0===e.version?e._def.defaults.version.value:e.version;return void 0!==n&&n>=t}function pe(e){const t=RED.nodes.registry.getNodeSetForType(e.type);return"node-red-contrib-home-assistant-websocket"===(null==t?void 0:t.module)}function de(e){return(null==e?void 0:e.type)&&[a.Server,a.EntityConfig,a.DeviceConfig].includes(e.type)}function ce(){let e=0;const t=t=>{pe(t)&&!ue(t)&&e++};return RED.nodes.eachNode(t),RED.nodes.eachConfig(t),e}const ve="#custom-outputs";let ye,ge=[];const he={config:{value:"config",label:"config.",hasValue:!0},deviceId:{value:"triggerId",label:"device id",hasValue:!1},entity:{value:"entity",label:"entity",hasValue:!1},entityId:{value:"triggerId",label:"entity id",hasValue:!1},entityState:{value:"entityState",label:"entity state",hasValue:!1},eventData:{value:"eventData",label:"event data",hasValue:!1},headers:{value:"headers",label:"headers",hasValue:!1},params:{value:"params",label:"params",hasValue:!1},prevEntity:{value:"prevEntity",label:"previous entity",hasValue:!1},results:{value:"results",label:"results",hasValue:!1},receivedData:{value:"data",label:"received data",hasValue:!1},sentData:{value:"data",label:"sent data",hasValue:!1},tagId:{value:"triggerId",label:"tag id",hasValue:!1},timeSinceChangedMs:{value:"timeSinceChangedMs",label:"timeSinceChangedMs",hasValue:!1},triggerId:{value:"triggerId",label:"trigger id",hasValue:!1}},me=[he.config,"flow","global","str","num","bool","date","jsonata"];function fe(e=[],{element:t="#custom-outputs",extraTypes:n=[]}={}){ye=$(t),ge=n,ye.editableList({addButton:!0,removable:!0,sortable:!0,height:"auto",header:$("<div>").append(s("home-assistant.label.output_properties")),addItem:function(e,t,n){e.css({overflow:"hidden",whiteSpace:"nowrap"});const a=$("<div />").appendTo(e),i=$("<input/>",{class:"property-name",type:"text"}).css("width","30%").appendTo(a).typedInput({types:["msg","flow","global"]});$("<div/>",{style:"display:inline-block; padding:0px 6px;"}).text("=").appendTo(a);const o=$("<input/>",{class:"property-value",type:"text"}).css("width","calc(70% - 30px)").appendTo(a).typedInput({default:"str",types:be()});n.property&&i.typedInput("value",n.property),n.propertyType&&i.typedInput("type",n.propertyType),n.value&&o.typedInput("value",n.value),n.valueType&&o.typedInput("type",n.valueType)}}),ye.editableList("addItems",e)}function be(){let e=ge.reduce(((e,t)=>t in he?[...e,he[t]]:e),[]);if(e=[...e,...me],ge.includes("msg")){const t=e.indexOf("flow");e.splice(t,0,"msg")}return e}function $e(){const e=$(ve).editableList("items"),t=[];return e.each((function(){const e=$(this).find(".property-name"),n=$(this).find(".property-value"),a=e.typedInput("value"),i=e.typedInput("type"),o=n.typedInput("value"),s=n.typedInput("type");t.push({property:a,propertyType:i,value:o,valueType:s})})),t}function _e(e){return void 0===e||Array.isArray(e)&&!e.some((e=>0===e.property.length))}var Te,we;!function(e){e.Config="config",e.HomeAssistant="home_assistant",e.HomeAssistantDeprecated="home_assistant_deprecated",e.HomeAssistantEntities="home_assistant_entities"}(Te||(Te={})),function(e){e.Action="#46B1EF",e.Alpha="#E78BB9",e.Api="#7CDFFD",e.Beta="#77DD77",e.Data="#5BCBF7",e.Deprecated="#A6BBCF",e.Event="#399CDF",e.HaBlue="#41BDF5"}(we||(we={}));var Se={alphaWarning:e=>$.parseHTML(`\n            <div class="ui-state-error ha-alpha-box">\n                Alpha version: At this point anything could change or not work.\n                <br />\n                Found an issue? Post it in\n                <a\n                    href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/issues"\n                    target="_blank"\n                    rel="noreferrer"\n                >\n                    issues\n                </a>\n                . Have questions or comments? Post them\n                <a\n                    href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/discussions/${e}"\n                    target="_blank"\n                    rel="noreferrer"\n                >\n                    here\n                </a>\n                .\n            </div>\n        `),betaWarning:e=>$.parseHTML(`\n            <div class="ui-state-error ha-beta-box">\n                Beta version: Config should be stable and hopefully not too many bugs.\n                <br />\n                Found an issue? Post it in\n                <a\n                    href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/issues"\n                    target="_blank"\n                    rel="noreferrer"\n                >\n                    issues\n                </a>\n                . Have questions or comments? Post them\n                <a\n                    href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/discussions/${e}"\n                    target="_blank"\n                    rel="noreferrer"\n                >\n                    here\n                </a>\n                .\n            </div>\n        `),labelStyle:function(){const e=[];return ue(this)||e.push("ha-node-label-legacy"),this.name&&e.push("node_label_italic"),e.join(" ")},setup:e=>{$("#dialog-form, #node-config-dialog-edit-form").addClass("home-assistant"),function(e){pe(e)&&!ue(e)&&(de(e)||RED.events.on("editor:close",(function t(){RED.events.off("editor:close",t),RED.editor.edit(e)})),re(e),RED.nodes.dirty(!0),RED.tray.close(),RED.notify(s("home-assistant.ui.migrations.node_schema_updated")))}(e)}};let De,Ie,je,Ee=!1;function Oe(e,t,n){De=$(t),je=e,je.server||function(){let e;RED.nodes.eachConfig((t=>(t.type!==a.Server||e||(e=t.id),!0))),e&&De.val(e)}(),Ie=De.val(),setTimeout((()=>{De.on("change",(()=>{Ie=De.val(),null==n||n(Ie)}))}),500)}function xe(){return Ie}function Ce(e,t){let n=De.val();(je.server||n&&"_ADD_"!==n)&&(Ie=je.server||n,ke(e,t)),De.on("change",(()=>{Ie=De.val(),Ie!==n&&(n=Ie,ke(e,t))}))}function ke(e,t){"_ADD_"!==Ie&&$.getJSON(`homeassistant/${e}/${Ie}`).done((e=>{t(e)})).fail((e=>{503===e.status&&!1===Ee&&(Ee=!0,RED.notify(je._("config-server.errors.server_deploy")),setTimeout((()=>Ee=!1),2e3))}))}function Re(e,t,{params:n={}}){let a=`homeassistant/${t}/${De.val()}`;$.isEmptyObject(n)||(a+=`?${$.param(n)}`),$.getJSON(a).done((t=>{e(t)}))}function Le(e,t={}){let n=`homeassistant/${e}/${De.val()}`;return $.isEmptyObject(t)||(n+=`?${$.param(t)}`),new Promise(((e,t)=>{$.getJSON(n).done((t=>e(t))).fail((e=>t(e)))}))}const Ae=e=>function(e,t){const n=f(e);if(t&&(null==n?void 0:n.length)){const e=n.find((e=>e.area_id===t));if(e)return e.name}return s("ha-device.ui.no_area")}(Ie,e),Pe=()=>Object.values(function(e){var t;return null!==(t=v[e])&&void 0!==t?t:{}}(Ie)),He=()=>function(e){var t;return null!==(t=y[e])&&void 0!==t?t:{}}(Ie),Ne=()=>function(e){var t;return null!==(t=g[e])&&void 0!==t?t:{areas:{},devices:{}}}(Ie),Be=()=>{const e=RED.nodes.node(Ie);return{areaSelector:null==e?void 0:e.areaSelector,deviceSelector:null==e?void 0:e.deviceSelector,entitySelector:null==e?void 0:e.entitySelector,status:{separator:null==e?void 0:e.statusSeparator,year:null==e?void 0:e.statusYear,month:null==e?void 0:e.statusMonth,day:null==e?void 0:e.statusDay,hourCycle:null==e?void 0:e.statusHourCycle,timeFormat:null==e?void 0:e.statusTimeFormat}}},Ve={category:Te.HomeAssistant,color:we.HaBlue,inputs:1,outputs:1,icon:"font-awesome/fa-paper-plane-o",paletteLabel:"API",label:function(){return this.name||"API"},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("haApiVersion",0)},debugenabled:{value:!1},protocol:{value:"websocket"},method:{value:"get"},path:{value:""},data:{value:""},dataType:{value:"jsonata"},responseType:{value:"json"},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"results"}],validate:_e},location:{value:void 0},locationType:{value:void 0}},oneditprepare:function(){Se.setup(this),Oe(this,"#node-input-server"),$("#node-input-data").on("change",(function(){const e=$(this);0===e.val().length&&e.next().removeClass("input-error")})).typedInput({types:["jsonata","json"],typeField:"#node-input-dataType"}),$("#node-input-protocol").on("change",(function(){const e="http"===$(this).val();$(".http").toggle(e),$("#node-input-method").trigger("change")})).trigger("change"),$("#node-input-method").on("change",(function(){const e="http"===$("#node-input-protocol").val()&&"get"===$("#node-input-method").val()?"Params":"Data";$("#data-label").text(e)})),$("#node-input-location").typedInput({types:["msg","flow","global",{value:"none",label:"None",hasValue:!1}],typeField:"#node-input-locationType"}),fe(this.outputProperties,{extraTypes:["results"]})},oneditsave:function(){this.outputProperties=$e()}},Fe={apparent_power:["VA"],aqi:null,battery:["%"],carbon_dioxide:["ppm"],carbon_monoxide:["ppm"],current:["A"],date:null,distance:["km","m","cm","mm","mi","yd","in"],duration:["d","h","min","s"],energy:["Wh","kWh","MWh","GJ"],frequency:["Hz","kHz","MHz","GHz"],gas:["m³","ft³"],humidity:["%"],illuminance:["lx","lm"],moisture:["%"],monetary:["AED","AFN","ALL","AMD","ANG","AOA","ARS","AUD","AWG","AZN","BAM","BBD","BDT","BGN","BHD","BIF","BMD","BND","BOB","BOV","BRL","BSD","BTN","BWP","BYN","BZD","CAD","CDF","CHE","CHF","CHW","CLF","CLP","COP","COU","CRC","CUC","CUP","CVE","CZK","DJF","DKK","DOP","DZD","EGP","ERN","ETB","EUR","FJD","FKP","GBP","GEL","GHS","GIP","GMD","GNF","GTQ","GYD","HKD","HNL","HRK","HTG","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KGS","KHR","KMF","KPW","KRW","KWD","KYD","KZT","LAK","LBP","LKR","LRD","LSL","LYD","MAD","MDL","MGA","MKD","MMK","MNT","MOP","MRU","MUR","MVR","MWK","MXN","MXV","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PGK","PHP","PKR","PLN","PYG","QAR","RON","RSD","CNY","RUB","RWF","SAR","SBD","SCR","SDG","SEK","SGD","SHP","SLL","SOS","SRD","SSP","STN","SVC","SYP","SZL","THB","TJS","TMT","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","USN","UYI","UYU","UYW","UZS","VED","VES","VND","VUV","WST","XAF","XAG","XAU","XBA","XBB","XBC","XBD","XCD","XDR","XOF","XPD","XPF","XPT","XSU","XTS","XUA","XXX","YER","ZAR","ZMW","ZWL"],nitrogen_dioxide:["µg/m³"],nitrogen_monoxide:["µg/m³"],nitrous_oxide:["µg/m³"],ozone:["µg/m³"],pm1:["µg/m³"],pm25:["µg/m³"],pm10:["µg/m³"],power:["W","kW"],power_factor:["%"],pressure:["cbar","bar","hPa","inHg","kPa","mbar","Pa","psi"],reactive_power:["var"],signal_strength:["dB","dBm"],speed:["ft/s","in/d","in/h","km/h","kn","m/s","mm/d","mph"],sulphur_dioxide:["µg/m³"],temperature:["°C","°F"],timestamp:null,volatile_organic_compounds:["µg/m³"],voltage:["V"],volume:["fl. oz.","ft³","gal","L","mL","m³"],water:["L","gal","m³","ft³"],weight:["g","kg","lb","mg","oz","µg"],wind_speed:["ft/s","km/h","kn","m/s","mph"]};var Me=[{id:"device_class",type:"select",values:["","apparent_power","aqi","battery","carbon_dioxide","carbon_monoxide","current","date","distance","duration","energy","frequency","gas","humidity","illuminance","moisture","monetary","nitrogen_dioxide","nitrogen_monoxide","nitrous_oxide","ozone","pm1","pm25","pm10","power","power_factor","pressure","reactive_power","signal_strength","speed","sulphur_dioxide","temperature","timestamp","volatile_organic_compounds","voltage","volume","water","weight","wind_speed"]},{id:"unit_of_measurement",type:"sensor_uom"},{id:"state_class",type:"select",values:["","measurement","total","total_increasing"]},{id:"last_reset",type:"datetime"}];const Ue="node-red-contrib-home-assistant-websocket/all:",qe=(e,t,n)=>$("<input />",{type:"text",name:"value",value:t,id:e,"data-property":n.id}).attr("autocomplete","off"),ze=(e,t)=>{const n=`ha-config-${t.id}`,a=$("<div />",{class:"form-row ha-config-row","data-type":t.type});switch($("<label>",{for:n}).text(RED._(`${Ue}ha-entity-config.label.${t.id}`)).appendTo(a),a.append(" "),t.type){case"date":a.append(((e,t,n)=>$("<input />",{type:"date",name:"value",value:t,id:e,"data-property":n.id}))(n,e,t));break;case"datetime":a.append(((e,t,n)=>{const a=new Date(t),i=e=>e<10?"0"+e:e,o=t?`${a.getFullYear()}-${i(a.getMonth()+1)}-${i(a.getDate())}T${i(a.getHours())}:${i(a.getMinutes())}`:"";return $("<input />",{type:"datetime-local",name:"value",value:o,id:e,"data-property":n.id})})(n,e,t));break;case"select":a.append(((e,t,n)=>{const a=$("<select />",{name:"value",id:e,style:"width: 70%","data-property":n.id}),i=`${Ue}ha-entity-config.label.${n.id}_options`;return n.values.forEach((e=>{$("<option />",{value:e,text:e?RED._(`${i}.${e}`):"",selected:e===t}).appendTo(a)})),a})(n,e,t));break;case"sensor_uom":a.append(((e,t,n)=>{const a=$("#ha-config-device_class").val(),i=Fe[a];if(""===a||null===i)return qe(e,t,n);const o=$("<select />",{name:"value",id:e,style:"width: 70%","data-property":n.id});return i.forEach((e=>{$("<option />",{value:e,text:e,selected:e===t}).appendTo(o)})),o})(n,e,t));break;case"string":a.append(qe(n,e,t))}return a},Ge=e=>{$("#node-input-lookup-entityConfig").on("click",(function(){"_ADD_"===$("#node-input-entityConfig").val()&&$("body").data("haEntityType",e)}))},We=["msg","flow","global","jsonata","str","num","bool"],Je=["str","num","bool","date","jsonata","msg","flow","global"],Ke={category:Te.HomeAssistantEntities,color:we.HaBlue,inputs:1,outputs:1,icon:"font-awesome/fa-check-circle-o",align:"right",paletteLabel:"binary sensor",label:function(){return this.name||"binary sensor"},labelStyle:Se.labelStyle,defaults:{name:{value:""},entityConfig:{value:"",type:a.EntityConfig,filter:e=>"binary_sensor"===e.entityType,required:!0},version:{value:RED.settings.get("haBinarySensorVersion",0)},state:{value:"payload"},stateType:{value:"msg"},attributes:{value:[]},inputOverride:{value:"allow"},outputProperties:{value:[],validate:_e}},oneditprepare:function(){Se.setup(this),Oe(this,"#node-input-server"),O(this);$("#node-input-state").typedInput({types:We,typeField:"#node-input-stateType",type:this.stateType}),Ge("binary_sensor"),$("#attributes").editableList({removable:!0,addButton:"add attribute",header:$("<div>").append($.parseHTML("<div style='width:40%; display: inline-grid'>Attribute Key</div><div style='display: inline-grid'>Value</div>")),addItem:function(e,t,n){const a=$("<div />").appendTo(e);$("<input />",{type:"text",name:"property",style:"width: 40%;margin-right: 5px;"}).attr("autocomplete","disable").appendTo(a).val(n.property);const i=$("<input />",{type:"text",name:"value",style:"width: 55%;"}).appendTo(a).val(n.value);i.typedInput({types:Je}),i.typedInput("type",n.valueType)}}).editableList("addItems",this.attributes),fe(this.outputProperties,{extraTypes:["sentData"]})},oneditsave:function(){this.attributes=[];const e=this;$("#attributes").editableList("items").each((function(){const t=$(this);e.attributes.push({property:t.find("input[name=property]").val(),value:t.find("input[name=value]").typedInput("value"),valueType:t.find("input[name=value]").typedInput("type")})})),this.outputProperties=$e()}},Xe={category:Te.HomeAssistantEntities,color:we.HaBlue,inputs:0,outputs:1,icon:"font-awesome/fa-hand-o-up",align:"left",paletteLabel:"button",label:function(){return this.name||"button"},labelStyle:Se.labelStyle,defaults:{name:{value:""},version:{value:RED.settings.get("haButtonVersion",0)},debugenabled:{value:!1},outputs:{value:1},entityConfig:{value:"",type:a.EntityConfig,filter:e=>"button"===e.entityType,required:!0},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"entityState"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"},{property:"data",propertyType:"msg",value:"",valueType:"entity"}],validate:_e}},oneditprepare:function(){Se.setup(this),O(this),Ge("button"),fe(this.outputProperties,{extraTypes:["entity","entityState","entityId"]})},oneditsave:function(){this.outputProperties=$e()}};function Ze(e){return/^\$\{[a-zA-Z_][a-zA-Z0-9_]*\}$/.test(e)}function Ye(e){return/{{(?:(?!}}).+)}}/g.test(e)}var Qe,et;!function(e){e.Any="any",e.Custom="custom",e.None="none"}(Qe||(Qe={})),function(e){e.Entities="entitiesSelect2"}(et||(et={}));const tt={theme:"nodered",templateResult:e=>$(`<div>${e.text}${e.title?`<p class="sublabel">${e.title}</p>`:""}</div>`),matcher:(e,t)=>{var n,a;if(null==e.term||""===e.term.trim())return t;const i=e.term.toLowerCase();return void 0===t.text?null:(null===(n=t.text)||void 0===n?void 0:n.toLowerCase().indexOf(i))>-1||(null===(a=null==t?void 0:t.title)||void 0===a?void 0:a.toLowerCase().indexOf(i))>-1?t:null}},nt=({multiple:e=!1,tags:t=Qe.None,customTags:n=[],displayIds:a=!1,data:i,ajax:o})=>{const s=Object.assign(Object.assign({},tt),{data:i,multiple:e,dropdownAutoWidth:!0});return(null==o?void 0:o.serverId)&&(s.ajax={url:`homeassistant/${o.endpoint}/${o.serverId}`,dataType:"json",delay:250}),s.tags=t===Qe.Any||t===Qe.Custom,t===Qe.Custom&&(s.createTag=e=>{if(e.term.endsWith("#")){const t=e.term.substring(0,e.term.length-1);return{id:t,text:t}}return Ye(e.term)||Ze(e.term)||n.includes(e.term)?{id:e.term,text:e.term}:null}),a&&(s.templateSelection=e=>e.id.toString()),s},at=(e,t,n)=>(Array.isArray(e)?e:[e]).reduce(((e,a)=>(((null==n?void 0:n.includeUnknownIds)&&a||Ye(a)||Ze(a))&&!t.find((e=>(e=>(null==n?void 0:n.property)?e[null==n?void 0:n.property]:e)(e)===a))&&e.push({id:a,text:a,selected:!0}),e)),[]),it=e=>(u(e)?e:$(e)).hasClass("select2-hidden-accessible"),ot=()=>{const e=$("#node-input-domain").val(),t=$("#node-input-service").val();return[null==e?void 0:e.toLowerCase(),null==t?void 0:t.toLowerCase()]},st=()=>{var e;const t=$("#service-data-desc"),n=$(".service-description",t),a=$("tbody",t),i=$(".unknown-service",t),o=$(".known-service",t),s=$("#example-data"),[r,l]=ot(),u=He(),p=null===(e=null==u?void 0:u[r])||void 0===e?void 0:e[l];if(p){const e=p.description?p.description:"No description provided by home assistant",t=p.fields,u=Object.keys(t).reduce(((e,n)=>{var a,i;const o=t[n];return o.description||o.example?(e.push(`<tr><td><code>${n}</code></td><td>${null!==(a=t[n].description)&&void 0!==a?a:""}</td><td>${null!==(i=t[n].example)&&void 0!==i?i:""}</td></tr>`),e):e}),[]);n.html(e),$("#service-data-desc .title").html(`${r}.${l}`),u.length?($("#service-data-table").show(),s.show(),a.html(u.length>0?u.join(""):"")):($("#service-data-table").hide(),s.hide(),n.append("<p>No fields documented by Home Assistant<p>")),i.hide(),o.show()}else i.show(),o.hide(),s.hide(),$("#service-data-desc .title").val("")},rt=()=>{var e;const t=$("#node-input-entityId"),n=$("#node-input-data"),[a,i]=ot(),o=$("#node-input-server").val();if(a&&i&&o){const o=He(),s=null===(e=null==o?void 0:o[a])||void 0===e?void 0:e[i];if(s){const e=s.fields,a=Object.keys(e).reduce(((n,a)=>{const i=e[a].example;if("entity_id"===a)return(null==i?void 0:i.toString())&&t.val(),n;if(void 0===i)return n;if("string"==typeof i)if("["===i[0]&&"]"===i[i.length-1])try{n[a]=JSON.parse(i)}catch(e){}else'"'===i[0]&&'"'===i[i.length-1]?n[a]=i.substring(1,i.length-1):n[a]=i;else"number"!=typeof i||isNaN(i)?i&&(n[a]=i):n[a]=Number(i);return n}),{});Object.keys(a).length&&n.typedInput("value",JSON.stringify(a))}}},lt="#node-input-areaId",ut="#node-input-deviceId",pt="#node-input-entityId",dt="none",ct="all",vt="entity_only",yt=({selectedIds:e,filter:t})=>{const n=$(lt),a=f(Ie),i=null!=e?e:n.val();n.empty();const o=(t?a.filter(t):a).map((e=>({id:e.area_id,text:e.name,selected:i.includes(e.area_id)}))).sort(T(["text"])).concat(at(i,a,{property:"area_id",includeUnknownIds:!0}));n.select2(nt({data:o,multiple:!0,tags:Qe.Custom,displayIds:"id"===Be().areaSelector})).maximizeSelect2Height(),p(n)},gt=({selectedIds:e,filter:t})=>{const n=$(ut),a=b(Ie),i=null!=e?e:n.val();n.empty();const o=(t?a.filter(t):a).map((e=>{var t;return{id:e.id,text:null!==(t=e.name_by_user)&&void 0!==t?t:e.name,selected:i.includes(e.id),title:Ae(e.area_id)}})).sort(T(["text"])).concat(at(i,a,{property:"id",includeUnknownIds:!0}));n.select2(nt({data:o,multiple:!0,tags:Qe.Custom,displayIds:"id"===Be().deviceSelector})).maximizeSelect2Height(),p(n)},ht=()=>{var e,t,n,a,i;const o=He(),[s,r]=ot();return 0!==Object.keys(o).length&&(null===(e=null==o?void 0:o[s])||void 0===e?void 0:e[r])&&void 0===(null===(n=null===(t=null==o?void 0:o[s])||void 0===t?void 0:t[r])||void 0===n?void 0:n.target)?void 0!==(null===(i=null===(a=o[s])||void 0===a?void 0:a[r])||void 0===i?void 0:i.fields.entity_id)?vt:dt:ct},mt=()=>{var e,t,n,a;const i=He(),[o,s]=ot(),r=null===(a=null===(n=null===(t=null===(e=null==i?void 0:i[o])||void 0===e?void 0:e[s])||void 0===t?void 0:t.target)||void 0===n?void 0:n.entity)||void 0===a?void 0:a.domain;return r?e=>e.entity_id.startsWith(`${r}.`):void 0},ft=(e,t)=>{var n,a,i,o;const s=Ne()[e],r=He(),[l,u]=ot(),p=null===(o=null===(i=null===(a=null===(n=null==r?void 0:r[l])||void 0===n?void 0:n[u])||void 0===a?void 0:a.target)||void 0===i?void 0:i.entity)||void 0===o?void 0:o.domain;return p?e=>{var n;return null===(n=s[e[t]])||void 0===n?void 0:n.includes(p)}:void 0},bt=()=>{const e=ht(),t=$(`${lt}, ${ut}, ${pt}`);e===dt?t.parent().hide():e===vt?(t.parent().hide(),$(pt).parent().show()):t.parent().show()},$t=({areaId:e,deviceId:t,entityId:n}={})=>{const a=ht();a===ct||a===vt?(a===ct?(yt({selectedIds:e,filter:ft("areas","area_id")}),gt({selectedIds:t,filter:ft("devices","id")})):$(`${lt}, ${ut}`).val(null).trigger("change"),(({selectedIds:e,filter:t})=>{const n=$(pt),a=Object.values(Pe()),i=null!=e?e:n.val();n.empty();const o=(t?a.filter(t):a).map((e=>{var t;return{id:e.entity_id,text:null!==(t=e.attributes.friendly_name)&&void 0!==t?t:e.entity_id,selected:i.includes(e.entity_id),title:e.entity_id}})).sort(T(["text"])).concat(at(i,a,{property:"entity_id",includeUnknownIds:!0}));n.select2(nt({data:o,multiple:!0,tags:Qe.Any,displayIds:"id"===Be().entitySelector})).maximizeSelect2Height(),p(n)})({selectedIds:n,filter:mt()})):$(`${lt}, ${ut}, ${pt}`).val(null).trigger("change")},_t={category:Te.HomeAssistant,color:we.HaBlue,inputs:1,outputs:1,icon:"ha-call-service.svg",align:"right",paletteLabel:"call service",label:function(){return this.name||(this.domain||this.service?`${this.domain||"<domain>"}.${this.service||"<service>"}`:"call service")},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("apiCallServiceVersion",0)},debugenabled:{value:!1},domain:{value:""},service:{value:""},areaId:{value:[]},deviceId:{value:[]},entityId:{value:[]},data:{value:""},dataType:{value:"jsonata"},mergeContext:{value:""},mustacheAltTags:{value:!1},outputProperties:{value:[],validate:_e},queue:{value:"none"},target:{value:void 0},output_location:{value:void 0},output_location_type:{value:void 0},service_domain:{value:void 0},mergecontext:{value:void 0}},oneditprepare:function(){Se.setup(this),Oe(this,"#node-input-server");const e=$("#node-input-domain"),t=$("#node-input-service"),n=$("#node-input-data"),a=$("#node-input-dataType"),i=$("#example-data"),o=n=>{var a;const i=He(),o=null===(a=e.val())||void 0===a?void 0:a.toLowerCase(),s=!(null==i?void 0:i[o])||Ye(o)?Array.from(new Set(Object.values(i).map((e=>Object.keys(e))).flat())):Object.keys(i[o]),r=s.map((e=>({id:e,text:e,selected:e===n}))).sort(T(["text"])).concat(at(n,s,{includeUnknownIds:!0}));t.empty().select2(nt({data:r,tags:Qe.Custom})).maximizeSelect2Height(),n||t.val(null).trigger("change")};e.on("select2:select",(()=>{o(),$t(),bt(),st()})),t.on("select2:select",(()=>{$t(),bt(),st()})),$("#node-input-server").on("change",(()=>{(t=>{const n=He(),a=null!=t?t:e.val(),i=Object.keys(n).map((e=>({id:e,text:e,selected:e===a}))).sort(T(["text"])).concat(at(a,Object.keys(n),{includeUnknownIds:!0}));e.empty().select2(nt({tags:Qe.Custom,data:i})).maximizeSelect2Height(),a||e.val(null).trigger("change")})(this.domain),o(this.service),$t({entityId:this.entityId,areaId:this.areaId,deviceId:this.deviceId}),bt(),st()})),i.on("click",rt),n.typedInput({default:"jsonata",types:["jsonata","json"],typeField:"#node-input-dataType"}),n.on("change",(()=>{0===n.val().length&&n.next().removeClass("input-error"),$("#mustacheAltTags").toggle("json"===a.val())})),fe(this.outputProperties,{extraTypes:["sentData","msg"]})},oneditsave:function(){this.outputProperties=$e()}};var Tt,wt;const St=null===(wt=null===(Tt=null===Intl||void 0===Intl?void 0:Intl.DateTimeFormat())||void 0===Tt?void 0:Tt.resolvedOptions())||void 0===wt?void 0:wt.locale,Dt={month:"short",day:"numeric",hour:"numeric",minute:"numeric"};const It={category:Te.Config,defaults:{name:{value:"Home Assistant",required:!1},version:{value:RED.settings.get("serverVersion",0)},addon:{value:!1},rejectUnauthorizedCerts:{value:!0},ha_boolean:{value:"y|yes|true|on|home|open"},connectionDelay:{value:!0},cacheJson:{value:!0},heartbeat:{value:!1},heartbeatInterval:{value:30,validate:function(e){return!$("#node-config-input-heartbeat").is(":checked")||RED.validators.number()(e)&&Number(e)>=10}},areaSelector:{value:"friendlyName"},deviceSelector:{value:"friendlyName"},entitySelector:{value:"friendlyName"},statusSeparator:{value:": "},statusYear:{value:"hidden"},statusMonth:{value:"short"},statusDay:{value:"numeric"},statusHourCycle:{value:"default"},statusTimeFormat:{value:"h:m"},enableGlobalContextStore:{value:!1}},credentials:{host:{type:"text"},access_token:{type:"text"}},icon:"font-awesome/fa-home",label:function(){return this.name||"Home Assistant"},oneditprepare:function(){Se.setup(this);const e=$("#node-config-input-addon"),t=$("#node-config-input-host");!1===this.rejectUnauthorizedCerts&&$("#accept_unauthorized_certs").prop("checked",!0);function n(){$("#server-info").toggle(!e.prop("checked")),$(".addon").toggle(e.prop("checked"))}["http://hassio/homeassistant","http://supervisor/core"].includes(t.val())&&e.prop("checked",!0),n(),e.on("click",(function(){n()}));try{t.autocomplete("destroy")}catch(e){}const a=$("#discoverInstances");a.on("click",(function(){if($(this).hasClass("disabled"))return;const e=$("i",this).removeClass("fa-search").addClass("spinner");a.addClass("disabled"),t.autocomplete({source:(e,t)=>{$.ajax({dataType:"json",url:"/homeassistant/discover",cache:!1}).done((e=>{t(e)}))},minLength:0,response:()=>{e.addClass("fa-search").removeClass("spinner"),a.removeClass("disabled")},close:()=>t.autocomplete("destroy")}).autocomplete("search","")})),$("#node-config-input-heartbeat").on("change",(function(){$("#heartbeatIntervalRow").toggle(this.checked)})),$("#node-config-input-statusHourCycle").on("change",(function(){const e={hour:"numeric",minute:"numeric"},t=$(this).val();t&&"default"!==t&&(e.hourCycle=t),$("#node-config-input-statusTimeFormat").children().each((function(){const t=$(this);switch(t.val()){case"h:m:s":e.second="numeric";break;case"h:m:s.ms":e.second="numeric",e.fractionalSecondDigits=3}const n=function({date:e=new Date,locale:t=(null!=St?St:"en-US"),options:n=Dt}){return new Intl.DateTimeFormat(t,n).format(e)}({date:new Date(2022,1,1,3,4,5,6),options:e});t.text(n)}))})).trigger("change")},oneditsave:function(){const e=$("#node-config-input-addon").is(":checked"),t=$("#node-config-input-host").val();if(e)this.addon=!0,this.rejectUnauthorizedCerts=!0;else{const e=document.createElement("a");e.href=t,t===e.origin||Ze(t)||RED.notify("Invalid format of Base URL: "+t),this.rejectUnauthorizedCerts=!$("#accept_unauthorized_certs").prop("checked"),this.connectionDelay=!1}}},jt={serverId:"#node-input-server",type:"entities"};function Et({root:e,options:t}){const n=u(e)?e:$(e),a=Object.assign(Object.assign({},jt),t),i=$(a.serverId).val(),o=a.type;n.autocomplete({source:(e,t)=>{const n=e.term.toLowerCase(),a=function(e,t){let n=[];switch(t){case"entities":{if(!(e in v))return[];const t="attributes.friendly_name";n=Object.values(v[e]).map((e=>({value:e.entity_id,label:l(t,e)||e.entity_id}))).sort(m);break}case"properties":if(!(e in v))return[];n=Object.values(v[e]).map((e=>({value:e.entity_id,label:e.state}))).sort(m);break;case"trackers":{if(!(e in v))return[];const t="attributes.friendly_name";n=Object.values(v[e]).filter((e=>e.entity_id.startsWith("person.")||e.entity_id.startsWith("device_tracker."))).map((e=>({value:e.entity_id,label:l(t,e)||e.entity_id}))).sort(m);break}case"zones":{if(!(e in v))return[];const t="attributes.friendly_name";n=Object.values(v[e]).filter((e=>e.entity_id.startsWith("zone."))).map((e=>({value:e.entity_id,label:l(t,e)||e.entity_id}))).sort(m);break}}return n}(i,o).filter((e=>e.value.toLowerCase().includes(n)||e.label.toLowerCase().includes(n)));t(a)},minLength:0}).autocomplete("instance")._renderItem=(e,t)=>$("<li>").append(`<div>${t.label}<p class="sublabel">${t.value}</p></div>`).appendTo(e)}const Ot=function(e,t,n){const a=$(e),i=$(t),o={value:"entity",label:"entity."},s=["str","num","bool","re","jsonata","msg","flow","global",o];"currentState"!==n&&s.splice(5,1),a.after(' <a id="clearIfState" class="editor-button"><i class="fa fa-remove"></i></a>');const r=$("#clearIfState");a.typedInput({default:"str",types:s,typeField:"#node-input-halt_if_type"}),i.on("change",(function(){const e=$(this);let t=s,n=["flow","global",o];switch(s.includes("msg")&&(n=["msg",...n]),e.val()){case"is":case"is_not":break;case"lt":case"lte":case"gt":case"gte":t=["num","jsonata",...n];break;case"includes":case"does_not_include":t=["str","jsonata",...n];break;case"jsonata":t=["jsonata"]}a.typedInput("types",t)})),i.trigger("change"),a.on("change",(function(){$(this).val()&&r.show()})),r.on("click",(e=>{a.typedInput("type","str"),a.typedInput("value",""),$(e.currentTarget).hide()})),a.val()||r.hide()},xt={category:Te.HomeAssistant,color:we.HaBlue,inputs:1,outputs:1,outputLabels:function(e){if(this.halt_if){if(0===e)return"'If State' is true";if(1===e)return"'If State' is false"}},icon:"ha-current-state.svg",paletteLabel:"current state",label:function(){return this.name||`current_state: ${this.entity_id}`},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("apiCurrentStateVersion",0)},outputs:{value:1},halt_if:{value:""},halt_if_type:{value:"str"},halt_if_compare:{value:"is"},entity_id:{value:""},state_type:{value:"str"},blockInputOverrides:{value:!1},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"entityState"},{property:"data",propertyType:"msg",value:"",valueType:"entity"}],validate:_e},for:{value:"0"},forType:{value:"num"},forUnits:{value:"minutes"},override_topic:{value:!1},state_location:{value:"payload"},override_payload:{value:"msg"},entity_location:{value:"data"},override_data:{value:"msg"}},oneditprepare:function(){Se.setup(this),Oe(this,"#node-input-server"),Et({root:"#node-input-entity_id"}),Ot("#node-input-halt_if","#node-input-halt_if_compare","currentState"),$("#node-input-halt_if_compare").on("change",(function(){const e=["is","is_not","includes","does_not_include"].includes(this.value);$("#for-row").toggle(e)})),$("#node-input-for").typedInput({default:"num",types:["num","jsonata","msg","flow","global"],typeField:"#node-input-forType"}),fe(this.outputProperties,{extraTypes:["entity","entityId","entityState"]})},oneditsave:function(){const e=$("#node-input-halt_if").val()?2:1;$("#node-input-outputs").val(e),this.outputProperties=$e()}};function Ct(e,t,n,a){return new(n||(n=Promise))((function(i,o){function s(e){try{l(a.next(e))}catch(e){o(e)}}function r(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}l((a=a.apply(e,t||[])).next())}))}function kt(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)}function Rt(e,t,n,a,i){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,n):i?i.value=n:t.set(e,n),n}var Lt=Object.freeze({__proto__:null,inputCount:1,getCapabilitiesList:e=>Ct(void 0,void 0,void 0,(function*(){return yield Le("deviceActionCapabilities",{action:e})})),getEventList:e=>Ct(void 0,void 0,void 0,(function*(){return yield Le("deviceActions",{deviceId:e})})),setDefaultOutputs:()=>[]});var At=Object.freeze({__proto__:null,inputCount:0,getCapabilitiesList:e=>Ct(void 0,void 0,void 0,(function*(){return yield Le("deviceTriggerCapabilities",{trigger:e})})),getEventList:e=>Ct(void 0,void 0,void 0,(function*(){return yield Le("deviceTriggers",{deviceId:e})})),setDefaultOutputs:e=>e});function Pt(e=[],t=[]){const n=[];return e.forEach((e=>{const a=t.find((t=>t.name===e.name));switch(e.type){case"boolean":{const t=function(e,t){const n=`deviceExtra-${e.name}`,a=t?t.value:"";return Ht(`\n        <label for="${n}">${e.name}</label>\n        <input type="checkbox" id="${n}" style="width: auto" value="${a}"/>        \n        `)}(e,a);n.push($(t));break}case"float":{const t=function(e,t){const n=`deviceExtra-${e.name}`,a=t?t.value:"";let i=`\n        <label for="${n}">${e.name}</label>\n        <input type="text" id="${n}" style="width: 35%" value="${a}"/>        \n        `;e.description&&e.description.suffix&&(i+=`<span>${e.description.suffix}</span>`);return Ht(i)}(e,a);n.push($(t));break}case"integer":{const t=function(e,t){var n;const a=`deviceExtra-${e.name}`,i=t?t.value:"",o=$(`\n        <label for="${a}">${e.name}</label>\n        <div class="range-row">\n            <input type="checkbox" />\n            <input type="range" id="${a}" max="${e.valueMax}" min="${null!==(n=e.valueMin)&&void 0!==n?n:0}" value="${i}" />\n            <input type="text" value="${i}" />\n        </div>\n        `),s=o.find('input[type="checkbox"]'),r=o.find('input[type="range"]'),l=o.find('input[type="text"]');!1!==e.optional&&void 0===(null==t?void 0:t.value)||s.prop("checked",!0);!1===e.optional&&s.hide();return s.on("change",(()=>{r.prop("disabled",!s.prop("checked")).trigger("change"),l.prop("disabled",!s.prop("checked"))})).trigger("change"),r.on("change input",(()=>{l.val(r.val())})).trigger("change"),l.on("keyup change",(()=>{const t=l.val();if(t.length>0){const n=Number(t);n<e.valueMin&&l.val(e.valueMin),n>e.valueMax&&l.val(e.valueMax),r.val(l.val())}})),Ht(o)}(e,a);n.push(t);break}case"positive_time_period_dict":{const t=function(e,t){const n=`deviceExtra-${e.name}`,a=t?t.value:"",i=e=>t&&e===t.unit?"selected":"",o="ha-device.label",r={seconds:s(`${o}.seconds`),minutes:s(`${o}.minutes`),hours:s(`${o}.hours`)};return Ht(`\n        <label for="${n}">\n            <i class="fa fa-clock-o"></i> ${e.name}\n        </label>\n        <input type="text" id="${n}" style="width: 35%" value="${a}"/>\n        <select id="${n}Units" style="width: 35%">\n            <option value="seconds" ${i("seconds")}>${r.seconds}</option>\n            <option value="minutes" ${i("minutes")}>${r.minutes}</option>\n            <option value="hours" ${i("hours")}>${r.hours}</option>\n        </select>`)}(e,a);n.push($(t));break}case"select":{const t=function(e,t={}){const n=`deviceExtra-${e.name}`,a=e.options.reduce(((e,[n,a])=>{const i=t.value===n?"selected":"";return e.push(`<option value="${n}" ${i}>${a}</option>`),e}),[]);return Ht(`\n        <label for="${n}">${e.name}</label>\n        <select id="${n}" style="width: 70%">\n        ${a.join("")}\n        </select>        \n        `)}(e,a);n.push($(t));break}case"string":{const t=function(e,t){const n=`deviceExtra-${e.name}`,a=t?t.value:"";return Ht(`\n        <label for="${n}">${e.name}</label>\n        <input type="text" id="${n}" style="width: 70%" value="${a}"/>\n        `)}(e,a);n.push($(t));break}default:{const t=function(e,t={}){return Ht(`<label class="error"><i class="fa fa-exclamation-triangle"></i> Error</label>${e} -- <a href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/issues/new?title=[Device Node] Unknown extra type: ${t.type}" target="_blank"> ${s("ha-device.error.report")}</a>`)}(s("ha-device.error.unknown_field_type",{type:e.type}),{type:e.type});n.push($(t))}}})),n}function Ht(e,t=["deviceExtra"]){return e instanceof $?$(`<div class="form-row ${t.join(" ")}"></div>`).append(e):`<div class="form-row ${t.join(" ")}">${e}</div>`}const Nt=e=>"action"===e?Lt:At,Bt=[{property:"payload",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}],Vt={category:Te.HomeAssistant,color:we.Alpha,inputs:0,outputs:1,icon:"font-awesome/fa-cube",paletteLabel:"device",label:function(){return this.name||`device ${this.deviceType}`},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("haDeviceVersion",0)},debugenabled:{value:!1},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},inputs:{value:0},deviceType:{value:"trigger"},device:{value:""},event:{value:void 0,validate:e=>void 0!==e},capabilities:{value:[],validate:e=>{if(!Array.isArray(e))return!0;for(const t of e)switch(t.type){case"float":if(!Number.isFinite(Number(t.value)))return!1;break;case"positive_time_period_dict":if(-1===Math.sign(t.value))return!1;break}return!0}},outputProperties:{value:Bt,validate:_e}},oneditprepare:function(){Se.setup(this),Oe(this,"#node-input-server"),O(this);const e="_ADD_",t=$("#node-input-server"),n=$("#node-input-deviceType"),a=$("#node-input-device"),i=$("#event");let o,u=Nt(n.val());a.on("select2:select",(function(){w($(this).val())})),i.on("change",(function(e){const t=e.target.value;if("__NONE__"===t)return;const n=i.data("events");S(n[t])}));const p=(e,t)=>{const n=l("text",e),a=l("text",t);return n===a?0:"string"!=typeof n?1:n.localeCompare(a)},d=()=>{_(),T()},c=()=>Ct(this,void 0,void 0,(function*(){const e=RED.i18n.lang();try{o=yield Le("translations",{cat:"device_automation",lang:e})}catch(e){RED.notify("Error retrieving translations.","error")}})),y=(e,t)=>{if(t&&(null==e?void 0:e.length)){const n=e.find((e=>e.area_id===t));if(n)return n.name}return s("ha-device.ui.no_area")},g=n=>{const i=t.val();if(i===e)return;const o=b(i);if(!o)return;const s=f(i);a.empty(),a.select2(Object.assign(Object.assign({},tt),{data:o.map((e=>({id:e.id,text:e.name_by_user||e.name,selected:e.id===n,title:y(s,e.area_id)}))).sort(p)})).maximizeSelect2Height()},h=()=>Ct(this,void 0,void 0,(function*(){d(),t.val()!==e&&(c(),g(),w(a.val()))})),m=e=>{const t=a.val(),n=e.target.value;var i;T(),t&&(u=Nt(n),w(t)),i=I(n),ge=i;const o="trigger"===n?Bt:[],s=u.setDefaultOutputs(o);var r;r=s,ye.editableList("empty"),ye.editableList("addItems",r),$("#event").prev().text(n),$("#haConfigRow").toggle("trigger"===n)};t.one("change",(()=>{d(),g(this.device),t.val()!==e&&(c(),w(this.device,this.event,this.capabilities)),setTimeout((()=>{t.on("change",h),n.on("change",m)}),100)}));const _=()=>{i.html(`<option value="__NONE__">No ${n.val()}s</option>`).trigger("change").prop("disabled",!0)},T=()=>{$(".deviceExtra").remove()},w=(e,t,o)=>Ct(this,void 0,void 0,(function*(){if(!e)return;const s=yield u.getEventList(e);let l;if(0===s.length)_(),T(),l=0;else{if(s[0].device_id!==a.val())return;const e=n.val();i.data("events",s).empty().prop("disabled",!1);const u=[];for(let t=0;t<s.length;t++){const n=yield D(e,s[t]);u.push(new Option(n,t.toString()))}i.append(u),l=s.findIndex((e=>r(t,e))),l=-1===l?0:l,S(s[l],o)}$("option",i).eq(l).prop("selected",!0)})),S=(e,t)=>Ct(this,void 0,void 0,(function*(){T();const n=yield u.getCapabilitiesList(e);if(null==n?void 0:n.length){i.data("capabilities",n);const e=Pt(n,t);i.parent().after(e)}})),D=(e,n)=>Ct(this,void 0,void 0,(function*(){var a;const i=(t="type")=>`component.${n.domain}.device_automation.${e}_${t}.${n[t]}`;let s=null!==(a=null==o?void 0:o[i()])&&void 0!==a?a:n.subtype?`"${n.subtype}" ${n.type}`:n.type;const r={entity_name:()=>Ct(this,void 0,void 0,(function*(){if(!n.entity_id)return"<unknown>";const e=function(e,t){return v[e][t]}(t.val(),n.entity_id);return e?e.attributes&&void 0!==e.attributes.friendly_name?e.attributes.friendly_name||"":n.entity_id.split(".")[1].replace(/_/g," "):""})),subtype:()=>o[i("subtype")]||n.subtype},l=Object.keys(r);for(const e of l){const t=`{${e}}`;if(-1!==s.indexOf(t)){const n=yield r[e]();s=s.replace(t,n)}}return s})),I=e=>({action:["sentData"],trigger:["eventData","deviceId"]}[e]);$("#dialog-form").prepend(Se.alphaWarning(367)),fe(this.outputProperties,{extraTypes:I(n.val())}),$("#haConfigRow").toggle("trigger"===n.val()),$("#exposeToHa").remove()},oneditsave:function(){const e=Nt($("#node-input-deviceType").val()),t=$("#event"),n=t.val();if(this.inputs=e.inputCount,"__NONE__"!==n){const e=t.data("events"),a=t.data("capabilities");this.event=e[n],this.capabilities=function(e=[]){return e.reduce(((e,t)=>{const n=`deviceExtra-${t.name}`,a=$(`#${n}`).val();switch(t.type){case"boolean":e.push({name:t.name,type:t.type,value:$(`#${n}`).is(":checked")});break;case"float":case"positive_time_period_dict":if(a&&a.length&&!isNaN(Number(a))){const i={name:t.name,type:t.type,value:Number(a),unit:"positive_time_period_dict"===t.type?$(`#${n}Units`).val():void 0};e.push(i)}break;case"integer":if($(`#${n}`).siblings('input[type="checkbox"]').prop("checked")&&a&&a.length&&!isNaN(Number(a))){const n={name:t.name,type:t.type,value:Number(a)};e.push(n)}break;case"select":a&&a.length&&e.push({name:t.name,type:t.type,value:a});break;case"string":a.length&&e.push({name:t.name,type:t.type,value:a})}return e}),[])}(a)}this.haConfig=x(),this.outputProperties=$e()}},Ft={category:Te.Config,defaults:{version:{value:RED.settings.get("haDeviceConfigVersion",0)},name:{value:"",required:!1},hwVersion:{value:"",required:!1},manufacturer:{value:"Node-RED",required:!1},model:{value:"",required:!1},swVersion:{value:"",required:!1}},icon:"font-awesome/fa-device",label:function(){return this.name||"Devce Config"},oneditprepare:function(){Se.setup(this)}},Mt={category:Te.HomeAssistantDeprecated,color:we.Deprecated,inputs:1,outputs:1,icon:function(){return"switch"===(null==this?void 0:this.entityType)?"ha-entity-switch.svg":"font-awesome/fa-genderless"},align:"right",paletteLabel:"entity",label:function(){return this.name||`type: ${this.entityType}`},labelStyle:function(){return this.name?"node_label_italic":""},defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("haEntityVersion",0)},debugenabled:{value:!1},outputs:{value:1},entityType:{value:"sensor"},config:{value:[{property:"name",value:""},{property:"device_class",value:""},{property:"icon",value:""},{property:"unit_of_measurement",value:""},{property:"state_class",value:""},{property:"last_reset",value:""}]},state:{value:"payload"},stateType:{value:"msg"},attributes:{value:[]},resend:{value:!0},outputLocation:{value:"payload"},outputLocationType:{value:"none"},inputOverride:{value:"allow"},outputOnStateChange:{value:null},outputPayload:{value:null},outputPayloadType:{value:null}},oneditprepare:function(){Se.setup(this),this.server&&RED.tray.close()}};const Ut=[{id:"name",type:"string"},{id:"icon",type:"string"},{id:"entity_category",type:"select",values:["","config","diagnostic"]},{id:"entity_picture",type:"string"}],qt={button:[{id:"device_class",type:"select",values:["","restart","update"]}],binary_sensor:[{id:"device_class",type:"select",values:["","battery","battery_charging","co","cold","connectivity","door","garage_door","gas","heat","light","lock","moisture","motion","moving","occupancy","opening","plug","power","presence","problem","running","safety","smoke","sound","tamper","update","vibration","window"]}],sensor:Me,switch:[{id:"device_class",type:"select",values:["","outlet","switch"]}]},zt={binary_sensor:["resend"],sensor:["resend"]},Gt={category:Te.Config,defaults:{server:{value:"",type:a.Server,required:!0},deviceConfig:{value:"",type:a.DeviceConfig,required:!1},name:{value:""},version:{value:RED.settings.get("haEntityConfigVersion",0)},entityType:{value:"binary_sensor",required:!0},haConfig:{value:[]},resend:{value:!1},debugEnabled:{value:!1}},label:function(){return this.name||`${this.entityType} ${this.id}`},oneditprepare:function(){Se.setup(this),this.deviceConfig||$("#node-config-input-deviceConfig").val("_ADD_"),(()=>{const e=$("body").data("haEntityType");e&&($("#node-config-input-entityType").val(e),$("body").data("haEntityType",null))})();const e=$("#ha-config-rows"),t=this;$("#node-config-input-entityType").on("change",(function(){const n=$(this).val();$(".ha-config-row").remove(),$("#node-config-dialog-edit-form .ha-optional-row").each((function(){var e;const t=$(this),a=t.attr("id");a&&t.hasClass("ha-optional-row")&&t.toggle(null===(e=zt[n])||void 0===e?void 0:e.includes(a.replace(/-row$/,"")))}));[...Ut,...qt[n]].forEach((n=>{var a,i;const o=null!==(i=null===(a=t.haConfig.find((e=>e.property===n.id)))||void 0===a?void 0:a.value)&&void 0!==i?i:"";e.append(ze(o,n))})),"sensor"===n&&$("#ha-config-device_class").on("change",(function(){var e,n;const a=null!==(n=null===(e=t.haConfig.find((e=>"unit_of_measurement"===e.property)))||void 0===e?void 0:e.value)&&void 0!==n?n:"";$("#ha-config-unit_of_measurement").parent().replaceWith(ze(a,{id:"unit_of_measurement",type:"sensor_uom"}))}))}))},oneditsave:function(){const e=[];$(".ha-config-row").each((function(){const t=$(this);switch(t.data("type")){case"datetime":case"date":{const n=t.find("input").data("property"),a=t.find("input").val();if(""===a)return;const i=new Date(a);e.push({property:n,value:i.toISOString()});break}case"string":{const n=t.find("input").data("property"),a=t.find("input").val();e.push({property:n,value:a});break}case"select":{const n=t.find("select"),a=n.data("property"),i=n.val();e.push({property:a,value:i});break}case"sensor_uom":{const n=t.find("select, input"),a=n.data("property"),i=n.val();e.push({property:a,value:i});break}}})),this.haConfig=e}},Wt={category:Te.HomeAssistant,color:we.HaBlue,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("serverEventsVersion",0)},eventType:{value:"",required:!1},exposeToHomeAssistant:{value:!1},eventData:{value:"",required:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},waitForRunning:{value:!0},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:'$outputData("eventData").event_type',valueType:"jsonata"}],validate:_e},event_type:{value:"",required:!1}},inputs:0,outputs:1,icon:"ha-events-all.svg",paletteLabel:"events: all",label:function(){return this.name||`events: ${this.eventType||"all"}`},labelStyle:Se.labelStyle,oneditprepare:function(){Se.setup(this),Oe(this,"#node-input-server"),O(this),$("#node-input-eventData").on("change input",(function(){const e=$(this);0===e.val().length&&e.next().removeClass("input-error")})).typedInput({types:["json"]}),$("#node-input-eventType").on("change input",(function(){const e=$(this).val().trim();$("#eventAlert").toggle(0===e.length),this.value=e})),fe(this.outputProperties,{extraTypes:["eventData"]})},oneditsave:function(){this.haConfig=x(),this.outputProperties=$e()}};var Jt,Kt,Xt,Zt,Yt,Qt,en,tn,nn,an,on;class sn{constructor({filterTypeSelector:e,entityId:t,serverId:n}){Jt.add(this),Kt.set(this,void 0),Xt.set(this,void 0),Zt.set(this,void 0),Yt.set(this,void 0),Qt.set(this,void 0),en.set(this,void 0),Rt(this,Zt,$(e),"f"),Rt(this,Qt,t,"f"),Rt(this,en,n,"f"),kt(this,Jt,"m",nn).call(this),this.init()}get entityId(){var e,t,n,a;let i=[];switch(kt(this,Zt,"f").val()){case"exact":i=it(kt(this,Kt,"f"))?null===(t=null===(e=kt(this,Kt,"f").select2("data"))||void 0===e?void 0:e[0])||void 0===t?void 0:t.id:"";break;case"list":i=it(kt(this,Kt,"f"))?null!==(a=null===(n=kt(this,Kt,"f").select2("data"))||void 0===n?void 0:n.map((e=>e.id)))&&void 0!==a?a:[]:"";break;case"substring":case"regex":i=kt(this,Xt,"f").val()}return i}init(){kt(this,Zt,"f").on("change",kt(this,Jt,"m",an).bind(this)),kt(this,Yt,"f").on("click",(()=>{(({filter:e,filterType:t,entities:n,complete:a})=>{RED.editor.showTypeEditor("ha_entity_filter",{filter:e,filterType:t,entities:n,complete:a})})({filter:kt(this,Xt,"f").val(),filterType:kt(this,Zt,"f").val(),entities:Pe(),complete:e=>{kt(this,Xt,"f").val(e)}})})),kt(this,Jt,"m",on).call(this,Array.isArray(kt(this,Qt,"f"))),kt(this,Xt,"f").val(kt(this,Qt,"f"))}destroy(){it(kt(this,Kt,"f"))&&kt(this,Kt,"f").select2("destroy")}serverChanged(e){Rt(this,en,e,"f"),kt(this,Kt,"f").empty(),kt(this,Jt,"m",an).call(this)}}Kt=new WeakMap,Xt=new WeakMap,Zt=new WeakMap,Yt=new WeakMap,Qt=new WeakMap,en=new WeakMap,Jt=new WeakSet,tn=function(){const e=Pe(),t=(Array.isArray(kt(this,Qt,"f"))?kt(this,Qt,"f"):[kt(this,Qt,"f")]).reduce(((t,n)=>{var a,i;const o="id"===Be().entitySelector?n:null!==(i=null===(a=e.find((e=>e.entity_id===n)))||void 0===a?void 0:a.attributes.friendly_name)&&void 0!==i?i:n;return t.push($("<option />",{value:n,text:o,selected:!0})),t}),[]);return t},nn=function(){const e=kt(this,Zt,"f").parent(),t=$("<div />",{class:"ha-entity-selector"}),n=kt(this,Zt,"f").val();Rt(this,Kt,$("<select />",{id:"ha-entity-selector",multiple:"list"===n}),"f"),Rt(this,Xt,$("<input />",{type:"text"}),"f"),Rt(this,Yt,$('\n            <a class="editor-button">\n                <i class="fa fa-search"></i>\n            </a>'),"f"),e.append(t.append([kt(this,Kt,"f"),kt(this,Xt,"f"),kt(this,Yt,"f")])),kt(this,Zt,"f").appendTo(t),""!==kt(this,Qt,"f")&&kt(this,Kt,"f").append(kt(this,Jt,"m",tn).call(this))},an=function(){const e=kt(this,Zt,"f").val();switch(e){case"exact":case"list":kt(this,Jt,"m",on).call(this,"list"===e),kt(this,Yt,"f").hide(),kt(this,Xt,"f").hide();break;case"substring":case"regex":kt(this,Kt,"f").next().hide(),kt(this,Yt,"f").show(),kt(this,Xt,"f").val(kt(this,Qt,"f")).show()}},on=function(e=!1){kt(this,Kt,"f").select2(nt({tags:Qe.Custom,multiple:e,displayIds:"id"===Be().entitySelector,ajax:{endpoint:et.Entities,serverId:kt(this,en,"f")}})).maximizeSelect2Height(),e&&p(kt(this,Kt,"f"))};const rn={category:Te.HomeAssistant,color:we.HaBlue,inputs:0,outputs:1,outputLabels:["'If State' is true","'If State' is false"],icon:"ha-events-state-changed.svg",paletteLabel:"events: state",label:function(){return this.name||`state_changed: ${this.entityidfilter||"all entities"}`},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("serverStateChangedVersion",0)},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},entityidfilter:{value:"",required:!0},entityidfiltertype:{value:"exact"},outputinitially:{value:!1},state_type:{value:"str"},haltifstate:{value:""},halt_if_type:{value:"str"},halt_if_compare:{value:"is"},outputs:{value:1},output_only_on_state_change:{value:!0},for:{value:"0"},forType:{value:"num"},forUnits:{value:"minutes"},ignorePrevStateNull:{value:!1},ignorePrevStateUnknown:{value:!1},ignorePrevStateUnavailable:{value:!1},ignoreCurrentStateUnknown:{value:!1},ignoreCurrentStateUnavailable:{value:!1},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"entityState"},{property:"data",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}],validate:_e}},oneditprepare:function(){Se.setup(this),Oe(this,"#node-input-server",(t=>{e.serverChanged(t)})),O(this);const e=new sn({filterTypeSelector:"#node-input-entityidfiltertype",entityId:this.entityidfilter,serverId:xe()});$("#dialog-form").data("entitySelector",e),Ot("#node-input-haltifstate","#node-input-halt_if_compare"),$("#node-input-for").typedInput({default:"num",types:["num","jsonata","flow","global"],typeField:"#node-input-forType"}),fe(this.outputProperties,{extraTypes:["eventData","entityId","entityState"]})},oneditsave:function(){const e=$("#node-input-haltifstate").val()?2:1;$("#node-input-outputs").val(e),this.haConfig=x(),this.outputProperties=$e();const t=$("#dialog-form").data("entitySelector");this.entityidfilter=t.entityId,t.destroy()},oneditcancel:function(){$("#dialog-form").data("entitySelector").destroy()}},ln={category:Te.HomeAssistant,color:we.HaBlue,inputs:1,outputs:1,icon:"ha-fire-event.svg",align:"right",paletteLabel:"fire event",label:function(){return this.name||`Event: ${this.event}`},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("haFireEventVersion",0)},event:{value:""},data:{value:""},dataType:{value:"jsonata"}},oneditprepare:function(){Se.setup(this),Oe(this,"#node-input-server"),$("#node-input-data").typedInput({types:["json","jsonata"],typeField:"#node-input-dataType"})}},un={category:Te.HomeAssistant,color:we.HaBlue,inputs:1,outputs:1,icon:"ha-get-entities.svg",paletteLabel:"get entities",label:function(){return this.name||"get entities"},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("haGetEntitiesVersion",0)},rules:{value:[{property:"",logic:"is",value:"",valueType:"str"}]},output_type:{value:"array"},output_empty_results:{value:!1},output_location_type:{value:"msg"},output_location:{value:"payload"},output_results_count:{value:1,validate:function(e){return"random"!==$("#node-input-output_type").val()||Number.isInteger(Number(e))}}},oneditprepare:function(){Se.setup(this);const e=[{value:"is",text:"is"},{value:"is_not",text:"is not"},{value:"lt",text:"<"},{value:"lte",text:"<="},{value:"gt",text:">"},{value:"gte",text:">="},{value:"includes",text:"in"},{value:"does_not_include",text:"not in"},{value:"starts_with",text:"starts with"},{value:"in_group",text:"in group"},{value:"jsonata",text:"JSONata"}],t={value:"entity",label:"entity."},n=["str","num","bool","re","jsonata","msg","flow","global",t],a=$("#logic");let i=[];Oe(this,"#node-input-server"),Ce("properties",(e=>{i=e,$(".input-property").autocomplete({source:i,minLength:0})})),a.editableList({addButton:!0,removable:!0,height:"auto",addItem:function(a,o,s){const r=$("<div />",{class:"editable-list-row"}).appendTo(a),l=$("<div />",{class:"editable-list-row"}).appendTo(a);s.hasOwnProperty("logic")||(s.logic="is"),$("<span />",{text:"Property",style:"padding-right: 47px;"}).appendTo(r);const u=$("<input />",{type:"text",class:"input-property",style:"margin-left: 5px;"}).appendTo(r).val(s.property);u.autocomplete({source:i,minLength:0});const p=$("<select/>",{style:"margin-right: 5px;width: auto;"}).appendTo(l).on("change",(function(){const e=$(this).val();let a=n;switch(u.prop("disabled","jsonata"===e),e){case"is":case"is_not":break;case"lt":case"lte":case"gt":case"gte":a=["num","jsonata","msg","flow","global",t];break;case"includes":case"does_not_include":case"starts_with":case"in_group":a=["str","jsonata","msg","flow","global",t];break;case"jsonata":a=["jsonata"]}d.typedInput("types",a)}));for(const t in e)p.append($("<option></option>").val(e[t].value).text(e[t].text));const d=$("<input />",{class:"input-value",type:"text",style:"width: 70%;"}).appendTo(l).val(s.value);d.typedInput({types:n}),d.typedInput("type",s.valueType),p.val(s.logic).trigger("change")}}),a.editableList("addItems",this.rules),$("#node-input-output_location").typedInput({types:["msg","flow","global"],typeField:"#node-input-output_location_type"}),$("#node-input-output_results_count").spinner({min:1}),$("#node-input-output_type").on("change",(function(){switch($(".output-option").hide(),$(this).val()){case"array":$("#output_empty_results").show(),$("#output_location").show();break;case"count":$("#output_location").show();break;case"random":$("#output_results_count").show(),$("#output_location").show()}})).trigger("change")},oneditsave:function(){const e=$("#logic").editableList("items");this.rules=[];const t=this;e.each((function(){var e,n,a;const i=$(this),o=null!==(e=i.find(".input-property").val())&&void 0!==e?e:"",s=null!==(n=i.find("select").val())&&void 0!==n?n:"",r=null!==(a=i.find(".input-value").typedInput("value"))&&void 0!==a?a:"",l=i.find(".input-value").typedInput("type");t.rules.push({property:o,logic:s,value:r,valueType:l})}))}},pn={category:Te.HomeAssistant,color:we.HaBlue,inputs:1,outputs:1,icon:"ha-get-history.svg",paletteLabel:"get history",label:function(){if(this.name)return this.name;if(this.useRelativeTime&&this.relativeTime)return this.relativeTime;if(this.startdate){const e=new Date(this.startdate);return`${e.toLocaleDateString()} ${e.toLocaleTimeString()}`}return"get history"},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("apiGetHistoryVersion",0)},startdate:{value:""},enddate:{value:""},entityid:{value:""},entityidtype:{value:""},useRelativeTime:{value:!1},relativeTime:{value:""},flatten:{value:!0},output_type:{value:"array"},output_location_type:{value:"msg"},output_location:{value:"payload"}},oneditprepare:function(){Se.setup(this),this.entityidtype=this.entityidtype||"is",$("#node-input-entityidtype").val(this.entityidtype),Oe(this,"#node-input-server"),Et({root:"#node-input-entityid"}),$("#node-input-useRelativeTime").on("change",(function(){this.checked?($(".relative_row").show(),$(".date_row").hide()):($(".relative_row").hide(),$(".date_row").show())})),$("#node-input-output_location").typedInput({types:["msg","flow","global"],typeField:"#node-input-output_location_type"}),$("#node-input-output_type").on("change",(e=>{const t=e.target;$(".output-option").toggle("array"===t.value)})).trigger("change")}},dn={category:Te.HomeAssistant,color:we.HaBlue,inputs:0,outputs:1,outputLabels:["'If State' is true","'If State' is false"],icon:"ha-poll-state.svg",paletteLabel:"poll state",label:function(){return this.name||`poll state: ${this.entity_id}`},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("pollStateVersion",0)},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},updateinterval:{value:"60"},updateIntervalType:{value:"num"},updateIntervalUnits:{value:"seconds"},outputinitially:{value:!1},outputonchanged:{value:!1},entity_id:{value:"",required:!0},state_type:{value:"str"},halt_if:{value:""},halt_if_type:{value:"str"},halt_if_compare:{value:"is"},outputs:{value:1}},oneditprepare:function(){Se.setup(this),Oe(this,"#node-input-server"),O(this),Et({root:"#node-input-entity_id"}),$("#node-input-updateinterval").typedInput({types:["num","jsonata"],typeField:"#node-input-updateIntervalType"}),Ot("#node-input-halt_if","#node-input-halt_if_compare")},oneditsave:function(){const e=$("#node-input-halt_if").val()?2:1;$("#node-input-outputs").val(e),this.haConfig=x()}};let cn;const vn={category:Te.HomeAssistant,color:we.HaBlue,inputs:1,outputs:1,icon:"ha-render-template.svg",paletteLabel:"render template",label:function(){return this.name||"template"},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("apiRenderTemplateVersion",0)},template:{value:""},resultsLocation:{value:"payload"},resultsLocationType:{value:"msg"},templateLocation:{value:"template"},templateLocationType:{value:"msg"}},oneditprepare:function(){Se.setup(this),Oe(this,"#node-input-server");const e=$("#node-input-template");$("#node-input-templateLocation").typedInput({types:["msg","flow","global",{value:"none",label:"none",hasValue:!1}],typeField:"#node-input-templateLocationType"}),$("#node-input-resultsLocation").typedInput({types:["msg","flow","global",{value:"none",label:"none",hasValue:!1}],typeField:"#node-input-resultsLocationType"}),cn=RED.editor.createEditor({id:"node-input-template-editor",mode:"ace/mode/text",value:e.val()})},oneditresize:function(){var e;const t=$("#dialog-form>div:not(.node-text-editor-row)"),n=$("#dialog-form>div.node-text-editor-row"),a=$(".node-text-editor");let i=null!==(e=$("#dialog-form").height())&&void 0!==e?e:0;for(let e=0;e<t.length;e++){const n=$(t[e]).outerHeight(!0);"number"==typeof n&&(i-=n)}i-=parseInt(n.css("marginTop"))+parseInt(n.css("marginBottom")),a.css("height",`${i}px`),null==cn||cn.resize()},oneditcancel:function(){null==cn||cn.destroy(),cn=void 0},oneditsave:function(){var e;const t=null!==(e=null==cn?void 0:cn.getValue())&&void 0!==e?e:"";$("#node-input-template").val(t),null==cn||cn.destroy(),cn=void 0}},yn=["msg","flow","global","jsonata","str","num","bool"],gn=["str","num","bool","date","jsonata","msg","flow","global"],hn={category:Te.HomeAssistantEntities,color:we.HaBlue,inputs:1,outputs:1,icon:"font-awesome/fa-genderless",align:"right",paletteLabel:"sensor",label:function(){return this.name||"sensor"},labelStyle:Se.labelStyle,defaults:{name:{value:""},entityConfig:{value:"",type:a.EntityConfig,filter:e=>"sensor"===e.entityType,required:!0},version:{value:RED.settings.get("haSensorVersion",0)},state:{value:"payload"},stateType:{value:"msg"},attributes:{value:[]},inputOverride:{value:"allow"},outputProperties:{value:[],validate:_e}},oneditprepare:function(){Se.setup(this),Oe(this,"#node-input-server"),O(this);$("#node-input-state").typedInput({types:yn,typeField:"#node-input-stateType",type:this.stateType}),Ge("sensor"),$("#attributes").editableList({removable:!0,addButton:"add attribute",header:$("<div>").append($.parseHTML("<div style='width:40%; display: inline-grid'>Attribute Key</div><div style='display: inline-grid'>Value</div>")),addItem:function(e,t,n){const a=$("<div />").appendTo(e);$("<input />",{type:"text",name:"property",style:"width: 40%;margin-right: 5px;"}).attr("autocomplete","disable").appendTo(a).val(n.property);const i=$("<input />",{type:"text",name:"value",style:"width: 55%;"}).appendTo(a).val(n.value);i.typedInput({types:gn}),i.typedInput("type",n.valueType)}}).editableList("addItems",this.attributes),fe(this.outputProperties,{extraTypes:["sentData"]})},oneditsave:function(){this.attributes=[];const e=this;$("#attributes").editableList("items").each((function(){const t=$(this);e.attributes.push({property:t.find("input[name=property]").val(),value:t.find("input[name=value]").typedInput("value"),valueType:t.find("input[name=value]").typedInput("type")})})),this.outputProperties=$e()}},mn={category:Te.HomeAssistantEntities,color:we.HaBlue,inputs:0,outputs:1,icon:"font-awesome/fa-toggle-on",align:"left",paletteLabel:"switch",label:function(){return this.name||"switch"},labelStyle:Se.labelStyle,defaults:{name:{value:""},version:{value:RED.settings.get("haSwitchVersion",0)},debugenabled:{value:!1},inputs:{value:0},outputs:{value:2},entityConfig:{value:"",type:a.EntityConfig,filter:e=>"switch"===e.entityType,required:!0},enableInput:{value:!1},outputOnStateChange:{value:!1},outputProperties:{value:[{property:"outputType",propertyType:"msg",value:"state change",valueType:"str"},{property:"payload",propertyType:"msg",value:"",valueType:"entityState"}],validate:_e}},oneditprepare:function(){Se.setup(this),O(this),Ge("switch"),fe(this.outputProperties,{extraTypes:["entityState"]}),$("#node-input-outputOnStateChange").on("change",(function(){$("#ha-custom-ouputs").toggle($(this).is(":checked"))}))},oneditsave:function(){this.outputProperties=$e(),$("#node-input-inputs").val($("#node-input-enableInput").is(":checked")?1:0)}},fn={category:Te.HomeAssistant,color:we.HaBlue,outputs:1,icon:"font-awesome/fa-tag",paletteLabel:"tag",label:function(){return this.name||"tag"},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("haTagVersion",0)},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},tags:{value:[""],required:!0,validate:function(e){return!!e.length}},devices:{value:[]},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}],validate:_e}},oneditprepare:function(){Se.setup(this),O(this);const e="__ALL_TAGS__",t=$("#tags"),n=$("#devices");let a=[];const i=this._;t.editableList({addButton:!0,removable:!0,height:"auto",header:$("<div>").append(i("ha-tag.label.tags")),addItem:function(t,n,o){const s=$("<div />").appendTo(t);$("<span />",{text:i("ha-tag.label.tag"),style:"padding-right: 74px;"}).appendTo(s),((t,n)=>{const o=$("<select>",{width:"70%"}).append($("<option>").attr({value:e,selected:n===e}).text(i("ha-tag.label.all_tags"))).appendTo(t);a.forEach((e=>{$("<option>").attr({value:e.id,selected:e.id===n}).text(e.name||e.id).appendTo(o)}))})(s,o)},buttons:[{label:i("ha-tag.label.update_tag_list"),icon:"fa fa-refresh",click:()=>{Re(s,"tags",{params:{update:!0}})}}]});function o(e,t){const n=e.name||e.tag_id,a=t.name||t.tag_id;return n===a?0:n.localeCompare(a)}const s=n=>{a=n.sort(o);const i=new Set;t.editableList("items").each((function(){const e=$(this).find("select").val();i.add(e)}));const s=Array.from(i).filter((t=>t===e||a.find((e=>e.id===t))));t.editableList("empty"),t.editableList("addItems",s),$("#no-tags-found").toggle(0===a.length)};Oe(this,"#node-input-server"),Ce("tags",(e=>{a=e,t.editableList("addItems",this.tags),s(e)})),$("#update-tag-list").on("click",(()=>{Re(s,"tags",{params:{update:!0}})})),n.editableList({addButton:!0,removable:!0,height:"auto",header:$("<div>").append(i("ha-tag.label.devices")),addItem:function(e,t,n){const a=$("<div />").appendTo(e);$("<span />",{text:i("ha-tag.label.device_id"),style:"padding-right: 35px;"}).appendTo(a);const o=$.isEmptyObject(n)?"":n;$("<input />",{type:"text",class:"input-device"}).appendTo(a).val(o)}}),n.editableList("addItems",this.devices),fe(this.outputProperties,{extraTypes:["eventData","tagId"]})},oneditsave:function(){const e=$("#tags").editableList("items"),t=$("#devices").editableList("items"),n=new Set,a=new Set;e.each((function(){const e=$(this).find("select").val();n.add(e)})),t.each((function(){const e=$(this).find(".input-device").val();e.trim().replace(/\s/g,"").length&&a.add(e)})),this.tags=Array.from(n),this.devices=Array.from(a),this.outputProperties=$e(),this.haConfig=x()}},bn={category:Te.HomeAssistant,color:we.HaBlue,outputs:1,icon:"font-awesome/fa-clock-o",paletteLabel:"time",label:function(){return this.name||(this.entityId?`${this.entityId}.${this.property||"state"}`:"time")},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("haTimeVersion",0)},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},entityId:{value:"",required:!0},property:{value:""},offset:{value:"0"},offsetType:{value:"num"},offsetUnits:{value:"minutes"},randomOffset:{value:!1},repeatDaily:{value:!1},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"entityState"},{property:"data",propertyType:"msg",value:"",valueType:"entity"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}],validate:_e},sunday:{value:!0},monday:{value:!0},tuesday:{value:!0},wednesday:{value:!0},thursday:{value:!0},friday:{value:!0},saturday:{value:!0},debugenabled:{value:!1},payload:{value:void 0},payloadType:{value:void 0}},oneditprepare:function(){Se.setup(this);const e=$("#node-input-server"),t=$("#node-input-entityId");Oe(this,"#node-input-server"),O(this),Et({root:"#node-input-entityId"}),$("#node-input-property").autocomplete({source:(n,a)=>{const i=function(e,t){if(!(e in v))return[];const n=t in v[e]?Object.keys(_(v[e][t])):Object.values(v[e]).map((e=>Object.keys(_(e))));return[...new Set([].concat(...n))].sort(((e,t)=>!e.includes(".")&&t.includes(".")?-1:e.includes(".")&&!t.includes(".")?1:e<t?-1:e>t?1:0))}(e.val(),t.val());a($.ui.autocomplete.filter(i,n.term))},minLength:0}),$("#node-input-offset").typedInput({types:["num","jsonata"],typeField:"#node-input-offsetType"}),$("#node-input-payload").typedInput({types:["str","num","bool","jsonata","date"],typeField:"#node-input-payloadType"}),$("#node-input-repeatDaily").on("change",(function(){$("#days-of-the-week").toggle($(this).is(":checked"))})).trigger("change"),fe(this.outputProperties,{extraTypes:["entityState","entityId","entity"]})},oneditsave:function(){this.haConfig=x(),this.outputProperties=$e()}},$n={category:Te.HomeAssistant,color:we.HaBlue,inputs:0,outputs:2,outputLabels:function(e){if(0===e)return"allowed";if(1===e)return"blocked";const t=this.customoutputs[e-2];let n;return n="always"===t.comparatorPropertyType?"always sent":`${t.comparatorPropertyType.replace("_"," ")} ${t.comparatorType.replace("_","")} ${t.comparatorValue}`,n},icon:"font-awesome/fa-map-signs",paletteLabel:"trigger: state",label:function(){return this.name||`trigger-state: ${this.entityid}`},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("triggerStateVersion",0)},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},entityid:{value:"",required:!0},entityidfiltertype:{value:"exact"},debugenabled:{value:!1},constraints:{value:[{targetType:"this_entity",targetValue:"",propertyType:"current_state",propertyValue:"new_state.state",comparatorType:"is",comparatorValueDatatype:"str",comparatorValue:""}]},inputs:{value:0},outputs:{value:2},customoutputs:{value:[]},outputinitially:{value:!1},state_type:{value:"str"},enableInput:{value:!1}},oneditprepare:function(){Se.setup(this);const e=$("#constraint-list"),t=$("#output-list");Oe(this,"#node-input-server",(e=>{n.serverChanged(e)}));const n=new sn({filterTypeSelector:"#node-input-entityidfiltertype",entityId:this.entityid,serverId:xe()});$("#dialog-form").data("entitySelector",n);let a=[],i=[],o=[];Ce("entities",(e=>{a=e})),Ce("properties",(e=>{i=e,o=[...e.map((e=>`new_state.${e}`)),...e.map((e=>`old_state.${e}`))].sort()})),O(this);const r=$("#node-input-outputs").val('{"0": 0, "1": 1}'),l=()=>JSON.parse(r.val()),u=e=>{r.val(JSON.stringify(e))},p=e=>{t.editableList("items").each((function(t){const n=$(this).data("data");e[Object.prototype.hasOwnProperty.call(n,"index")?n.index:n._index]=t+2}))};e.on("change",".target-type",(function(){const e=$(this),t="this_entity"===e.val(),n=e.parent().parent(),a=e.next(),i=n.find(".property-type");t?a.attr("disabled","disabled").val(""):a.removeAttr("disabled"),i.find("option[value=previous_state]").toggle(t),"previous_state"===i.val()&&i.val("current_state").trigger("change")})),e.on("change",".property-type",(function(e){const t=e.target.value;"current_state"===t||"previous_state"===t?$(this).next().attr("disabled","disabled").val(""):$(this).next().removeAttr("disabled")})),t.on("change",".comparator-property-type",(function(e){const t=e.target.value,n=$(this).parent().parent(),a=n.find(".comparator-type"),i=n.find(".comparator-value"),o=n.find(".comparator-property-value");switch(t){case"always":o.attr("disabled","disabled"),a.attr("disabled","disabled"),i.attr("disabled","disabled"),o.val("");break;case"previous_state":case"current_state":o.attr("disabled","disabled"),a.removeAttr("disabled"),i.removeAttr("disabled"),o.val("");break;case"property":o.removeAttr("disabled"),a.removeAttr("disabled"),i.removeAttr("disabled")}}));e.editableList({addButton:!0,removable:!0,height:"auto",header:$("<div>").append(s("trigger-state.label.conditions")),addItem:(e,t,n)=>{if($("#constraint-template").children().clone().appendTo(e),e.find(".target-value").autocomplete({source:(e,t)=>{const n=e.term.toLowerCase(),i=a.filter((e=>e.includes(n)));t(i)},minLength:0}),e.find(".property-value").autocomplete({source:(t,n)=>{const a=t.term.toLowerCase();n(("this_entity"===e.find(".target-type").val()?o:i).filter((e=>e.includes(a))))},minLength:0}),e.find(".comparator-value").typedInput({default:"str",types:["str","num","bool","re","jsonata",{value:"entity",label:"entity."},{value:"prevEntity",label:"prev entity."}]}),$.isEmptyObject(n))return;e.find(".target-type").val(n.targetType).trigger("change"),e.find(".target-value").val(n.targetValue),e.find(".property-type").val(n.propertyType).trigger("change"),"property"===n.propertyType&&e.find(".property-value").val(n.propertyValue),e.find(".comparator-type").val(n.comparatorType);const s=e.find(".comparator-value");s.typedInput("type",n.comparatorValueDatatype),s.typedInput("value",n.comparatorValue)}}),e.editableList("addItems",this.constraints.length?this.constraints:[]),t.on("change",".message-type",(function(e){const t=e.target.value;$(this).parent().find(".message-value").typedInput("default"===t?"hide":"show")})),t.on("change",".comparator-property-type",(function(e){const t=e.target.value,n=$(this).parent().parent(),a=n.find(".comparator-property-value"),i=n.find(".comparator-type"),o=n.find(".comparator-value");switch(t){case"always":a.attr("disabled","disabled"),i.attr("disabled","disabled"),o.typedInput("hide"),a.val("");break;case"previous_state":case"current_state":a.attr("disabled","disabled"),i.removeAttr("disabled"),o.typedInput("show"),a.val("");break;case"property":a.removeAttr("disabled"),i.removeAttr("disabled"),o.typedInput("show")}})),t.editableList({addButton:!0,removable:!0,sortable:!0,height:"auto",header:$("<div>").append("Custom outputs"),addItem:function(e,t,n){n.hasOwnProperty("condition")||(n.condition={});const a=n.condition;n.hasOwnProperty("index")||(n._index=Math.floor(563609*Math.random()).toString()),$("#output-template").children().clone().appendTo(e),e.css({overflow:"hidden",whiteSpace:"nowrap"}),e.find(".message-value").typedInput({default:"json",types:["str","num","bool","json"]}),e.find(".comparator-property-value").autocomplete({source:(e,t)=>{const n=e.term.toLowerCase();t(o.filter((e=>e.includes(n))))},minLength:0}),e.find(".comparator-value").typedInput({default:"str",types:["str","num","bool","re","jsonata",{value:"entity",label:"entity."},{value:"prevEntity",label:"prev entity."}]});const i=l();if(i[n.hasOwnProperty("index")?n.index:n._index]=t+2,u(i),$.isEmptyObject(a))return void e.find(".message-type,.comparator-property-type").trigger("change");e.find(".message-type").val(a.messageType).trigger("change");const s=e.find(".message-value");s.typedInput("value",a.messageValue),s.typedInput("type",a.messageValueType),e.find(".comparator-property-type").val(a.comparatorPropertyType).trigger("change"),"property"===a.comparatorPropertyType&&e.find(".comparator-property-value").val(a.comparatorPropertyValue),e.find(".comparator-type").val(a.comparatorType);const r=e.find(".comparator-value");r.typedInput("value",a.comparatorValue),r.typedInput("type",a.comparatorValueDataType)},removeItem:function(e){const t=l();Object.prototype.hasOwnProperty.call(e,"index")?t[e.index]=-1:delete t[e._index],p(t),u(t)},sortItems:function(){const e=l();p(e),u(e)}}),this.customoutputs.forEach(((e,n)=>t.editableList("addItem",{condition:e,index:n+2})))},oneditsave:function(){const e=$("#constraint-list").editableList("items"),t=$("#output-list").editableList("items"),n=[],a=[];e.each((function(){const e=$(this),t=e.find(".comparator-value"),a={targetType:e.find(".target-type").val(),targetValue:e.find(".target-value").val(),propertyType:e.find(".property-type").val(),propertyValue:e.find(".property-value").val(),comparatorType:e.find(".comparator-type").val(),comparatorValueDatatype:t.typedInput("type"),comparatorValue:t.typedInput("value")};"current_state"===a.propertyType?a.propertyValue="new_state.state":"previous_state"===a.propertyType&&(a.propertyValue="old_state.state"),"includes"!==a.comparatorType&&"does_not_include"!==a.comparatorType||(a.comparatorValueDatatype="list"),n.push(a)})),t.each((function(){const e=$(this),t=e.find(".message-value"),n=e.find(".comparator-value"),i={messageType:e.find(".message-type").val(),messageValue:t.typedInput("value"),messageValueType:t.typedInput("type"),comparatorPropertyType:e.find(".comparator-property-type").val(),comparatorPropertyValue:e.find(".comparator-property-value").val(),comparatorType:e.find(".comparator-type").val(),comparatorValue:n.typedInput("value"),comparatorValueDataType:n.typedInput("type")};"current_state"===i.comparatorPropertyType?i.comparatorPropertyValue="new_state.state":"previous_state"===i.comparatorPropertyType&&(i.comparatorPropertyValue="old_state.state"),"includes"!==i.comparatorType&&"does_not_include"!==i.comparatorType||(i.comparatorValueDataType="list"),a.push(i)})),$("#node-input-inputs").val($("#node-input-enableInput").is(":checked")?1:0),this.constraints=n,this.customoutputs=a,this.haConfig=x();const i=$("#dialog-form").data("entitySelector");this.entityid=i.entityId,i.destroy()},oneditcancel:function(){$("#dialog-form").data("entitySelector").destroy()}},_n={category:Te.HomeAssistantEntities,color:we.HaBlue,inputs:1,outputs:1,icon:"font-awesome/fa-asterisk",align:"right",paletteLabel:"update config",label:function(){return this.name||"update config"},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},entityConfig:{value:"",type:a.EntityConfig,required:!1},version:{value:RED.settings.get("haSensorVersion",0)},outputProperties:{value:[],validate:_e}},oneditprepare:function(){Se.setup(this),Oe(this,"#node-input-server"),"_ADD_"===this.entityConfig&&$("#node-input-entityConfig").val("_ADD_"),fe(this.outputProperties)},oneditsave:function(){this.outputProperties=$e()}},Tn={category:Te.HomeAssistant,color:we.HaBlue,inputs:1,outputs:1,outputLabels:["","timed out"],icon:"ha-wait-until.svg",paletteLabel:"wait until",label:function(){return this.name||"wait until"},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("haWaitUntilVersion",0)},outputs:{value:1},entityId:{value:""},entityIdFilterType:{value:"exact"},property:{value:""},comparator:{value:"is"},value:{value:""},valueType:{value:"str"},timeout:{value:"0"},timeoutType:{value:"num"},timeoutUnits:{value:"seconds"},checkCurrentState:{value:!0},blockInputOverrides:{value:!0},outputProperties:{value:[]},entityLocation:{value:"data"},entityLocationType:{value:"none"}},oneditprepare:function(){Se.setup(this),Oe(this,"#node-input-server",(e=>{t.serverChanged(e)}));const t=new sn({filterTypeSelector:"#node-input-entityIdFilterType",entityId:this.entityId,serverId:xe()});$("#dialog-form").data("entitySelector",t);let a=[];Ce("properties",(e=>{a=e,$("#node-input-property").autocomplete({source:a,minLength:0})}));const o={value:"entity",label:"entity."},s=[i.String,i.Number,i.Boolean,i.Regex,i.JSONata,i.Message,i.Flow,i.Global,o];$("#node-input-value").typedInput({default:i.String,types:s,typeField:"#node-input-valueType"}),$("#node-input-comparator").on("change",(function(){let t=s;const n=$(this).val();switch($("#node-input-property").prop("disabled","jsonata"===n),n){case e.Is:case e.IsNot:break;case e.IsLessThan:case e.IsLessThanOrEqual:case e.IsGreaterThan:case e.IsGreaterThanOrEqual:t=[i.Number,i.JSONata,i.Message,i.Flow,i.Global,o];break;case e.Includes:case e.DoesNotInclude:t=[i.String,i.JSONata,i.Message,i.Flow,i.Global];break;case e.JSONata:t=[i.JSONata]}$("#node-input-value").typedInput("types",t)}));const r=this;$("#node-input-timeout").typedInput({default:i.Number,types:[i.Number,i.JSONata],typeField:"#node-input-timeoutType"}).on("change",(function(e,t){!0!==t&&(r.outputs=t===i.JSONata||t===i.Number&&Number($(this).val())>0?2:1)}));const l=$("#node-input-entityIdFilterType");l.on("change",(function(){$(".exact-only").toggle(l.val()===n.Exact)})),fe(this.outputProperties,{extraTypes:["entity"]})},oneditsave:function(){this.outputProperties=$e();const e=$("#dialog-form").data("entitySelector");this.entityId=e.entityId,e.destroy()},oneditcancel:function(){$("#dialog-form").data("entitySelector").destroy()}};function wn(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return Array.from({length:e},(()=>t[Math.floor(Math.random()*t.length)])).join("")}const Sn={category:Te.HomeAssistant,color:we.HaBlue,outputs:1,outputLabels:"",icon:"ha-webhook.svg",paletteLabel:"webhook",label:function(){return this.name||"webhook"},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("haWebhookVersion",0)},outputs:{value:1},webhookId:{value:wn(32),required:!0},outputProperties:{value:[{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"},{property:"payload",propertyType:"msg",value:"",valueType:"data"}],validate:_e},payloadLocation:{value:!1},payloadLocationType:{value:!1},headersLocation:{value:!1},headersLocationType:{value:!1}},oneditprepare:function(){Se.setup(this),Oe(this,"#node-input-server"),O(this);const e=$("#node-input-webhookId");$("#copyId").on("click",(function(){const t=e.get(0),n=t.value;t.value=`https://<ip>:<port>/api/webhook/${n}`,t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),t.value=n})),$("#refresh").on("click",(function(){e.val(wn(32))})),fe(this.outputProperties,{extraTypes:["receivedData","headers","params","triggerId"]})},oneditsave:function(){this.outputProperties=$e()}},Dn={category:Te.HomeAssistant,color:we.HaBlue,outputs:1,icon:"font-awesome/fa-map-marker",paletteLabel:"zone",label:function(){return this.name||"zone"},labelStyle:Se.labelStyle,defaults:{name:{value:""},server:{value:"",type:a.Server,required:!0},version:{value:RED.settings.get("haZoneVersion",0)},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},entities:{value:[""],required:!0,validate:e=>!!e.length},event:{value:"enter"},zones:{value:[""],required:!0,validate:e=>!!e.length}},oneditprepare:function(){Se.setup(this);const e=$("#entities"),t=$("#zones");Oe(this,"#node-input-server"),O(this),e.editableList({addButton:!0,removable:!0,height:"auto",header:$("<div>").append("Entities"),addItem:function(e,t,n){const a=$("<div />").appendTo(e);$("<span />",{text:"Entity",style:"padding-right: 35px;"}).appendTo(a);const i=$.isEmptyObject(n)?"":n;Et({root:$("<input />",{type:"text",class:"input-entity"}).appendTo(a).val(i),options:{type:"trackers"}})}}),e.editableList("addItems",this.entities),t.editableList({addButton:!0,removable:!0,height:"auto",header:$("<div>").append("zones"),addItem:function(e,t,n){const a=$("<div />").appendTo(e);$("<span />",{text:"Zone",style:"padding-right: 35px;"}).appendTo(a);const i=$.isEmptyObject(n)?"":n;Et({root:$("<input />",{type:"text",class:"input-zone"}).appendTo(a).val(i),options:{type:"zones"}})}}),t.editableList("addItems",this.zones)},oneditsave:function(){const e=$("#entities").editableList("items"),t=$("#zones").editableList("items"),n=new Set,a=new Set;e.each((function(){const e=$(this).find(".input-entity").val().replace(/\s/g,"");e.length&&n.add(e)})),t.each((function(){const e=$(this).find(".input-zone").val().replace(/\s/g,"");e.length&&a.add(e)})),this.entities=Array.from(n),this.zones=Array.from(a),this.haConfig=x()}};RED.comms.subscribe("homeassistant/areas/#",(function(e,t){const n=h(e);d[n]=t})),RED.comms.subscribe("homeassistant/devices/#",(function(e,t){const n=h(e);c[n]=t})),RED.comms.subscribe("homeassistant/entity/#",(function(e,t){const n=h(e);v[n]||(v[n]={}),v[n][t.entity_id]=t})),RED.comms.subscribe("homeassistant/entities/#",(function(e,t){const n=h(e);v[n]=t})),RED.comms.subscribe("homeassistant/integration/#",(function(e,t){const n=e.split("/")[2];I[n]=t.version})),RED.comms.subscribe("homeassistant/services/#",(function(e,t){const n=h(e);y[n]=t})),RED.comms.subscribe("homeassistant/targetDomains/#",(function(e,t){const n=h(e);g[n]=t})),RED.comms.subscribe("home-assistant-print-to-debug",(function(e,t){RED.debug.handleDebugMessage(t)})),function(){const e="home-assistant.ui.migrations",t=s(`${e}.title`),n=s(`${e}.warning`),a=s(`${e}.message`),i=s(`${e}.button_label`),o=s("home-assistant.ui.notifications.attention"),r=$.parseHTML(`<div id="ha-dialog-confirm" title="${t}">\n            ${a}\n            <div class="ui-state-error ha-alert-box"><strong>${o}:</strong> ${n}</div>\n        </div>`),l=$.parseHTML(`<li><button id="upgrade-ha-node"><i class="fa fa-refresh"></i> ${i}</button></li>`);$("body").append(r),$("#red-ui-header .red-ui-header-toolbar").prepend(l)}(),se=$("#upgrade-ha-node"),se.hide(),se.on("click",le),RED.editor.registerTypeEditor("ha_entity_filter",S),RED.events.on("nodes:add",(function(e){pe(e)&&!ue(e)&&se.show()})),RED.events.on("nodes:remove",(function(e){se.is(":visible")&&pe(e)&&0===ce()&&se.hide()})),RED.events.on("editor:open",(function(){var e;const t=RED.view.selection(),n=null===(e=null==t?void 0:t.nodes)||void 0===e?void 0:e[0];n&&pe(n)&&!ue(n)&&(re(n),RED.nodes.dirty(!0),RED.notify(s("home-assistant.ui.migrations.node_schema_updated")))})),RED.nodes.registerType(a.DeviceConfig,Ft),RED.nodes.registerType(a.EntityConfig,Gt),RED.nodes.registerType(a.Server,It),RED.nodes.registerType(a.API,Ve),RED.nodes.registerType(a.CallSevice,_t),RED.nodes.registerType(a.CurrentState,xt),RED.nodes.registerType(a.Device,Vt),RED.nodes.registerType(a.Entity,Mt),RED.nodes.registerType(a.EventsAll,Wt),RED.nodes.registerType(a.EventsState,rn),RED.nodes.registerType(a.FireEvent,ln),RED.nodes.registerType(a.GetEntities,un),RED.nodes.registerType(a.GetHistory,pn),RED.nodes.registerType(a.PollState,dn),RED.nodes.registerType(a.RenderTemplate,vn),RED.nodes.registerType(a.Tag,fn),RED.nodes.registerType(a.Time,bn),RED.nodes.registerType(a.TriggerState,$n),RED.nodes.registerType(a.WaitUntil,Tn),RED.nodes.registerType(a.Webhook,Sn),RED.nodes.registerType(a.Zone,Dn),RED.nodes.registerType(a.BinarySensor,Ke),RED.nodes.registerType(a.Button,Xe),RED.nodes.registerType(a.Sensor,hn),RED.nodes.registerType(a.Switch,mn),RED.nodes.registerType(a.UpdateConfig,_n)}();</script>
<script type="text/html" data-template-name="ha_entity_filter"><div class="form-row ha-entity-search-row"><label data-i18n="home-assistant.label.filter_results_label"></label> <input type="text"></div><div class="form-row ha-entity-search-row"><ul></ul></div></script>
<script type="text/html" data-template-name="ha-api"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name">Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server">Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-protocol">Protocol</label> <select type="text" id="node-input-protocol" style="width:70%"><option value="websocket">WebSocket</option><option value="http">HTTP</option></select></div><div class="form-row http"><label for="node-input-method">Method</label> <select type="text" id="node-input-method" style="width:70%"><option value="get">GET</option><option value="post">POST</option></select></div><div class="form-row http"><label for="node-input-path">Path</label> <input type="text" id="node-input-path" placeholder="config"></div><div class="form-row"><label id="data-label" for="node-input-data">Data</label> <input type="text" id="node-input-data" style="width:70%"> <input type="hidden" id="node-input-dataType"></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row http"><label for="node-input-responseType">Return</label> <select id="node-input-responseType" style="width:70%"><option value="text">a UTF-8 string</option><option value="arraybuffer">a binary buffer</option><option value="json">a parsed JSON object</option></select></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled">Show Debug Information</label></div></script>
<script type="text/html" data-template-name="ha-binary-sensor"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><span data-i18n="home-assistant.label.name"></span></label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-entityConfig"><span data-i18n="home-assistant.label.entity_config"></span></label> <input type="text" id="node-input-entityConfig"></div><div class="form-row"><label for="node-input-state"><span data-i18n="ha-binary-sensor.label.state"></span></label> <input type="text" id="node-input-state" style="width:70%"> <input type="hidden" id="node-input-stateType"></div><div class="form-row"><ol id="attributes"></ol></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row"><label for="node-input-inputOverride"><span data-i18n="ha-binary-sensor.label.input_override"></span></label> <select id="node-input-inputOverride" style="width:68%"><option value="allow">Allow</option><option value="merge">Merge</option><option value="block">Block</option></select></div></script>
<style>#version-update{margin-bottom:1em;padding:.5em}#version-update p{margin:0}#version-update strong{padding-right:5px}#version-update a,#version-update a:hover{color:var(--red-ui-primary-text-color)}.home-assistant .form-row.checkbox-option input{display:inline-block;margin-left:105px;margin-right:5px;vertical-align:top;width:auto}.home-assistant .form-row.checkbox-option label{width:auto}.home-assistant .form-row.checkbox-option-left input{display:inline-block;margin-right:5px;vertical-align:top;width:auto}.home-assistant .form-row.checkbox-option-left label{margin-right:20px;width:auto}.home-assistant .form-row.add-spacer{border-bottom:1px solid var(--red-ui-primary-text-color)}.home-assistant .form-row>select{width:70%}.home-assistant .form-row .ha-multi-item-row{display:inline-flex;gap:10px;width:70%}.home-assistant .form-row .ha-multi-item-row select{width:auto}.home-assistant .form-row .ha-multi-item-row .red-ui-typedInput-container{flex:1;width:auto}.home-assistant .editable-list-row{margin-bottom:4px}.home-assistant li span.property-type{color:var(--red-ui-primary-text-color);float:right;font-family:Helvetica Neue,Arial,Helvetica,sans-serif;font-size:11px;font-style:italic}.home-assistant .ha-alert-box,.home-assistant .ha-alpha-box,.home-assistant .ha-beta-box{border-radius:4px;margin-bottom:10px;padding:10px}.home-assistant .ha-alpha-box{background-color:#e78bb9;color:#702323}.home-assistant .ha-beta-box{background-color:#7d7;color:#853e3d}#constraint-list{min-width:446px}#constraint-list input{width:65%}#output-list input{width:62%}#clearIfState{margin-left:2px;position:absolute}.ha-node-label-legacy{fill:#fdfd96}.home-assistant-custom-block .custom-block-title{font-weight:600}.home-assistant-custom-block.danger,.home-assistant-custom-block.tip,.home-assistant-custom-block.warning{border-left-style:solid;border-left-width:.5rem;margin:1rem 0;padding:.1rem 1.5rem}.home-assistant-custom-block.tip{background-color:#f3f5f7;border-color:#42b983;color:#2c3e50}.home-assistant-custom-block.tip a{color:#3eaf7c}.home-assistant-custom-block.warning{background-color:#fff6c6;border-color:#e7c000;color:#6b5900}.home-assistant-custom-block.warning .custom-block-title{color:#b29400}.home-assistant-custom-block.warning a{color:#2c3e50}.home-assistant-custom-block.danger{background-color:#ffe6e6;border-color:#c00;color:#4d0000}.home-assistant-custom-block.danger .custom-block-title{color:#900}.home-assistant-custom-block.danger a{color:#2c3e50}.home-assisant-badge{border-radius:3px;color:#fff;display:inline-block;font-size:12px;height:16px;line-height:16px;padding:0 6px}.home-assisant-badge,.home-assisant-badge.green,.home-assisant-badge.tip{background-color:#42b983}.home-assisant-badge.error{background-color:#da5961}.home-assisant-badge.warn,.home-assisant-badge.warning,.home-assisant-badge.yellow{background-color:#e7c000}.home-assisant-badge+.home-assisant-badge{margin-left:5px}#upgrade-ha-node{background:#41bdf5;border:0;color:#eee;display:inline-block;font-size:14px;line-height:22px;margin:0;padding:4px 12px;text-decoration:none}.ui-autocomplete .ui-menu-item-wrapper .sublabel{color:var(--red-ui-secondary-text-color);font-size:smaller;margin:4px 0}</style>
<script type="text/html" data-template-name="ha-button"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><span data-i18n="home-assistant.label.name"></span></label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-entityConfig"><span data-i18n="home-assistant.label.entity_config"></span></label> <input type="text" id="node-input-entityConfig"></div><div class="form-row"><ol id="custom-outputs"></ol></div></script>
<style>.ha-entity-selector{align-items:flex-end;display:inline-flex;gap:10px;width:70%}.ha-entity-selector>input[type=text]{flex:1}.ha-entity-selector .select2-container{flex:1;width:auto}.ha-entity-selector .select2-container .select2-search--inline .select2-search__field{height:22px}#node-input-entityIdFilterType,#node-input-entityidfiltertype{width:auto}.home-assistant .ha-entity-search-row{align-items:baseline;display:flex;margin-bottom:10px}.home-assistant .ha-entity-search-row label{display:inline;width:auto}.home-assistant .ha-entity-search-row input{background-color:var(--red-ui-form-input-background);border:1px solid var(--red-ui-form-input-border-color);border-radius:4px;box-sizing:border-box;color:var(--red-ui-primary-text-color);display:inline-block;flex:1;font-size:14px;height:34px;line-height:20px;margin-bottom:10px;margin-left:10px;padding:6px;vertical-align:middle}.home-assistant .ha-entity-search-row input:focus{border-color:var(--red-ui-form-input-border-color-focus);outline:0}.home-assistant .ha-entity-search-row ul{list-style:none;margin:0;overflow:hidden;overflow-y:auto;padding:0}</style>
<script type="text/html" data-template-name="api-call-service"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name" data-i18n="home-assistant.label.name"></label> <input type="text" id="node-input-name"></div><div class="form-row"><label for="node-input-server" data-i18n="home-assistant.label.server"></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-domain" data-i18n="api-call-service.label.domain"></label> <select id="node-input-domain" style="width:70%"></select></div><div class="form-row"><label for="node-input-service" data-i18n="api-call-service.label.service"></label> <select id="node-input-service" style="width:70%"></select></div><div class="form-row"><label for="node-input-areaId" data-i18n="api-call-service.label.area"></label> <select id="node-input-areaId" multiple="multiple" style="width:70%"></select></div><div class="form-row"><label for="node-input-deviceId" data-i18n="api-call-service.label.device"></label> <select id="node-input-deviceId" multiple="multiple" style="width:70%"></select></div><div class="form-row"><label for="node-input-entityId" data-i18n="api-call-service.label.entity"></label> <select id="node-input-entityId" multiple="multiple" style="width:70%"></select></div><div class="form-row"><label for="node-input-data" data-i18n="api-call-service.label.data"></label> <input type="text" id="node-input-data" style="width:70%"> <input type="hidden" id="node-input-dataType"></div><div class="form-row checkbox-option" id="mustacheAltTags"><input type="checkbox" id="node-input-mustacheAltTags">&nbsp; <label for="node-input-mustacheAltTags" data-i18n="api-call-service.label.alternate_tags"></label></div><div class="form-row"><label for="node-input-mergeContext" data-i18n="api-call-service.label.merge_context"></label> <input type="text" id="node-input-mergeContext" placeholder="lightOptions"></div><div class="form-row"><label for="node-input-queue" data-i18n="api-call-service.label.queue"></label> <select type="text" id="node-input-queue"><option value="none" data-i18n="api-call-service.label.queue_none"></option><option value="first" data-i18n="api-call-service.label.queue_first"></option><option value="all" data-i18n="api-call-service.label.queue_all"></option><option value="last" data-i18n="api-call-service.label.queue_last"></option></select></div><div class="form-row"><ol id="custom-outputs"></ol></div><div id="service-data-desc" class="form-row"><button id="example-data" style="float:right" class="red-ui-button red-ui-button-small" data-i18n="api-call-service.label.load_example_data"></button><h4>Service: <span class="title"></span></h4><div class="unknown-service">Unknown domain or service</div><div class="known-service"><p class="service-description"></p><table id="service-data-table" class="red-ui-info-table"><thead><tr><th>Property</th><th>Desc</th><th>Example</th></tr></thead><tbody></tbody></table></div></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled" data-i18n="api-call-service.label.show_debug"></label></div></script>
<script type="text/html" data-template-name="server"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-config-input-name" data-i18n="home-assistant.label.name"></label> <input type="text" id="node-config-input-name"></div><div class="form-row checkbox-option"><input type="checkbox" id="node-config-input-addon"> <label for="node-config-input-addon" data-i18n="config-server.label.using_add_on"></label></div><div class="form-row addon checkbox-option"><input type="checkbox" id="node-config-input-connectionDelay"> <label for="node-config-input-connectionDelay" data-i18n="config-server.label.delay_connection_attempts"></label></div><div id="server-info"><div class="form-row"><label for="node-config-input-host" data-i18n="config-server.label.base_url"></label><div style="width:70%;display:inline-flex"><input type="text" id="node-config-input-host" placeholder="http://localhost:8123" style="flex-grow:1"> <a id="discoverInstances" class="red-ui-button" style="margin-left:10px"><i class="fa fa-search"></i></a></div></div><div class="form-row"><label id="access-token-label" for="node-config-input-access_token" data-i18n="config-server.label.access_token"></label> <input type="text" id="node-config-input-access_token" placeholder="access token"></div><div class="form-row checkbox-option"><input type="checkbox" id="accept_unauthorized_certs"> <label for="accept_unauthorized_certs" data-i18n="config-server.label.accept_all_certs"></label></div></div><div class="form-row"><label for="node-config-input-ha_boolean" data-i18n="config-server.label.state_boolean_list"></label> <input type="text" id="node-config-input-ha_boolean" placeholder="y|yes|true|on|home|open"></div><div class="form-row checkbox-option"><input type="checkbox" id="node-config-input-heartbeat"> <label for="node-config-input-heartbeat" data-i18n="config-server.label.enable_heartbeat"></label></div><div class="form-row" id="heartbeatIntervalRow"><label for="node-config-input-heartbeatInterval" data-i18n="config-server.label.heartbeat_interval"></label><div style="vertical-align:text-bottom;width:70%;display:inline-block"><input type="number" id="node-config-input-heartbeatInterval" style="width:30%" min="10"> <span data-i18n="config-server.label.seconds"></span></div></div><div class="form-row checkbox-option"><input type="checkbox" id="node-config-input-enableGlobalContextStore"> <label for="node-config-input-enableGlobalContextStore" data-i18n="config-server.label.enable_global_context_store"></label></div><div class="form-row" data-i18n="config-server.label.ui_settings"></div><div class="form-row checkbox-option"><input type="checkbox" id="node-config-input-cacheJson"> <label for="node-config-input-cacheJson" data-i18n="config-server.label.cache_autocomplete_results"></label></div><div class="form-row"><span data-i18n="config-server.label.id_selector"></span></div><div class="form-row"><label for="node-config-input-areaSelector" data-i18n="config-server.label.area_selector"></label> <select id="node-config-input-areaSelector"><option value="id" data-i18n="config-server.label.id"></option><option value="friendlyName" data-i18n="config-server.label.friendly_name"></option></select></div><div class="form-row"><label for="node-config-input-deviceSelector" data-i18n="config-server.label.device_selector"></label> <select id="node-config-input-deviceSelector"><option value="id" data-i18n="config-server.label.id"></option><option value="friendlyName" data-i18n="config-server.label.friendly_name"></option></select></div><div class="form-row"><label for="node-config-input-entitySelector" data-i18n="config-server.label.entity_selector"></label> <select id="node-config-input-entitySelector"><option value="id" data-i18n="config-server.label.id"></option><option value="friendlyName" data-i18n="config-server.label.friendly_name"></option></select></div><div class="form-row"><span data-i18n="config-server.label.status.title"></span></div><div class="form-row"><label data-i18n="config-server.label.status.separator"></label> <input id="node-config-input-statusSeparator" type="text"></div><div class="form-row"><label data-i18n="config-server.label.status.year"></label> <select id="node-config-input-statusYear"><option value="hidden" data-i18n="config-server.label.status.hidden"></option><option value="numeric" data-i18n="config-server.label.status.numeric"></option><option value="2-digit" data-i18n="config-server.label.status.two_digit"></option></select></div><div class="form-row"><label data-i18n="config-server.label.status.month"></label> <select id="node-config-input-statusMonth"><option value="hidden" data-i18n="config-server.label.status.hidden"></option><option value="numeric" data-i18n="config-server.label.status.numeric"></option><option value="2-digit" data-i18n="config-server.label.status.two_digit"></option><option value="long" data-i18n="config-server.label.status.long"></option><option value="short" data-i18n="config-server.label.status.short"></option></select></div><div class="form-row"><label data-i18n="config-server.label.status.day"></label> <select id="node-config-input-statusDay"><option value="hidden" data-i18n="config-server.label.status.hidden"></option><option value="numeric" data-i18n="config-server.label.status.numeric"></option><option value="2-digit" data-i18n="config-server.label.status.two_digit"></option></select></div><div class="form-row"><label data-i18n="config-server.label.status.hour_cycle"></label> <select id="node-config-input-statusHourCycle"><option value="default" data-i18n="config-server.label.status.default"></option><option value="h12" data-i18n="config-server.label.status.12_hour_format"></option><option value="h23" data-i18n="config-server.label.status.24_hour_format"></option></select></div><div class="form-row"><label data-i18n="config-server.label.status.time_format"></label> <select id="node-config-input-statusTimeFormat"><option value="h:m">hour and minutes</option><option value="h:m:s">hour, minutes, and seconds</option><option value="h:m:s.ms">hour, minutes, seconds and milliseconds</option></select></div></script>
<script type="text/html" data-template-name="api-current-state"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"> <input type="hidden" id="node-input-outputs"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entity_id"><i class="fa fa-cube"></i> Entity ID</label> <input type="text" id="node-input-entity_id"></div><div class="form-row"><label for="node-input-halt_if_compare"><i class="fa fa-check-square"></i> If State</label> <select type="text" id="node-input-halt_if_compare" style="width:20%"><option value="is">is</option><option value="is_not">is not</option><option value="lt">&lt;</option><option value="lte">&lt;=</option><option value="gt">&gt;</option><option value="gte">&gt;=</option><option value="includes">in</option><option value="does_not_include">not in</option><option value="jsonata">JSONata</option></select> <input type="text" id="node-input-halt_if" style="width:50%"> <input type="hidden" id="node-input-halt_if_type"></div><div class="form-row" id="for-row"><label for="node-input-for"><i class="fa fa-clock-o"></i> For</label> <input type="text" id="node-input-for" style="width:45%"> <input type="hidden" id="node-input-forType"> <select id="node-input-forUnits" style="width:25%"><option value="milliseconds">milliseconds</option><option value="seconds">seconds</option><option value="minutes">minutes</option><option value="hours">hours</option><option value="days">days</option></select></div><div class="form-row"><label for="node-input-state_type"><i class="fa fa-tint"></i> State Type</label> <select type="text" id="node-input-state_type" style="width:auto"><option value="str">String</option><option value="num">Number</option><option value="habool">Boolean</option></select></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-blockInputOverrides">&nbsp; <label for="node-input-blockInputOverrides">Block Input Overrides</label></div></script>
<script type="text/html" data-template-name="ha-device"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name" data-i18n="ha-device.label.name"><i class="fa fa-tag"></i></label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server" data-i18n="ha-device.label.server"><i class="fa fa-server"></i></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-deviceType"><span data-i18n="ha-device.label.type"></span></label> <select id="node-input-deviceType" style="width:70%"><option value="trigger" data-i18n="ha-device.label.trigger"></option><option value="action" data-i18n="ha-device.label.action"></option></select></div><div class="form-row"><label for="node-input-device" data-i18n="ha-device.label.device"></label> <select id="node-input-device" style="width:70%"></select></div><div class="form-row"><label for="event" data-i18n="ha-device.label.trigger"></label> <select id="event" style="width:70%" disabled="disabled"></select></div><div class="form-row"><ol id="custom-outputs"></ol></div></script>
<style>.select2-container--nodered{font-family:var(--red-ui-primary-font)}.select2-container--nodered .select2-selection--single{background-color:var(--red-ui-form-background);border:1px solid var(--red-ui-form-input-border-color);border-radius:4px;height:34px!important}.select2-container--nodered .select2-selection--single .select2-selection__rendered{color:var(--red-ui-form-text-color);line-height:34px}.select2-container--nodered .select2-selection--single .select2-selection__clear{cursor:pointer;float:right;font-weight:700;height:34px;margin-right:20px;padding-right:0}.select2-container--nodered .select2-selection--single .select2-selection__placeholder{color:var(--red-ui-form-placeholder-color)}.select2-container--nodered .select2-selection--single .select2-selection__arrow{height:34px;position:absolute;right:1px;top:1px;width:20px}.select2-container--nodered .select2-selection--single .select2-selection__arrow b{border-color:var(--red-ui-secondary-text-color) transparent transparent transparent;border-style:solid;border-width:5px 4px 0;height:0;left:50%;margin-left:-4px;margin-top:-2px;position:absolute;top:50%;width:0}.select2-container--nodered .select2-selection--single:focus{border-color:var(--red-ui-form-input-border-color-focus);outline-color:var(--red-ui-form-text-color);outline:0}.select2-container--nodered[dir=rtl] .select2-selection--single .select2-selection__clear{float:left}.select2-container--nodered[dir=rtl] .select2-selection--single .select2-selection__arrow{left:1px;right:auto}.select2-container--nodered.select2-container--disabled .select2-selection--single{background-color:var(--red-ui-list-item-background);cursor:default}.select2-container--nodered.select2-container--disabled .select2-selection--single .select2-selection__clear{display:none}.select2-container--nodered.select2-container--open .select2-selection--single .select2-selection__arrow b{border-color:transparent transparent var(--red-ui-secondary-text-color) transparent;border-width:0 4px 5px}.select2-container--nodered .select2-selection--multiple{background-color:var(--red-ui-form-background);border:1px solid var(--red-ui-form-input-border-color);border-radius:4px;cursor:text;min-height:34px;padding-bottom:5px;position:relative}.select2-container--nodered .select2-selection--multiple .select2-selection__rendered{margin:0}.select2-container--nodered .select2-selection--multiple.select2-selection--clearable{padding-right:25px}.select2-container--nodered .select2-selection--multiple .select2-selection__clear{cursor:pointer;font-weight:700;height:20px;margin-right:10px;margin-top:5px;padding:1px;position:absolute;right:0}.select2-container--nodered .select2-selection--multiple .select2-selection__choice{border-bottom:1px solid var(--red-ui-form-input-border-color);box-sizing:border-box;display:inline-block;max-width:100%;overflow:hidden;padding:4px 24px 4px 4px;position:relative;text-overflow:ellipsis;vertical-align:bottom;white-space:nowrap;width:100%}.select2-container--nodered .select2-selection--multiple .select2-selection__choice__display{cursor:default;padding-left:2px;padding-right:5px}.select2-container--nodered .select2-selection--multiple .select2-selection__choice__remove{background-color:transparent;border:none;border-left:1px solid var(--red-ui-form-input-border-color);color:var(--red-ui-list-item-secondary-color);cursor:pointer;font-size:1.5em;font-weight:700;padding:4px;position:absolute;right:0;top:0}.select2-container--nodered .select2-selection--multiple .select2-selection__choice__remove:focus,.select2-container--nodered .select2-selection--multiple .select2-selection__choice__remove:hover{background-color:var(--red-ui-list-item-background);color:var(--red-ui-list-item-background-selected);outline:none}.select2-container--nodered[dir=rtl] .select2-selection--multiple .select2-selection__choice{margin-left:5px;margin-right:auto}.select2-container--nodered[dir=rtl] .select2-selection--multiple .select2-selection__choice__display{padding-left:5px;padding-right:2px}.select2-container--nodered[dir=rtl] .select2-selection--multiple .select2-selection__choice__remove{border-bottom-left-radius:0;border-bottom-right-radius:4px;border-left:1px solid var(--red-ui-form-input-border-color);border-right:none;border-top-left-radius:0;border-top-right-radius:4px}.select2-container--nodered[dir=rtl] .select2-selection--multiple .select2-selection__clear{float:left;margin-left:10px;margin-right:auto}.select2-container--nodered.select2-container--focus .select2-selection--multiple{outline:0}.select2-container--nodered.select2-container--disabled .select2-selection--multiple{background-color:var(--red-ui-list-item-background);cursor:default}.select2-container--nodered.select2-container--disabled .select2-selection__choice__remove{display:none}.select2-container--nodered.select2-container--open.select2-container--above .select2-selection--multiple,.select2-container--nodered.select2-container--open.select2-container--above .select2-selection--single{border-top-left-radius:0;border-top-right-radius:0}.select2-container--nodered.select2-container--open.select2-container--below .select2-selection--multiple,.select2-container--nodered.select2-container--open.select2-container--below .select2-selection--single{border-bottom-left-radius:0;border-bottom-right-radius:0}.select2-container--nodered .select2-search--dropdown{background-color:var(--red-ui-list-item-background)}.select2-container--nodered .select2-search--dropdown .select2-search__field{background-color:var(--red-ui-form-background);border:1px solid var(--red-ui-form-input-border-color);color:var(--red-ui-list-item-color)}.select2-container--nodered .select2-search--dropdown .select2-search__field:focus{border-color:var(--red-ui-form-input-border-color-focus);outline-color:var(--red-ui-form-text-color);outline:0}.select2-container--nodered .select2-search--inline .select2-search__field{-webkit-appearance:textfield;background:transparent;border:none;box-shadow:none;margin-top:7px;outline:0}.select2-container--nodered .select2-results>.select2-results__options{background-color:var(--red-ui-list-item-background);max-height:200px;overflow-y:auto}.select2-container--nodered .select2-results__option{color:var(--red-ui-form-text-color);font-size:14px}.select2-container--nodered .select2-results__option .select2-results__option{padding-left:1em}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__group{padding-left:0}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__option{margin-left:-1em;padding-left:2em}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-2em;padding-left:3em}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-3em;padding-left:4em}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-4em;padding-left:5em}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-5em;padding-left:6em}.select2-container--nodered .select2-results__option .sublabel{color:var(--red-ui-secondary-text-color);font-size:smaller;margin:4px 0}.select2-container--nodered .select2-results__option--group{padding:0}.select2-container--nodered .select2-results__option--disabled{color:var(--red-ui-form-text-color-disabled)}.select2-container--nodered .select2-results__option--selected{background-color:var(--red-ui-list-item-background-selected)}.select2-container--nodered .select2-results__option--highlighted.select2-results__option--selectable{background-color:var(--red-ui-list-item-background-hover);color:var(--red-ui-list-item-color)}.select2-container--nodered .select2-results__option--highlighted.select2-results__option--selectable .sublabel{color:var(--red-ui-list-item-secondary-color)}.select2-container--nodered .select2-results__group{cursor:default;display:block;padding:6px}.select2-container--nodered .select2-dropdown{border-color:var(--red-ui-form-input-border-color)}</style>
<style>.home-assistant .form-row.status-options div{display:flex;margin-top:12px}.home-assistant .form-row.status-options div .spacer{display:inline-block;width:100px}.home-assistant .form-row.status-options div input,.home-assistant .form-row.status-options div select{flex:1}</style>
<script type="text/html" data-template-name="ha-device-config"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-config-input-name" data-i18n="ha-device-config.label.name"></label> <input type="text" id="node-config-input-name"></div><div class="form-row"><label for="node-config-input-manufacturer" data-i18n="ha-device-config.label.manufacturer"></label> <input type="text" id="node-config-input-manufacturer"></div><div class="form-row"><label for="node-config-input-model" data-i18n="ha-device-config.label.model"></label> <input type="text" id="node-config-input-model"></div><div class="form-row"><label for="node-config-input-swVersion" data-i18n="ha-device-config.label.sw_version"></label> <input type="text" id="node-config-input-swVersion"></div><div class="form-row"><label for="node-config-input-hwVersion" data-i18n="ha-device-config.label.hw_version"></label> <input type="text" id="node-config-input-hwVersion"></div></script>
<style>.deviceExtra>label{text-transform:capitalize}.deviceExtra>input[type=checkbox]{width:auto}.deviceExtra .range-row{align-items:center;display:inline-flex;width:70%}.deviceExtra .range-row input[type=checkbox]{width:auto}.deviceExtra .range-row input[type=range]{flex-grow:1;margin:0 10px}.deviceExtra .range-row input[type=text]{text-align:center;width:calc(3ch + 14px)}</style>
<script type="text/html" data-template-name="ha-entity">This node has been deperacated in favor of the indivdual entity nodes.</script>
<style>#haConfig label{margin-bottom:0;text-transform:none;width:100%}#haConfig span{display:inline-block;margin-right:5px;width:40%}#haConfig input[type=text]{margin-left:10px;width:55%}</style>
<script type="text/html" data-template-name="ha-entity-config"><input type="hidden" id="node-config-input-version"><div class="form-row"><label for="node-config-input-name"><span data-i18n="home-assistant.label.name"></span></label> <input type="text" id="node-config-input-name"></div><div class="form-row"><label for="node-config-input-server"><span data-i18n="home-assistant.label.server"></span></label> <input type="text" id="node-config-input-server"></div><div class="form-row"><label for="node-config-input-deviceConfig"><span data-i18n="home-assistant.label.device"></span></label> <input type="text" id="node-config-input-deviceConfig"></div><div class="form-row"><label for="node-config-input-entityType"><span data-i18n="ha-entity-config.label.type"></span></label> <select id="node-config-input-entityType" style="width:70%"><option value="binary_sensor" data-i18n="ha-entity-config.label.type_options.binary_sensor"></option><option value="button" data-i18n="ha-entity-config.label.type_options.button"></option><option value="sensor" data-i18n="ha-entity-config.label.type_options.sensor"></option><option value="switch" data-i18n="ha-entity-config.label.type_options.switch"></option></select></div><hr><div id="ha-config-rows"></div><div id="resend-row" class="form-row ha-optional-row checkbox-option"><input type="checkbox" id="node-config-input-resend"> <label for="node-config-input-resend"><span data-i18n="ha-entity-config.label.resend"></span></label></div><div class="form-row checkbox-option"><input type="checkbox" id="node-config-input-debugEnabled"> <label for="node-config-input-debugEnabled"><span data-i18n="ha-entity-config.label.output_debug"></span></label></div></script>
<style>.home-assistant ul.ha-ignore-state{list-style:none;margin-left:105px}.home-assistant ul.ha-ignore-state li input{display:inline-block;margin-right:5px;vertical-align:top;width:auto}.home-assistant ul.ha-ignore-state li label{width:auto}</style>
<script type="text/html" data-template-name="server-events"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name" data-i18n="server-events.label.name"></label> <input type="text" id="node-input-name"></div><div class="form-row"><label for="node-input-server" data-i18n="server-events.label.server"></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-eventType" data-i18n="server-events.label.event_type"></label> <input type="text" id="node-input-eventType" placeholder="leave empty for all events"></div><div id="eventAlert" class="ui-state-error ha-alert-box"><strong data-i18n="server-events.alert"></strong>: <span data-i18n="server-events.alert_message"></span></div><div class="form-row"><label for="node-input-eventData" data-i18n="server-events.label.event_data"></label> <input type="text" id="node-input-eventData" style="width:70%"></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-waitForRunning"> <label for="node-input-waitForRunning" data-i18n="server-events.label.output_only_after_running"></label></div></script>
<style>#update-tag-list{margin-bottom:4px}#no-tags-found{display:none}</style>
<script type="text/html" data-template-name="server-state-changed"><input type="hidden" id="node-input-version"> <input type="hidden" id="node-input-outputs"><div class="form-row"><label for="node-input-name" data-i18n="home-assistant.label.name"></label> <input type="text" id="node-input-name"></div><div class="form-row"><label for="node-input-server" data-i18n="home-assistant.label.server"></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entityidfilter" data-i18n="home-assistant.label.entity"></label> <select type="text" id="node-input-entityidfiltertype"><option value="exact" data-i18n="home-assistant.label.select_option.exact"></option><option value="list" data-i18n="home-assistant.label.select_option.list"></option><option value="regex" data-i18n="home-assistant.label.select_option.regex"></option><option value="substring" data-i18n="home-assistant.label.select_option.substring"></option></select></div><div class="form-row"><label for="node-input-haltifstate" data-i18n="home-assistant.label.if_state"></label> <select id="node-input-halt_if_compare" style="width:20%"><option value="is" data-i18n="home-assistant.label.select_option.is"></option><option value="is_not" data-i18n="home-assistant.label.select_option.is_not"></option><option value="lt" data-i18n="home-assistant.label.select_option.less_than"></option><option value="lte" data-i18n="home-assistant.label.select_option.less_than_equal"></option><option value="gt" data-i18n="home-assistant.label.select_option.greater_than"></option><option value="gte" data-i18n="home-assistant.label.select_option.greater_than_equal"></option><option value="includes" data-i18n="home-assistant.label.select_option.in"></option><option value="does_not_include" data-i18n="home-assistant.label.select_option.not_in"></option><option value="jsonata" data-i18n="home-assistant.label.select_option.jsonata"></option></select> <input type="text" id="node-input-haltifstate" style="width:50%"> <input type="hidden" id="node-input-halt_if_type"></div><div class="form-row"><label for="node-input-for" data-i18n="home-assistant.label.for"></label>&nbsp;<div class="ha-multi-item-row"><input type="text" id="node-input-for"> <input type="hidden" id="node-input-forType"> <select id="node-input-forUnits"><option value="milliseconds" data-i18n="home-assistant.label.select_option.milliseconds"></option><option value="seconds" data-i18n="home-assistant.label.select_option.seconds"></option><option value="minutes" data-i18n="home-assistant.label.select_option.minutes"></option><option value="hours" data-i18n="home-assistant.label.select_option.hours"></option><option value="days" data-i18n="home-assistant.label.select_option.days"></option></select></div></div><div class="form-row"><label for="node-input-state_type" data-i18n="home-assistant.label.state_type"></label> <select type="text" id="node-input-state_type"><option value="str" data-i18n="home-assistant.label.select_option.string"></option><option value="num" data-i18n="home-assistant.label.select_option.number"></option><option value="habool" data-i18n="home-assistant.label.select_option.boolean"></option></select></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row add-spacer"><p data-i18n="server-state-changed.label.ignore_header"></p><ul class="ha-ignore-state"><li><input type="checkbox" id="node-input-ignorePrevStateNull"> <label for="node-input-ignorePrevStateNull" data-i18n="server-state-changed.label.ignore_prev_state_null"></label></li><li><input type="checkbox" id="node-input-ignorePrevStateUnknown"> <label for="node-input-ignorePrevStateUnknown" data-i18n="server-state-changed.label.ignore_prev_state_unknown"></label></li><li><input type="checkbox" id="node-input-ignorePrevStateUnavailable"> <label for="node-input-ignorePrevStateUnavailable" data-i18n="server-state-changed.label.ignore_prev_state_unavailable"></label></li><li><input type="checkbox" id="node-input-ignoreCurrentStateUnknown"> <label for="node-input-ignoreCurrentStateUnknown" data-i18n="server-state-changed.label.ignore_current_state_unknown"></label></li><li><input type="checkbox" id="node-input-ignoreCurrentStateUnavailable"> <label for="node-input-ignoreCurrentStateUnavailable" data-i18n="server-state-changed.label.ignore_current_state_unavailable"></label></li><li><input type="checkbox" id="node-input-output_only_on_state_change"> <label for="node-input-output_only_on_state_change" data-i18n="server-state-changed.label.output_only_on_state_change"></label></li></ul></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-outputinitially"> <label for="node-input-outputinitially" data-i18n="server-state-changed.label.output_on_connect"></label></div></script>
<style>#days-of-the-week{margin-left:30px}#days-of-the-week input{display:inline-block;margin-right:5px;vertical-align:top;width:auto}#days-of-the-week label{width:auto}</style>
<script type="text/html" data-template-name="ha-fire-event"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-dot-circle-o"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-data"><i class="fa fa-cube"></i> Event</label> <input type="text" id="node-input-event"></div><div class="form-row"><label for="node-input-data"><i class="fa fa-dot-circle-o"></i> Data</label> <input type="text" id="node-input-data" style="width:70%"> <input type="hidden" id="node-input-dataType"></div></script>
<script type="text/html" data-template-name="ha-get-entities"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><ol id="logic"></ol></div><div class="form-row"><label for="node-input-output_type">Output Type</label> <select id="node-input-output_type" style="width:70%"><option value="array">Array</option><option value="count">Count</option><option value="random">Random</option><option value="split">Split</option></select></div><div class="form-row checkbox-option output-option" id="output_empty_results"><input type="checkbox" id="node-input-output_empty_results"> <label for="node-input-output_empty_results">Send Empty Results</label></div><div class="form-row output-option" id="output_results_count"><label for="node-input-output_results_count" style="width:160px">Max Number of Results</label> <input type="text" id="node-input-output_results_count" style="width:150px"></div><div class="form-row output-option" id="output_location"><label for="node-input-output_location">Output Location</label> <input type="hidden" id="node-input-output_location_type"> <input type="text" id="node-input-output_location" style="width:70%"></div></script>
<script type="text/html" data-template-name="api-get-history"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><!-- Comparator Selection --><div class="form-row"><label for="node-input-entityid"><i class="fa fa-date"></i> Entity ID</label> <select type="text" id="node-input-entityidtype" style="width:18%"><option value="is">Is</option><option value="includes">Includes</option></select> <input type="text" id="node-input-entityid" style="width:52%"></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-useRelativeTime"> <label for="node-input-useRelativeTime">Use Relative Time</label></div><div class="form-row relative_row"><label for="node-input-relativeTime"><i class="fa fa-date"></i> In the Last</label> <input type="text" id="node-input-relativeTime" autofocus="autofocus" placeholder="20 minutes"></div><div class="form-row date_row"><label for="node-input-startdate"><i class="fa fa-date"></i> Start Date</label> <input type="text" id="node-input-startdate" autofocus="autofocus"></div><div class="form-row date_row"><label for="node-input-enddate"><i class="fa fa-date"></i> End Date</label> <input type="text" id="node-input-enddate"></div><div class="form-row form-tips date_row"><ul><li>dates must be in ISO format</li><li>example: "2018-01-27T13:00:00+00:00"</li></ul></div><div class="form-row form-tips relative_row"><p><code>timestring</code> will parse the following keywords into time values:</p><ol><li><code>ms, milli, millisecond, milliseconds</code> - will parse to milliseconds</li><li><code>s, sec, secs, second, seconds</code> - will parse to seconds</li><li><code>m, min, mins, minute, minutes</code> - will parse to minutes</li><li><code>h, hr, hrs, hour, hours</code> - will parse to hours</li><li><code>d, day, days</code> - will parse to days</li><li><code>w, week, weeks</code> - will parse to weeks</li><li><code>mon, mth, mths, month, months</code> - will parse to months</li><li><code>y, yr, yrs, year, years</code> - will parse to years</li></ol></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-flatten"> <label for="node-input-flatten">Flatten Results</label></div><div class="form-row"><label for="node-input-output_type">Output Type</label> <select id="node-input-output_type" style="width:70%"><option value="array">Array</option><option value="split">Split</option></select></div><div class="form-row output-option" id="output_location"><label for="node-input-output_location">Output Location</label> <input type="hidden" id="node-input-output_location_type"> <input type="text" id="node-input-output_location" style="width:70%"></div></script>
<script type="text/html" data-template-name="poll-state"><input type="hidden" id="node-input-version"> <input type="hidden" id="node-input-outputs"><div class="form-row"><label for="node-input-name">Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server">Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entity_id">Entity ID</label> <input type="text" id="node-input-entity_id"></div><div class="form-row"><label for="node-input-updateinterval">Update Interval</label> <input type="text" id="node-input-updateinterval" style="width:43%"> <input type="hidden" id="node-input-updateIntervalType"> <select id="node-input-updateIntervalUnits" style="width:27%"><option value="seconds">seconds</option><option value="minutes">minutes</option><option value="hours">hours</option></select></div><div class="form-row"><label for="node-input-halt_if_compare">If State</label> <select type="text" id="node-input-halt_if_compare" style="width:20%"><option value="is">is</option><option value="is_not">is not</option><option value="lt">&lt;</option><option value="lte">&lt;=</option><option value="gt">&gt;</option><option value="gte">&gt;=</option><option value="includes">in</option><option value="does_not_include">not in</option><option value="jsonata">JSONata</option></select> <input type="text" id="node-input-halt_if" style="width:50%"> <input type="hidden" id="node-input-halt_if_type"></div><div class="form-row"><label for="node-input-state_type">State Type</label> <select type="text" id="node-input-state_type" style="width:auto"><option value="str">String</option><option value="num">Number</option><option value="habool">Boolean</option></select></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-outputonchanged"> <label for="node-input-outputonchanged">Output on Changed</label></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-outputinitially"> <label for="node-input-outputinitially">Output on Connect</label></div></script>
<script type="text/html" data-template-name="api-render-template"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row" style="position:relative;margin-bottom:0"><label for="node-input-template"><i class="fa fa-file-code-o"></i> Template</label> <input type="hidden" id="node-input-template" autofocus="autofocus"></div><div class="form-row node-text-editor-row"><div style="height:250px;min-height:150px" class="node-text-editor" id="node-input-template-editor"></div></div><div class="form-row"><label for="node-input-templateLocation">Template</label> <input type="text" id="node-input-templateLocation" style="width:70%"> <input type="hidden" id="node-input-templateLocationType"></div><div class="form-row"><label for="node-input-resultsLocation">Results</label> <input type="text" id="node-input-resultsLocation" style="width:70%"> <input type="hidden" id="node-input-resultsLocationType"></div></script>
<script type="text/html" data-template-name="ha-sensor"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><span data-i18n="home-assistant.label.name"></span></label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-entityConfig"><span data-i18n="home-assistant.label.entity_config"></span></label> <input type="text" id="node-input-entityConfig"></div><div class="form-row"><label for="node-input-state"><span data-i18n="ha-binary-sensor.label.state"></span></label> <input type="text" id="node-input-state" style="width:70%"> <input type="hidden" id="node-input-stateType"></div><div class="form-row"><ol id="attributes"></ol></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row"><label for="node-input-inputOverride"><span data-i18n="ha-binary-sensor.label.input_override"></span></label> <select id="node-input-inputOverride" style="width:68%"><option value="allow">Allow</option><option value="merge">Merge</option><option value="block">Block</option></select></div></script>
<script type="text/html" data-template-name="ha-switch"><input type="hidden" id="node-input-version"> <input type="hidden" id="node-input-inputs"><div class="form-row"><label for="node-input-name"><span data-i18n="home-assistant.label.name"></span></label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-entityConfig"><span data-i18n="home-assistant.label.entity_config"></span></label> <input type="text" id="node-input-entityConfig"></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-enableInput"> <label for="node-input-enableInput"><span data-i18n="ha-switch.label.enable_input"></span></label></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-outputOnStateChange"> <label for="node-input-outputOnStateChange"><span data-i18n="ha-switch.label.output_on_state_change"></span></label></div><div id="ha-custom-ouputs" class="form-row"><ol id="custom-outputs"></ol></div></script>
<script type="text/html" data-template-name="ha-tag"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name" data-i18n="home-assistant.label.name"><i class="fa fa-tag"></i></label> <input type="text" id="node-input-name" data-i18n="[placeholder]home-assistant.label.name"></div><div class="form-row"><label for="node-input-server" data-i18n="home-assistant.label.server"><i class="fa fa-server"></i></label> <input type="text" id="node-input-server"></div><div id="no-tags-found" class="ui-state-error ha-alert-box" data-i18n="ha-tag.errors.no_tags_found"><i class="fa fa-exclamation-triangle"></i></div><div class="form-row"><ol id="tags"></ol></div><div class="form-row"><ol id="devices"></ol></div><div class="form-row"><ol id="custom-outputs"></ol></div></script>
<script type="text/html" data-template-name="ha-time"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="ha-time.label.name"></span></label> <input type="text" id="node-input-name" data-i18n="[placeholder]ha-time.label.name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> <span data-i18n="ha-time.label.server"></span></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entityId"><i class="fa fa-cube"></i> <span data-i18n="ha-time.label.entity_id"></span></label> <input type="text" id="node-input-entityId"></div><div class="form-row"><label for="node-input-property"><i class="fa fa-edit"></i> <span data-i18n="ha-time.label.property"></span></label> <input type="text" id="node-input-property" placeholder="state"></div><div class="form-row"><label for="node-input-offset"><i class="fa fa-clock-o"></i> <span data-i18n="ha-time.label.offset"></span></label> <input type="text" id="node-input-offset" style="width:43%"> <input type="hidden" id="node-input-offsetType"> <select id="node-input-offsetUnits" style="width:27%"><option value="seconds" data-i18n="ha-time.label.seconds"></option><option value="minutes" data-i18n="ha-time.label.minutes"></option><option value="hours" data-i18n="ha-time.label.hours"></option></select></div><div class="form-row checkbox-option"><label><input type="checkbox" id="node-input-randomOffset"> <span data-i18n="ha-time.label.randomize_offset"></span></label></div><div class="form-row" id="entitiesFound"></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row checkbox-option"><label><input type="checkbox" id="node-input-repeatDaily"> <span data-i18n="ha-time.label.repeat_daily"></span></label><div id="days-of-the-week"><div><input type="checkbox" checked="checked" id="node-input-sunday"> <label for="node-input-sunday" data-i18n="ha-time.label.sunday"></label></div><div><input type="checkbox" checked="checked" id="node-input-monday"> <label for="node-input-monday" data-i18n="ha-time.label.monday"></label></div><div><input type="checkbox" checked="checked" id="node-input-tuesday"> <label for="node-input-tuesday" data-i18n="ha-time.label.tuesday"></label></div><div><input type="checkbox" checked="checked" id="node-input-wednesday"> <label for="node-input-wednesday" data-i18n="ha-time.label.wednesday"></label></div><div><input type="checkbox" checked="checked" id="node-input-thursday"> <label for="node-input-thursday" data-i18n="ha-time.label.thursday"></label></div><div><input type="checkbox" checked="checked" id="node-input-friday"> <label for="node-input-friday" data-i18n="ha-time.label.friday"></label></div><div><input type="checkbox" checked="checked" id="node-input-saturday"> <label for="node-input-saturday" data-i18n="ha-time.label.saturday"></label></div></div></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled">Show Debug Information</label></div></script>
<script type="text/html" data-template-name="trigger-state"><input type="hidden" id="node-input-version"> <input type="hidden" id="node-input-inputs"> <input type="hidden" id="node-input-outputs"><!-- Name --><div class="form-row"><label for="node-input-name" data-i18n="home-assistant.label.label"></label> <input type="text" id="node-input-name"></div><!-- Server --><div class="form-row"><label for="node-input-server" data-i18n="home-assistant.label.server"></label> <input type="text" id="node-input-server"></div><!-- Entity ID Filter and Filter Type --><div class="form-row"><label for="node-input-entityid" data-i18n="home-assistant.label.entity"></label> <select type="text" id="node-input-entityidfiltertype"><option value="exact" data-i18n="home-assistant.label.select_option.exact"></option><option value="list" data-i18n="home-assistant.label.select_option.list"></option><option value="regex" data-i18n="home-assistant.label.select_option.regex"></option><option value="substring" data-i18n="home-assistant.label.select_option.substring"></option></select></div><div class="form-row"><label for="node-input-state_type" data-i18n="home-assistant.label.state_type"></label> <select type="text" id="node-input-state_type"><option value="str" data-i18n="home-assistant.label.select_option.string"></option><option value="num" data-i18n="home-assistant.label.select_option.number"></option><option value="habool" data-i18n="home-assistant.label.select_option.boolean"></option></select></div><!-- Constraints List --><div class="form-row"><ol id="constraint-list"></ol></div><!-- Output List --><div class="form-row"><ol id="output-list"></ol></div><div class="form-row checkbox-option-left"><input type="checkbox" id="node-input-outputinitially"> <label for="node-input-outputinitially" data-i18n="home-assistant.label.output_on_connect"></label></div><div class="form-row checkbox-option-left"><input type="checkbox" id="node-input-enableInput"> <label for="node-input-enableInput" data-i18n="trigger-state.label.enable_input"></label></div><div class="form-row checkbox-option-left"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled" data-i18n="home-assistant.label.output_debug"></label></div><div id="constraint-template" style="display:none"><!-- Target Selection --><div class="editable-list-row"><!-- Type --> <select type="text" class="target-type" style="width:140px"><option value="this_entity" data-i18n="trigger-state.label.select_option.this_entity"></option><option value="entity_id" data-i18n="trigger-state.label.select_option.entity_id"></option></select><!-- Value --> <input type="text" class="target-value" disabled="disabled"></div><!-- Property Selection --><div class="editable-list-row"><!-- Type --> <select type="text" class="property-type" style="width:140px"><option value="current_state" data-i18n="trigger-state.label.select_option.current_state"></option><option value="previous_state" data-i18n="trigger-state.label.select_option.previous_state"></option><option value="property" data-i18n="trigger-state.label.select_option.property"></option></select><!-- Value --> <input type="text" class="property-value" disabled="disabled"></div><!-- Comparator Selection --><div class="editable-list-row"><!-- Type --> <select type="text" class="comparator-type" style="width:140px"><option value="is" data-i18n="home-assistant.label.select_option.is"></option><option value="is_not" data-i18n="home-assistant.label.select_option.is_not"></option><option value=">" data-i18n="home-assistant.label.select_option.greater_than"></option><option value=">=" data-i18n="home-assistant.label.select_option.greater_than_equal"></option><option value="<" data-i18n="home-assistant.label.select_option.less_than"></option><option value="<=" data-i18n="home-assistant.label.select_option.less_than_equal"></option><option value="includes" data-i18n="home-assistant.label.select_option.in"></option><option value="does_not_include" data-i18n="home-assistant.label.select_option.not_in"></option></select><!-- Value --> <input type="text" class="comparator-value" style="width:65%"></div></div><div id="output-template" style="display:none"><div class="editable-list-row"><!-- Type --> <select type="text" class="message-type" style="width:140px"><option value="default" data-i18n="trigger-state.label.select_option.default_message"></option><option value="custom" data-i18n="trigger-state.label.select_option.custom_message"></option><option value="payload" data-i18n="trigger-state.label.select_option.custom_payload"></option></select> <input type="text" class="message-value" style="width:62%"></div><!-- Output Comparator Selection --><div class="editable-list-row"><select type="text" class="comparator-property-type" style="width:140px"><option value="always" data-i18n="trigger-state.label.select_option.awalys"></option><option value="current_state" data-i18n="trigger-state.label.select_option.if_state"></option><option value="previous_state" data-i18n="trigger-state.label.select_option.if_prev_state"></option><option value="property" data-i18n="trigger-state.label.select_option.if_property"></option></select> <input type="text" class="comparator-property-value" disabled="disabled"></div><div class="editable-list-row"><!-- Type --> <select type="text" class="comparator-type" style="width:140px" disabled="disabled"><option value="is" data-i18n="home-assistant.label.select_option.is"></option><option value="is_not" data-i18n="home-assistant.label.select_option.is_not"></option><option value=">" data-i18n="home-assistant.label.select_option.greater_than"></option><option value=">=" data-i18n="home-assistant.label.select_option.greater_than_equal"></option><option value="<" data-i18n="home-assistant.label.select_option.less_than"></option><option value="<=" data-i18n="home-assistant.label.select_option.less_than_equal"></option><option value="includes" data-i18n="home-assistant.label.select_option.in"></option><option value="does_not_include" data-i18n="home-assistant.label.select_option.not_in"></option></select> <input type="text" class="comparator-value" style="width:62%"></div></div></script>
<script type="text/html" data-template-name="ha-update-config"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><span data-i18n="home-assistant.label.name"></span></label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><span data-i18n="home-assistant.label.server"></span></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entityConfig"><span data-i18n="home-assistant.label.entity_config"></span></label> <input type="text" id="node-input-entityConfig"></div><div class="form-row"><ol id="custom-outputs"></ol></div></script>
<script type="text/html" data-template-name="ha-wait-until"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name" data-i18n="home-assistant.label.name"></label> <input type="text" id="node-input-name"></div><div class="form-row"><label for="node-input-server" data-i18n="home-assistant.label.server"></label> <input type="text" id="node-input-server"></div><div class="form-row"><label data-i18n="home-assistant.label.entity"></label> <select id="node-input-entityIdFilterType"><option value="exact" data-i18n="home-assistant.label.select_option.exact">exact</option><option value="list" data-i18n="home-assistant.label.select_option.list">list</option><option value="regex" data-i18n="home-assistant.label.select_option.regex">regex</option><option value="substring" data-i18n="home-assistant.label.select_option.substring">substring</option></select></div><div class="form-row"><label for="node-input-property" data-i18n="ha-wait-until.label.wait_until"></label> <input type="text" id="node-input-property" placeholder="property"></div><div class="form-row"><label></label>&nbsp;<div class="ha-multi-item-row"><select id="node-input-comparator"><option value="is" data-i18n="home-assistant.label.select_option.is"></option><option value="is_not" data-i18n="home-assistant.label.select_option.is_not"></option><option value="lt" data-i18n="home-assistant.label.select_option.less_than"></option><option value="lte" data-i18n="home-assistant.label.select_option.less_than_equal"></option><option value="gt" data-i18n="home-assistant.label.select_option.greater_than"></option><option value="gte" data-i18n="home-assistant.label.select_option.greater_than_equal"></option><option value="includes" data-i18n="home-assistant.label.select_option.in"></option><option value="does_not_include" data-i18n="home-assistant.label.select_option.not_in"></option><option value="jsonata" data-i18n="home-assistant.label.select_option.jsonata"></option></select> <input id="node-input-valueType" type="hidden"> <input id="node-input-value" type="text" placeholder="value"></div></div><div class="form-row"><label for="node-input-timeout" data-i18n="ha-wait-until.label.timeout"></label>&nbsp;<div class="ha-multi-item-row"><input type="text" id="node-input-timeout"> <input type="hidden" id="node-input-timeoutType"> <select id="node-input-timeoutUnits"><option value="milliseconds" data-i18n="home-assistant.label.milliseconds">milliseconds</option><option value="seconds" data-i18n="home-assistant.label.seconds">seconds</option><option value="minutes" data-i18n="home-assistant.label.minutes">minutes</option><option value="hours" data-i18n="home-assistant.label.hours">hours</option><option value="days" data-i18n="home-assistant.label.days">days</option></select></div></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row exact-only checkbox-option"><input type="checkbox" id="node-input-checkCurrentState" checked="checked"> <label for="node-input-checkCurrentState" data-i18n="ha-wait-until.label.check_current_state"></label></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-blockInputOverrides">&nbsp; <label for="node-input-blockInputOverrides" data-i18n="ha-wait-until.label.block_input_overrides"></label></div></script>
<script type="text/html" data-template-name="ha-webhook"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name">Name</label> <input type="text" id="node-input-name" placeholder="Name"> <input type="hidden" id="node-input-outputs"></div><div class="form-row"><label for="node-input-server">Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-webhookId">ID</label>&nbsp;<div style="display:inline-flex;width:70%"><input type="text" id="node-input-webhookId" style="flex-grow:1"> <a id="copyId" class="editor-button" style="margin-left:10px"><i class="fa fa-copy"></i> </a><a id="refresh" class="editor-button" style="margin-left:10px"><i class="fa fa-refresh"></i></a></div></div><div class="form-row"><ol id="custom-outputs"></ol></div></script>
<script type="text/html" data-template-name="ha-zone"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><ol id="entities"></ol></div><div class="form-row"><label for="node-input-event"><i class="fa fa-sign-in"></i> Event</label> <select id="node-input-event"><option value="enter">Enter</option><option value="leave">Leave</option><option value="enter_leave">Enter or Leave</option></select></div><div class="form-row"><ol id="zones"></ol></div></script>
<script type="text/html" data-help-name="ha-api"><h3>Config</h3><dl class="message-properties"><dt>Protocol <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Values: <code>websocket|http</code></li><li>Default: <code>websocket</code></li></ul><dd>Protocol to use to access Home Assistant API.</dd><dt>Method<span class="property-type">string</span></dt><ul><li>Values: <code>get|post</code></li></ul><dd>Type of method to use to access the HTTP endpoint.</dd><dt>Path<span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>URL of the API endpoint.</dd><dt>Params<span class="property-type">Object</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>A JSON object with key/value pairs that will be converted into URL parameters.</dd><dt>Data<span class="property-type">Object</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a> when the data type is JSON</li></ul><dd>JSON Object to send for WebSocket requests and HTTP posts.</dd><dt>Results<span class="property-type">string</span></dt></dl><h3>Input</h3><dl class="message-properties"><dd>All properties need to be under <code>msg.payload</code>.</dd><dt>protocol<span class="property-type">string</span></dt><ul><li>Values: <code>websocket|http</code></li></ul><dd>Overrides or sets the protocol property of the config.</dd><dt>method<span class="property-type">string</span></dt><ul><li>Values: <code>get|post</code></li></ul><dd>Overrides or sets the method property of the config.</dd><dt>path<span class="property-type">string</span></dt><dd>Overrides or sets the path property of the config.</dd><dt>data<span class="property-type">Object|string</span></dt><dd>Overrides or sets the data/params property of the config.</dd><dt>location<span class="property-type">string</span></dt><dd>Overrides or sets the results property of the config.</dd><dt>locationType<span class="property-type">string</span></dt><ul><li>Values: <code>msg|flow|global</code></li></ul><dd>Overrides or sets the results type property of the config.</dd></dl><h3>Output</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>results</code>: results of the API request</li><li><code>config</code>: config properties of the node</li></ul></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://developers.home-assistant.io/docs/api/rest">http api</a></li><li><a href="https://developers.home-assistant.io/docs/api/websocket">websocket api</a></li></ul></dl></script>
<script type="text/html" data-help-name="ha-binary-sensor"><div class="home-assistant-custom-block warning"><p class="custom-block-title">WARNING</p><p><em>Needs <a href="https://github.com/zachowj/hass-node-red">Custom Integration</a> installed in Home Assistant for this node to function</em></p></div><p>Creates a binary sensor in Home Assistant which can be manipulated from this node.</p><h3>Configuration</h3><dl class="message-properties"><dt>State <span text="required" class="home-assistant-badge">required</span><span class="property-type">boolean</span></dt><dd>The state of the entity should be updated to</dd><dt>Attributes<span class="property-type">Object</span></dt><dd>Key/Value pair of attributes to update. The key should be a string and the value can be a [string | number | boolean | object]</dd><dt>Input Override<span class="property-type">string</span></dt><ul><li>Values: <code>accept | merge | block</code></li></ul><dd>Determine how input values will be handled. When merge is selected the message object values will override the configuration values.</dd></dl><h3>Inputs</h3><dl class="message-properties"><dd>properties of <code>msg.payload</code></dd><dt>state<span class="property-type">string | number | boolean</span></dt><dd>The value of the entity state will be updated.</dd><dt>attributes<span class="property-type">Object</span></dt><dd>Key/Value pair of attributes to update. The key should be a string and the value can be a <code>[string | number | boolean | object]</code></dd></dl></script>
<script type="text/html" data-help-name="ha-button"><div class="home-assistant-custom-block warning"><p class="custom-block-title">WARNING</p><p><em>Needs <a href="https://github.com/zachowj/hass-node-red">Custom Integration</a> installed in Home Assistant for this node to function</em></p></div><p>Creates a <a href="https://developers.home-assistant.io/docs/core/entity/button">button entity</a> in Home Assistant that will trigger the flow when pressed.</p><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>entity</code>: complete entity object</li><li><code>entity id</code>: entity id of the pressed button</li><li><code>entity state</code>: entity state of the pressed button</li><li><code>config</code>: config properties of the node</li></ul></dl></script>
<script type="text/html" data-help-name="api-call-service"><p>Sends a request to home assistant for any domain and service available (<code>light/turn_on</code>, <code>input_select/select_option</code>, etc..)</p><div class="home-assistant-custom-block tip"><p class="custom-block-title">Helpful Examples</p><p><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/call-service.html" rel="noopener noreferrer">Call Service Tips and Tricks</a></p></div><h3>Configuration</h3><dl class="message-properties"><dt>Domain <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>Service domain to call</dd><dd>A custom domain can be used by adding a <code>#</code> at the end of the domain</dd><dt>Service <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>Service to call</dd><dd>Custom service can be used by adding a <code>#</code> at the end of the service</dd><dt>Area<span class="property-type">an array of area ids</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a> for ids</li></ul><dd>A list of area ids that will be used as targets for the service call</dd><dd>Custom ids can be inserted into the list by adding a <code>#</code> at the end of the id</dd><dt>Device<span class="property-type">an array of device ids</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a> for ids</li></ul><dd>A list of device ids that will be used as targets for the service call</dd><dd>Custom ids can be inserted into the list by adding a <code>#</code> at the end of the id</dd><dt>Entity<span class="property-type">an array of entity ids</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a> for ids</li></ul><dd>A list of entity ids that will be used as targets for the service call</dd><dt>Data<span class="property-type">JSONata | JSON</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a> when data type is JSON</li></ul><dd>JSON object to pass along.</dd><dt>Merge Context<span class="property-type">string</span></dt><dd>If defined will attempt to merge the global and flow context variable into the config</dd><dt>Alternative Template Tags<span class="property-type">boolean</span></dt><dd>Will change the tags used for the mustache template to <code>&lt;%</code> and <code>%&gt;</code></dd><dt>Queue<span class="property-type">none | first | all | last</span></dt><dd>Will store the first, last, or all messages received while disconnected from Home Assistant and send them once connected again</dd></dl><h3>Input</h3><dl class="message-properties"><dd>All properties need to be under <code>msg.payload</code>.</dd><dd>Sample input</dd><pre><code class="language-JSON">{
    &quot;domain&quot;: &quot;homeassistant&quot;,
    &quot;service&quot;: &quot;turn_on&quot;,
    &quot;target&quot;: {
        &quot;area_id&quot;: [&quot;kitchen&quot;],
        &quot;device_id&quot;: [&quot;8932894082930482903&quot;],
        &quot;entity_id&quot;: [&quot;light.kitchen&quot;, &quot;switch.garage_light&quot;]
    }
    &quot;data&quot;: {
        &quot;brightness_pct&quot;: 50
    }
}
</code></pre><h5>Merging</h5><dd>If the incoming message has a <code>payload</code> property with <code>domain</code>, <code>service</code> set it will override any config values if set.</dd><dd>If the incoming message has a <code>payload.data</code> that is an object or parsable into an object these properties will be <strong>merged</strong> with any config values set.</dd><dd>If the node has a property value in its config for <code>Merge Context</code> then the <code>flow</code> and <code>global</code> contexts will be checked for this property which should be an object that will also be merged into the data payload.</dd><h5>Merge Resolution</h5><dd>As seen above the <code>data</code> property has a lot going on in the way of data merging, in the end, all of these are optional and the rightmost will win if a property exists in multiple objects</dd><dd>Config Data, Global Data, Flow Data, Payload Data ( payload data property always wins if provided</dd><dt>domain<span class="property-type">string</span></dt><dd>Service domain to call</dd><dt>service<span class="property-type">string</span></dt><dd>Service service to call</dd><dt>data<span class="property-type">JSON Object</span></dt><dd>Service data to send with the service call</dd><dt>target<span class="property-type">JSON Object with area_id, device_id, and entity_id as array properties</span></dt><dd>Targets of the service call</dd></dl><h3>Output</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>sent data</code>: data sent to Home Assistant</li><li><code>config</code>: config properties of the node</li></ul></dl><h3>References</h3><dl class="message-properties"><div><p><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/node/call-service.html" rel="noopener noreferrer">External Docs</a></p></div></dl></script>
<script type="text/html" data-help-name="server"><p>Home Assistant connection configuration</p><h3>Config</h3><dl class="message-properties"><dt>Name<span class="property-type">string</span></dt><dd>Label for this configuration, see details below for implications</dd><dt>Using the Home Assistant Add-on<span class="property-type">boolean</span></dt><dd>If you&apos;re running Node-RED as a Hass.io Add-on check this. No other information is needed.</dd><dt>Base URL<span class="property-type">string</span></dt><dd>The base URL and port of the Home Assistant instance can be reached at, for example: <code>http://192.168.0.100:8123</code> or <code>https://homeassistant.mysite.com</code></dd><dt>Access Token<span class="property-type">string</span></dt><dd>Long-lived Access Token used to contact the API</dd><dt>Unauthorized SSL Certificates<span class="property-type">boolean</span></dt><dd>This will allow you to use self-signed certificates. Only use this if you know what you&apos;re doing.</dd><dt>State Boolean<span class="property-type">string | delimited</span></dt><dd>A list of strings, not case sensitive, delimited by vertical pipe, |, that will return true for State Type Boolean.</dd><dt>Enable Heartbeat<span class="property-type">boolean</span></dt><dd>Heartbeat will send a ping message using the websocket connection to Home Assistant every X seconds. If a pong response is not received within 5 seconds Node-RED will attempt to reconnect to Home Assistant.</dd><dt>Heartbeat Interval<span class="property-type">number</span></dt><dd>The interval at which the ping message is sent to Home Assistant. The minimum value is 10 seconds.</dd><dt>Enable Global Context Store<span class="property-type">boolean</span></dt><dd>If enabled, the global context store will be used to store the Home Assistant connection, state, and service information. This allows you to use the information in other nodes using context functions.</dd><dd>Example below</dd></dl><h3>UI Settings</h3><dl class="message-properties"><dt>Cache Autocomplete Results<span class="property-type"></span></dt><dd>Enables the caching of the JSON autocomplete requests. Enabling or disabling this may require a restart of Node-RED for it to take effect.</dd><dt>ID Selector Display<span class="property-type"></span></dt><dd>Which text to show in the selector after the id has been chosen.</dd><dt>Status Date Format<span class="property-type"></span></dt><h5>Separator</h5><dd>A string that will appear in the status of an event node between the state and date string.</dd><h5>Other options</h5><dd>The other options are directly from <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/DateTimeFormat/DateTimeFormat#options">DateTimeFormat Options</a>.</dd></dl><h3>Details</h3><dl class="message-properties"><dd>Every node requires a configuration attached to define how to contact Home Assistant, which is this config node&apos;s main purpose.</dd><dt>Context<span class="property-type"></span></dt><dd>Each config node will also make some data available in the global context, the <code>Name</code> value in this node is used as, camelcase, and the namespace for those values</dd><dd>Currently <code>states</code>, <code>services</code>, and <code>events</code> is made available in the global context. <code>states</code> is always set to all available states at startup and updated whenever state changes occur so it should be always up to date. <code>services</code> and <code>events</code> is only updated on initial deploy.</dd><dt>Context Example<span class="property-type"></span></dt><dd>Say we have a config node with the name <code>Home Assistant</code>, with an entity set up in Home Assistant as <code>switch.my_switch</code>. This state would be available within function nodes and you could fetch using something like the below code</dd><pre><code class="language-js">const haCtx = global.get(&quot;homeassistant&quot;);
const configCtx = haCtx.homeAssistant;
const entityState = configCtx.states[&quot;switch.my_switch&quot;];
return entityState.state === &quot;on&quot; ? true : false;
</code></pre></dl><h3>Connection Issues</h3><dl class="message-properties"><dd>Communication with Home Assistant is accomplished via a combination of WebSocket and the REST API if you are having trouble communicating with home assistant make sure you can access the API outside of node-red, but from the same server node-red is running on, using a REST client, curl, or any number of other methods to validate the connection</dd></dl><h3>References</h3><dl class="message-properties"><dd><a href="https://home-assistant.io/developers/rest_api">Home Assistant REST API</a></dd></dl></script>
<script type="text/html" data-help-name="api-current-state"><p>Returns the current state of an entity. Useful for using conditional logic to automation flows.</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity ID <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>The id of the entity to return.</dd><dt>If State<span class="property-type">string</span></dt><dd>If the conditional statement is evaluated as true send the message to the first output otherwise send it to the second output. If blank there will only be one output.</dd><dd><strong>Also see:</strong></dd><ul><li><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/conditionals.html" rel="noopener noreferrer">Conditionals</a></li></ul><dt>For<span class="property-type">number</span></dt><dd>The amount of time the entity state needs to constant for the &quot;If state&quot; to be <code>true</code></dd><dt>State Type<span class="property-type">string</span></dt><ul><li>Values: <code>string|number|boolean</code></li><li>Default: <code>string</code></li></ul><dd>Convert the state of the entity to the selected type. Boolean will be converted to true based on if the string is equal by default to (<code>y|yes|true|on|home|open</code>). Original value stored in <code>msg.data.original_state</code></dd><dt>Block Input Overrides<span class="property-type">boolean</span></dt><ul><li>Default: <code>false</code></li></ul><dd>Stop msg.payload values from overriding local config</dd></dl><h3>Inputs</h3><dl class="message-properties"><dt>payload.entityId<span class="property-type">string</span></dt></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>entity</code>: full entity object</li><li><code>entity id</code>: entity id of the triggered entity</li><li><code>entity state</code>: entity state of the triggered entity</li><li><code>config</code>: config properties of the node</li></ul></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://home-assistant.io/docs/configuration/state_object/">Home Assistant State Objects</a></li></ul></dl></script>
<script type="text/html" data-help-name="ha-device-config"><h3>Configuration</h3><dl class="message-properties"><dt>Name<span class="property-type">string</span></dt><dd>The name of the device that will show in Home Assistant</dd><dt>Manufacturer<span class="property-type">string</span></dt><dd>The manufacturer of the device</dd><dt>Model<span class="property-type">string</span></dt><dd>The model of the device</dd><dt>Software Version<span class="property-type">string</span></dt><dd>The software version of the device</dd><dt>Hardware Version<span class="property-type">string</span></dt><dd>The hardware version of the device</dd></dl></script>
<script type="text/html" data-help-name="ha-device"><h3>Configuration</h3><dl class="message-properties"><dt>Type<span class="property-type">string</span></dt><ul><li>Values: <code>trigger | action</code></li></ul><dt>Device<span class="property-type">string</span></dt><dd>Id of the device</dd><dt>Trigger<span class="property-type">object</span></dt><dd>Home Assistant object of the trigger</dd><dt>Action<span class="property-type">object</span></dt><dd>Home Assistant object of the action</dd><dt>Capabilities<span class="property-type">object</span></dt></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>config</code>: config properties of the node</li><li><code>device id</code>: device id that triggered the node</li><li><code>event data</code>: event data received from Home Assistant</li><li><code>sent data</code>: data sent to Home Assistant</li></ul></dl></script>
<script type="text/html" data-help-name="ha-entity-config"><p>Home Assistant entity config</p><h3>Configuration</h3><dl class="message-properties"><dt>Name<span class="property-type">string</span></dt><dd>The name of the entity that will show in Node-RED</dd><dt>Device<span class="property-type">string</span></dt><ul><li><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/node/device-config.html" rel="noopener noreferrer">device config documentation</a></li></ul><dd>A list of devices the entity can be associated with. This is used to group entities together in the UI.</dd><div class="home-assistant-custom-block warning"><p class="custom-block-title">Caveat</p><p>If the entity has already been registered with Home Assistant when no device was selected. The device will not be added to the Home Assistant until after Home Assistant has been restarted.</p></div><dt>Type <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Values: <code>binary_sensor|button|sensor|switch</code></li></ul><dt>Resend state and attributes<span class="property-type">boolean</span></dt><dd>When the entity in Home Assistant is created the state and attributes will also be set. This is only applicable with certain entities nodes.</dd><dt>Other Properties<span class="property-type"></span></dt><dd>Configuration options are available for the selected entities</dd><dd><a href="https://developers.home-assistant.io/docs/core/entity">https://developers.home-assistant.io/docs/core/entity</a></dd></dl></script>
<script type="text/html" data-help-name="ha-entity"><div class="home-assistant-custom-block danger"><p class="custom-block-title">DEPRECATED</p><p>This node has been deprecated in favor of the individual entity nodes. The individual entity nodes can be used in subflows and added to devices.</p></div><p>Creates an entity in Home Assistant which can be manipulated from this node.</p><p><code>binary sensor</code>, <code>sensor</code>, and <code>switch</code></p><div class="home-assistant-custom-block warning"><p class="custom-block-title">WARNING</p><p><em>Needs <a href="https://github.com/zachowj/hass-node-red">Custom Integration</a> installed in Home Assistant for this node to function</em></p></div><h3>Configuration</h3><dl class="message-properties"><dt>Type <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Values <code>binary_sensor|sensor|switch</code></li><li>Default: <code>sensor</code></li></ul><dd>The state the entity should be updated to</dd><dt>Home Assistant Config<span class="property-type">Object</span></dt><dd>Configuration options available for the selected entity</dd><div class="home-assistant-custom-block danger"><p class="custom-block-title">WARNING</p><p>Entity nodes will not work in a subflow due to the way they register themselves with Home Assistant. After a Node-RED restart, a new entity will be created in Home Assistant.</p></div></dl><h3>Sensor Configuration</h3><dl class="message-properties"><dt>State <span text="required" class="home-assistant-badge">required</span><span class="property-type">string | number | boolean</span></dt><dd>The state the entity should be updated to</dd><dt>Attributes<span class="property-type">Object</span></dt><dd>Key/Value pair of attributes to update. The key should be a string and the value can be a [string | number | boolean | object]</dd><dt>Input Override<span class="property-type">string</span></dt><ul><li>Values: <code>accept | merge | block</code></li></ul><dd>Determine how input values will be handled. When merge is selected the message object values will override the configuration values.</dd><dt>Resend state and attributes<span class="property-type">boolean</span></dt><dd>When creating the entity in Home Assistant this will also send the last updated state and attributes then node sent to Home Assistant</dd></dl><h3>Switch Configuration</h3><dl class="message-properties"><dt>Output on state change<span class="property-type">boolean</span></dt><dd>When the state of the switch changes it will output to the top if the switch is on or to the bottom if it is in the off position.</dd><dt>Payload<span class="property-type">str | num | bool | JSONata | timestamp</span></dt><dd>Customizable output set to <code>msg.payload</code> if <code>Output on state change</code> is enabled.</dd></dl><h3>Sensors Inputs</h3><dl class="message-properties"><dd>properties of <code>msg.payload</code></dd><dt>state<span class="property-type">string | number | boolean</span></dt><dd>The state the entity should be updated to</dd><dt>attributes<span class="property-type">Object</span></dt><dd>Key/Value pair of attributes to update. The key should be a string and the value can be a <code>[string | number | boolean | object]</code></dd></dl><h3>Switch Inputs</h3><dl class="message-properties"><dt>msg.enable<span class="property-type">boolean</span></dt><dd>Set to <code>true</code> to turn on the switch and <code>false</code> to turn off. If the message has a property <code>enable</code> set to the type <code>boolean</code> the node will not have any output.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd><strong>Status Color</strong></dd><ul><li>Green/Red: output from the node was due to input to the node</li><li>Blue: output from the node was due to the state of the node changing</li><li>Yellow: state of node changed but no output</li></ul></dl></script>
<script type="text/html" data-help-name="server-events"><p>Listens for all types of events from Home Assistant with the ability to filter by event type.</p><h3>Configuration</h3><dl class="message-properties"><dt>Name<span class="property-type">string</span></dt><dd>the name of the node</dd><dt>Event Type<span class="property-type">string</span></dt><dd>filter by event type or leave blank for all events</dd><div class="home-assistant-custom-block danger"><p class="custom-block-title">WARNING</p><p>Leaving this empty will listen for all events from Home Assistant which may overload the WebSocket message queue.</p><p><a href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/issues/153#issuecomment-539290950">GitHub Issue #153</a></p></div><dt>Event data<span class="property-type">json</span></dt><dd>A JSON object that will be compared to the event data. If this JSON is a subset of the event data object, the event will be emitted.</dd><dt>Output only after Home Assistant is running<span class="property-type">boolean</span></dt><dd>What until Home Assistant has reported its state as <code>running</code> before outputting events. Client events will always output.</dd><dt>Expose to Home Assistant<span class="property-type">boolean</span></dt><dd>Creates a switch within Home Assistant to enable/disable this node. This feature requires <a href="https://github.com/zachowj/hass-node-red">Node-RED custom integration</a> to be installed in Home Assistant</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>event data</code>: event received from Home Assistant</li><li><code>config</code>: config properties of the node</li></ul></dl><h3>Client Events</h3><dl class="message-properties"><dd>Use <code>home_assistant_client</code> as the event type to receive events from the Websocket client.</dd><dd>Events sent from the client:</dd><ul><li><strong>connecting</strong> - when trying to connect to HA</li><li><strong>connected</strong> - after the authorization has been accepted</li><li><strong>disconnected</strong> - when the socket stops attempting to connect or disconnected after having been connected</li><li><strong>error</strong> - when a disconnect happens of the WebSocket with an error</li><li><strong>states_loaded</strong> - the first time all states are loaded from HA</li><li><strong>services_loaded</strong> - the first time all services are loaded from HA</li><li><strong>running</strong> - when HA is in a running state and states have been loaded</li></ul></dl></script>
<script type="text/html" data-help-name="server-state-changed"><p>Outputs state_changed event types sent from Home Assistant</p><p>The autocomplete will open to allow easier selection in the case you want a specific entity however the actual match is a substring match so no validation is done</p><h3>Configuration:</h3><dl class="message-properties"><dt>Entity ID <span text="required" class="home-assistant-badge">required</span><span class="property-type">string|regex</span></dt><dd>matches for entity_id field</dd><dd>Custom ids can be inserted into the list by adding a <code>#</code> at the end of the id</dd><dt>Entity ID Filter Types <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Values: <code>exact|substring|regex</code></li><li>Default: <code>exact</code></li></ul><dd>Substring can be a comma-delimited list.</dd><dt>If State<span class="property-type">string</span></dt><dd>If the conditional is evaluated as true send the message to the first output otherwise send it to the second output. If blank there will only be one output.</dd><dd><strong>Also see:</strong></dd><ul><li><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/conditionals.html" rel="noopener noreferrer">Conditionals</a></li></ul><dt>For<span class="property-type">number</span></dt><dd>An amount of time an entity&apos;s state needs to be in that state before triggering.</dd><div class="home-assistant-custom-block warning"><p class="custom-block-title">WARNING</p><p>Output on Connect state changes will not start a timer.</p></div><dt>State Type<span class="property-type">string</span></dt><ul><li>Values: <code>string|number|boolean</code></li><li>Default: <code>string</code></li></ul><dd>Convert the state of the entity to the selected type. Boolean will be converted to true based on if the string is equal by default to (<code>y|yes|true|on|home|open</code>). Original value stored in msg.data.original_state</dd><dt>Ignore state change event<span class="property-type">boolean</span></dt><dd>A list of possible states that will be ignored.</dd><dt>Output on Connect<span class="property-type">boolean</span></dt><dd>Output once on startup/deploy</dd><dt>Expose to Home Assistant<span class="property-type">boolean</span></dt><dd>Creates a switch within Home Assistant to enable/disable this node. This feature requires <a href="https://github.com/zachowj/hass-node-red">Node-RED custom integration</a> to be installed in Home Assistant</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>event data</code>: full event object</li><li><code>entity id</code>: entity id of the triggered entity</li><li><code>entity state</code>: entity state of the triggered entity</li><li><code>config</code>: config properties of the node</li></ul></dl></script>
<script type="text/html" data-help-name="ha-fire-event"><p>Fire an event to Home Assistants event bus</p><h3>Configuration</h3><dl class="message-properties"><dt>Event <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><dd>Event name to fire</dd><dt>data<span class="property-type">Object</span></dt><dd>JSON object to pass along</dd></dl><h3>Inputs</h3><dl class="message-properties"><dd>If the incoming message has a <code>payload</code> property with <code>event</code> set it will override any config values if set. If the incoming message has a <code>payload.data</code> that is an object or parsable into an object these properties will be <strong>merged</strong> with any config values set. If the node has a property value in its config for <code>Merge Context</code> then the <code>flow</code> and <code>global</code> contexts will be checked for this property which should be an object that will also be merged into the data payload.</dd><dt>payload.event<span class="property-type">string</span></dt><dd>Event to fire</dd><dt>payload.data<span class="property-type">Object</span></dt><dd>Event data to send</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>payload.event_type<span class="property-type">string</span></dt><dd>Event Type that was fired</dd><dt>payload.data<span class="property-type">Object</span></dt><dd>The event <code>data</code> sent if one was used</dd></dl><h3>References</h3><dl class="message-properties"><dd><a href="https://developers.home-assistant.io/docs/en/dev_101_events.html#firing-events">Home Assistant Events</a></dd></dl></script>
<script type="text/html" data-help-name="ha-get-entities"><p>Get Entities based on search criteria</p><h3>Configuration</h3><dl class="message-properties"><dt>Search Criteria<span class="property-type"></span></dt><dd>All search criteria have to be true for an entity to be valid.</dd><dt>Property<span class="property-type"></span></dt><dd>Has autocompleted with all properties currently set on all loaded entities.</dd></dl><h3>Inputs</h3><dl class="message-properties"><dt>payload<span class="property-type">Object</span></dt><dd>Override config values by passing in a property with a valid value.</dd><ul><li>rules array<ul><li>property string</li><li>logic string</li><li>value string</li><li>valueType string</li></ul></li><li>outputType string</li><li>outputEmptyResults boolean</li><li>outputLocationType string</li><li>outputLocation string</li><li>outputResultscount number</li></ul></dl><h3>Outputs</h3><dl class="message-properties"><dt>Array<span class="property-type">Array</span></dt><dd>Sends an array of state objects from search criteria to the Output Location.</dd><dt>Count<span class="property-type">number</span></dt><dd>Return the total count of valid entities.</dd><dt>Random<span class="property-type">Object|Array</span></dt><dd>Return a random object or array from the available state objects to the Output Location. When <code>One Max Results</code> is selected it will return an object and when more than one is selected will always return an array of state objects.</dd><dt>Split<span class="property-type">msg</span></dt><dd>Sends a message for each state object. In the same format as if the split node was used.</dd></dl><h3>State Object Format</h3><dl class="message-properties"><dd>Sample output when the Output Type is an array:</dd><pre><code class="language-json">[
  {
    &quot;entity_id&quot;: &quot;light.kitchen&quot;,
    &quot;state&quot;: &quot;on&quot;,
    &quot;attributes&quot;: {
      &quot;brightness&quot;: 243,
      &quot;friendly_name&quot;: &quot;Kitchen Light&quot;,
      &quot;supported_features&quot;: 33,
      &quot;icon&quot;: &quot;mdi:light-switch&quot;
    },
    &quot;last_changed&quot;: &quot;2019-12-29T05:38:53.016984+00:00&quot;,
    &quot;last_updated&quot;: &quot;2019-12-29T05:38:53.016984+00:00&quot;,
    &quot;context&quot;: {
      &quot;id&quot;: &quot;6c16e348494c42fb8c8e8bda92b20fb2&quot;,
      &quot;parent_id&quot;: null,
      &quot;user_id&quot;: null
    },
    &quot;timeSinceChangedMs&quot;: 3466747
  }
]
</code></pre><dt>entity_id<span class="property-type">string</span></dt><dd>The entity to which this state belongs</dd><dt>state<span class="property-type">string</span></dt><dd>Main attribute state value, examples: &apos;on&apos;, &apos;off&apos;, &apos;home&apos;, &apos;open&apos;, &apos;closed&apos;, etc...</dd><dt>attributes<span class="property-type">Object</span></dt><dd>Supported attributes of state set by Home Assistant</dd><dt>last_changed<span class="property-type">string</span></dt><dd>ISO Date string of last time entity state changed</dd><dt>timeSinceChangedMs<span class="property-type">number</span></dt><dd>Milliseconds since last time entity state changed</dd><dt>last_updated<span class="property-type">string</span></dt><dd>ISO Date string of last time entity state was updated</dd><dt>context<span class="property-type">Object</span></dt><dd>Information on who/what changed the state of this object last.</dd></dl><h3>Examples</h3><dl class="message-properties"><div><p><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/node/get-entities.html#examples">link</a></p></div></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://home-assistant.io/docs/configuration/state_object/">Home Assistant State Objects</a></li></ul></dl></script>
<script type="text/html" data-help-name="api-get-history"><p>Fetches history from Home Assistant (all history for the past day by default)</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity ID<span class="property-type">string</span></dt><dd>Exact entity_id to fetch history for must be an exact match as is passed directly to the Home Assistant.</dd><dt>Entity ID Type<span class="property-type">string</span></dt><ul><li>Values: <code>is</code> | <code>includes</code></li><li>Default: <code>is</code></li></ul><dd><code>is</code> or <code>includes</code> depending on the match type.</dd><div class="home-assistant-custom-block warning"><p class="custom-block-title">WARNING</p><p><code>includes</code> fetches all history for the time period then filters according to the value, this will be less performant than exact <code>is</code> matching</p></div><dt>Start Date<span class="property-type">string</span></dt><ul><li>Values: ISO Format Date</li><li>Default: 24 hours prior</li></ul><dd>Date to start fetching history from. Will override the configuration if passed in</dd><dd><strong>Also See:</strong></dd><ul><li><a href="https://en.wikipedia.org/wiki/ISO_8601">https://en.wikipedia.org/wiki/ISO_8601</a></li></ul><dt>End Date<span class="property-type">string</span></dt><ul><li>Values: ISO Format Date</li><li>Default: 24 hours from start date</li></ul><dd>The end date to fetch history too. Will override the configuration if passed in</dd><dd><strong>Also See:</strong></dd><ul><li><a href="https://en.wikipedia.org/wiki/ISO_8601">https://en.wikipedia.org/wiki/ISO_8601</a></li></ul><dt>Use Relative Time<span class="property-type">boolean</span></dt><ul><li>Default: <code>false</code></li></ul><dd>A checkbox to use relative time or not.</dd><dt>In the Last<span class="property-type">string</span></dt><dd>A time string that will be parsed the following keywords into time values.</dd><dd>Example: <code>4h 30m</code> = The last 4 hours and 30 minutes</dd><pre><code>ms, milli, millisecond, milliseconds - will parse to milliseconds
s, sec, secs, second, seconds - will parse to seconds
m, min, mins, minute, minutes - will parse to minutes
h, hr, hrs, hour, hours - will parse to hours
d, day, days - will parse to days
w, week, weeks - will parse to weeks
mon, mth, mths, month, months - will parse to months
y, yr, yrs, year, years - will parse to years
</code></pre><dt>Flatten Results<span class="property-type"></span></dt><dd>Instead of returning the data from home assistant ( array for each entity_id ) return one flattened array of one item per history entry</dd><dt>Output Types<span class="property-type">string</span></dt><ul><li>Values: <code>array</code> | <code>split</code></li><li>Default: <code>array</code></li></ul></dl><h3>Inputs</h3><dl class="message-properties"><dd>All properties of <code>msg.payload</code></dd><dt>entity_id<span class="property-type">string</span></dt><ul><li>Alias: <code>msg.entityid</code> <span type="warning" text="deprecated" class="home-assistant-badge warning">deprecated</span></li></ul><dt>startdate<span class="property-type">string</span></dt><ul><li>Values: ISO Format Date</li><li>Alias: <code>msg.startdate</code> <span type="warning" text="deprecated" class="home-assistant-badge warning">deprecated</span></li></ul><dt>enddate<span class="property-type">string</span></dt><ul><li>Values: ISO Format Date</li><li>Alias: <code>msg.enddate</code> <span type="warning" text="deprecated" class="home-assistant-badge warning">deprecated</span></li></ul><dt>relativetime<span class="property-type">string</span></dt><ul><li>Alias: <code>msg.relativetime</code> <span type="warning" text="deprecated" class="home-assistant-badge warning">deprecated</span></li></ul><dd>If <code>relativetime</code> exists <code>startdate</code> and <code>enddate</code> will be ignored.</dd><dt>flatten<span class="property-type">boolean</span></dt><ul><li>Alias: <code>msg.flatten</code> <span type="warning" text="deprecated" class="home-assistant-badge warning">deprecated</span></li></ul></dl><h3>Outputs</h3><dl class="message-properties"><dt>payload<span class="property-type">array</span></dt><dd>The history returned by home-assistant, which is an array of arrays where each array entry contains history objects for one particular entity</dd><dt>startdate<span class="property-type">string</span></dt><dd>ISO date string used to fetch history</dd><dt>enddate<span class="property-type">string</span></dt><dd>ISO date string used to fetch history</dd><dt>entity_id<span class="property-type">string</span></dt><dd>The entity id string used during fetch history call</dd><dd>Example output of <code>msg</code>:</dd><pre><code class="language-json">{
  &quot;startdate&quot;: &quot;2020-01-11T16:41:31.086Z&quot;,
  &quot;enddate&quot;: &quot;2020-01-14T16:41:31.086Z&quot;,
  &quot;entityid&quot;: &quot;light.kitchen_light&quot;,
  &quot;payload&quot;: [
    {
      &quot;attributes&quot;: {
        &quot;friendly_name&quot;: &quot;Kitchen Light&quot;,
        &quot;icon&quot;: &quot;mdi:light-switch&quot;,
      },
      &quot;context&quot;: {
        &quot;id&quot;: &quot;850e510e36fb494c9abc79e01e897d54&quot;,
        &quot;parent_id&quot;: null,
        &quot;user_id&quot;: null
      },
      &quot;entity_id&quot;: &quot;light.kitchen_light&quot;,
      &quot;last_changed&quot;: &quot;2019-12-28T06:47:28.618000+00:00&quot;,
      &quot;last_updated&quot;: &quot;2019-12-28T06:47:28.618000+00:00&quot;,
      &quot;state&quot;: &quot;off&quot;
    },
    {
      &quot;attributes&quot;: {
        &quot;brightness&quot;: 28,
        &quot;friendly_name&quot;: &quot;Kitchen Light&quot;,
        &quot;icon&quot;: &quot;mdi:light-switch&quot;,
      },
      &quot;context&quot;: {
        &quot;id&quot;: &quot;4d4abe29f2bc43dab39101193f1fefe4&quot;,
        &quot;parent_id&quot;: null,
        &quot;user_id&quot;: null
      },
      &quot;entity_id&quot;: &quot;light.kitchen_light&quot;,
      &quot;last_changed&quot;: &quot;2019-12-28T07:48:11.514137+00:00&quot;,
      &quot;last_updated&quot;: &quot;2019-12-28T07:48:11.514137+00:00&quot;,
      &quot;state&quot;: &quot;on&quot;
    },
    ...
  ]
}
</code></pre></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://www.home-assistant.io/integrations/history">Home Assistant History Component</a></li><li><a href="https://developers.home-assistant.io/docs/en/external_api_rest.html#get-apihistoryperiodlttimestamp">Home Assistant API: /api/history/period</a></li></ul></dl></script>
<script type="text/html" data-help-name="poll-state"><p>Polls for the state at regular intervals, optionally also outputting at the start and when the state changes. Useful for either alert for non-communicating devices (time since change &gt; 1 day for example) or dashboard graphs with consistent interval charts</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity ID <span text="required" class="home-assistant-badge">required</span><span class="property-type"></span></dt><dd>The entity id of the entity to poll for.</dd><dt>Update Interval<span class="property-type">number</span></dt><dd>The amount of time between checking/sending updates.</dd><dt>If State<span class="property-type">string</span></dt><dd>If the conditional statement is evaluated as true send the message to the first output otherwise send it to the second output. If blank there will only be one output.</dd><dd><strong>Also see:</strong></dd><ul><li><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/conditionals.html" rel="noopener noreferrer">Conditionals</a></li></ul><dt>State Type<span class="property-type">string</span></dt><dd>Convert the state of the entity to the selected type. Boolean will be converted to true based on if the string is equal by default to (y|yes|true|on|home|open). Original value stored in msg.data.original_state</dd><dt>Output Initially<span class="property-type">boolean</span></dt><dd>Output once on startup/deploy then on each interval</dd><dt>Expose to Home Assistant<span class="property-type">boolean</span></dt><dd>Creates a switch within Home Assistant to enable/disable this node. This feature requires <a href="https://github.com/zachowj/hass-node-red">Node-RED custom integration</a> to be installed in Home Assistant</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>topic<span class="property-type">string</span></dt><dd>entity_id of changed entity</dd><dt>payload<span class="property-type">object</span></dt><dd>The last known state of the entity</dd><dt>data.timeSinceChanged<span class="property-type">string</span></dt><dd>Human readable format string of time since last updated, example &quot;1 hour ago&quot;</dd><dt>data.timeSinceChangedMs<span class="property-type">number</span></dt><dd>Number of milliseconds since last changed</dd></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://home-assistant.io/docs/configuration/state_object/">Home Assistant State Objects</a></li></ul></dl></script>
<script type="text/html" data-help-name="api-render-template"><p>Can either set the template in the node configuration or pass in the <code>msg.template</code> property of the incoming message. Passing template via <code>msg.template</code> will override the template string set in node configuration.</p><div class="home-assistant-custom-block tip"><p class="custom-block-title">NOTE:</p><p>The node will output any Home Assistant API errors for catching with the &apos;catch-all&apos; node</p></div><h3>Configuration</h3><dl class="message-properties"><dt>template<span class="property-type">string</span></dt><dd>Jinja template to be rendered, discarded if <code>msg.template</code> is provided via input msg</dd><dt>Template Location<span class="property-type"></span></dt><dd>Customizable location to output original template</dd><dt>Results<span class="property-type"></span></dt><dd>Customizable location to output rendered template</dd></dl><h3>Inputs</h3><dl class="message-properties"><dt>template<span class="property-type">string</span></dt><dd>Jinja template to be rendered</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>template<span class="property-type">string</span></dt><dd>The original template sent to Home Assistant for rendering</dd><dt>payload<span class="property-type">string</span></dt><dd>The rendered template</dd></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://home-assistant.io/docs/configuration/templating/">Home Assistant Template Docs</a></li><li><a href="http://jinja.pocoo.org/docs/dev/templates/">Jinja Docs</a></li></ul></dl></script>
<script type="text/html" data-help-name="ha-sensor"><div class="home-assistant-custom-block warning"><p class="custom-block-title">WARNING</p><p><em>Needs <a href="https://github.com/zachowj/hass-node-red">Custom Integration</a> installed in Home Assistant for this node to function</em></p></div><p>Creates a sensor in Home Assistant which can be manipulated from this node.</p><h3>Configuration</h3><dl class="message-properties"><dt>State <span text="required" class="home-assistant-badge">required</span><span class="property-type">string | number | boolean</span></dt><dd>The state the entity should be updated to</dd><dt>Attributes<span class="property-type">Object</span></dt><dd>Key/Value pair of attributes to update. The key should be a string and the value can be a [string | number | boolean | object]</dd><dt>Input Override<span class="property-type">string</span></dt><ul><li>Values: <code>accept | merge | block</code></li></ul><dd>Determine how input values will be handled. When merge is selected the message object values will override the configuration values.</dd><dt>Resend state and attributes<span class="property-type">boolean</span></dt><dd>When creating the entity in Home Assistant this will also send the last updated state and attributes then node sent to Home Assistant</dd></dl><h3>Inputs</h3><dl class="message-properties"><dd>properties of <code>msg.payload</code></dd><dt>state<span class="property-type">string | number | boolean</span></dt><dd>The state the entity should be updated to</dd><dt>attributes<span class="property-type">Object</span></dt><dd>Key/Value pair of attributes to update. The key should be a string and the value can be a <code>[string | number | boolean | object]</code></dd></dl></script>
<script type="text/html" data-help-name="ha-switch"><div class="home-assistant-custom-block warning"><p class="custom-block-title">WARNING</p><p><em>Needs <a href="https://github.com/zachowj/hass-node-red">Custom Integration</a> installed in Home Assistant for this node to function</em></p></div><p>Creates a switch in Home Assistant which can be manipulated from this node.</p><h3>Configuration</h3><dl class="message-properties"><dt>Enable input<span class="property-type"></span></dt><dd>Input is disabled by default. It can be enabled by checking this option.</dd><dt>Output on state change<span class="property-type">boolean</span></dt><dd>When the state of the switch changes it will output to the top if the switch is on or to the bottom if it is in the off position.</dd></dl><h3>Inputs</h3><dl class="message-properties"><dt>msg.enable<span class="property-type">boolean</span></dt><dd>Set to <code>true</code> to turn on the switch and <code>false</code> to turn it off. If the message has a property <code>enable</code> defined and set to a <code>boolean</code> the node will not have any output.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd><strong>Status Color</strong></dd><ul><li>Green/Red: output from the node was due to input to the node</li><li>Blue: output from the node was due to the state of the node changing</li><li>Yellow: state of node changed but no output</li></ul></dl><h3>Examples</h3><dl class="message-properties"><div><p><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/node/switch.html#examples">link</a></p></div></dl></script>
<script type="text/html" data-help-name="ha-tag"><p>Sends an output when Home Assistant receives a tag scanned event for a configured tag id.</p><h3>Configuration</h3><dl class="message-properties"><dt>Tags<span class="property-type">array</span></dt><dd>An array of tag ids to monitor for tag scanned events.</dd><dt>Devices<span class="property-type">array</span></dt><dd>An array of device ids to check when a configured tag is scanned.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>event data</code>: full event object</li><li><code>tag id</code>: tag id of the tag that was scanned.</li><li><code>config</code>: config properties of the node</li></ul><dt>event object<span class="property-type">object</span></dt><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>device_id</td><td>ID of the device that scanned the tag</td></tr><tr><td>tag_id</td><td>ID of the tag that was scanned</td></tr><tr><td>tag_name</td><td>Home Assistant name of the tag that was scanned</td></tr><tr><td>user_id</td><td>Home Assistant user ID on device that scanned the tag</td></tr></tbody></table></dl></script>
<script type="text/html" data-help-name="ha-time"><p>A node that can be scheduled to trigger at a future date and time from a Home Assistant entity.</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity Id<span class="property-type">string</span></dt><dd>A Home Assistant entity to be used when scheduling the node.</dd><dt>Property<span class="property-type">string</span></dt><dd>Which property of the entity to use to schedule the node.</dd><dd>The node will accept any date string that the javascript object accepts as a valid date. It will also accept a 24-hour time format with the seconds place optional.</dd><dd>examples:</dd><ul><li><code>2020-12-31T02:47:54.837Z</code></li><li><code>1609382842709</code></li><li><code>13:40</code></li><li><code>23:59:02</code></li></ul><dt>Offset<span class="property-type">number</span></dt><dd>A negative or positive number that will be added to the scheduled time.</dd><dt>Randomize time within the offset<span class="property-type">boolean</span></dt><dd>When selected the time to trigger will be random selected from the scheduled time to the +/- offset.</dd><dt>Payload<span class="property-type">string | number | boolean | object</span></dt><dd>The payload is fully customizable. The default will be a JSONata expression that outputs the entity state.</dd><dt>Repeat Daily<span class="property-type">boolean</span></dt><dd>If selected the node will only use the time portion of the date string to schedule the node and will trigger at that time each day. Otherwise, the node will only trigger once at the given day and time.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>topic<span class="property-type">string</span></dt><dd>The entity id in the configuration.</dd><dt>payload<span class="property-type">string | number | boolean | object</span></dt><dt>data<span class="property-type">object</span></dt><dd>The entity object of the entity in the configuration.</dd></dl></script>
<script type="text/html" data-help-name="trigger-state"><p>Much like the <code>State Changed Node</code> however, provides some advanced functionality around common automation use cases.</p><p>An advanced version of the <code>server:state-changed</code> node</p><!-- TODO: Needs a total rework --><h3>Configuration</h3><dl class="message-properties"><dt>Entity ID <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><dd>The id of an entity to use for the comparison.</dd><dd>Custom ids can be inserted into the list by adding a <code>#</code> at the end of the id</dd><dt>Entity ID Filter Types <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Values: <code>exact|list|substring|regex</code></li><li>Default: <code>exact</code></li></ul><dt>State Type<span class="property-type">string</span></dt><ul><li>Values: <code>string|number|boolean</code></li><li>Default: <code>string</code></li></ul><dd>Convert the state of the entity to the selected type. Boolean will be converted to true based on if the string is equal by default to (<code>y|yes|true|on|home|open</code>). Original value stored in msg.data.original_state</dd><dt>Conditions<span class="property-type"></span></dt><dd>This node has two default outputs &quot;allowed&quot; and &quot;blocked&quot;. If all the conditions are true the default message will be sent to the &quot;allowed&quot; output otherwise, it will be sent to the &quot;blocked&quot; output.</dd><dd><strong>See Also:</strong></dd><ul><li><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/conditionals.html" rel="noopener noreferrer">Conditionals</a></li></ul><dt>Custom Outputs<span class="property-type"></span></dt><dd>All the above conditions need to be true for any custom outputs to be sent, having zero conditions is a valid option. Each custom output can send the default message or a custom message. Also, each one can have its constraint on whether or not to be sent.</dd><dt>Output on connect<span class="property-type">boolean</span></dt><dd>Output once on startup/deployment.</dd><dt>Enable input<span class="property-type">boolean</span></dt><dd>Enable the input to be used to send a message to the node.</dd><dt>Output debug information<span class="property-type">boolean</span></dt><dd>Output debug information to the debug tab.</dd><dt>Expose to Home Assistant<span class="property-type">boolean</span></dt><dd>Expose the node to Home Assistant.</dd></dl><h3>Input</h3><dl class="message-properties"><dd>Input is disabled by default. It can be enabled using the <code>Enable Input</code> option. Input can be used to enable/disable the node or for testing.</dd><dt>Enable / Disable<span class="property-type">string</span></dt><dd>If the incoming payload or message is a string and equal to <code>enable</code> or <code>disable</code> then set the node accordingly. Saves over restarts.</dd></dl><h3>Output</h3><dl class="message-properties"><dt>topic<span class="property-type">string</span></dt><dd>The entity_id that triggered the node</dd><dt>payload<span class="property-type">string</span></dt><dd>The state as sent by home assistant</dd><dt>data<span class="property-type">object</span></dt><dd>The original home assistant event containing <code>entity_id</code> <code>new_state</code> and <code>old_state</code> properties</dd></dl><h3>Testing</h3><dl class="message-properties"><dd>To test automation without having to manually change the state in home assistant send an input <code>payload</code> as an object which contains <code>entity_id</code>, <code>new_state</code>, and <code>old_state</code> properties. This will trigger the node as if the event came from Home Assistant.</dd><pre><code class="language-json">{
  &quot;entity_id&quot;: &quot;test_entity&quot;,
  &quot;old_state&quot;: {
    &quot;state&quot;: &quot;on&quot;
  },
  &quot;new_state&quot;: {
    &quot;state&quot;: &quot;off&quot;
  }
}
</code></pre></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://home-assistant.io/docs/configuration/state_object">HA State Object</a></li></ul></dl></script>
<script type="text/html" data-help-name="ha-update-config"><p>This node allows you to update the Home Assistant configuration of a node from within a flow. This is useful if you want to change the configuration of a node based on the state of an entity or some other event.</p><h3>Configuration</h3><dl class="message-properties"><dt>Name<span class="property-type">string</span></dt><dd>A name for the node.</dd><dt>Server<span class="property-type">string</span></dt><dd>The node id of a <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/node/config-server.html" rel="noopener noreferrer">Server Config</a> node.</dd><dt>Entity Config<span class="property-type">string</span></dt><dd>The node id of an <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/node/entity-config.html" rel="noopener noreferrer">entity config</a>. This can be overridden by the <code>payload.id</code> property on the msg object.</dd></dl><h3>Inputs</h3><dl class="message-properties"><dd>All properties must be under <code>msg.payload</code> and will be ignored if not.</dd><dt>Example input<span class="property-type"></span></dt><dd>Example of the <code>msg.payload</code> object.</dd><pre><code class="language-json">{
  &quot;id&quot;: &quot;d9d27ac6b4ebf78f&quot;,
  &quot;icon&quot;: &quot;mdi:lightbulb&quot;,
  &quot;name&quot;: &quot;My Light&quot;,
  &quot;entityPicture&quot;: &quot;/local/images/my_light.png&quot;
}
</code></pre><dt>id<span class="property-type">string</span></dt><dd>The node id of an entity config.</dd><dt>icon<span class="property-type">string</span></dt><dd>The icon to use for the entity.</dd><dt>name<span class="property-type">string</span></dt><dd>The friendly name to use for the entity.</dd><dt>entityPicture<span class="property-type">string</span></dt><dd>The entity picture to use for the entity.</dd></dl><h3>Examples</h3><dl class="message-properties"><div><p><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/node/update-config.html#examples">link</a></p></div></dl>```</script>
<script type="text/html" data-help-name="ha-wait-until"><p>When an input is received the node will wait until the condition is met or the timeout occurs then will pass on the last received message. Any new input will reset the timeout timer.</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity ID <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>The id of an entity to use for the comparison.</dd><dd>Custom ids can be inserted into the list by adding a <code>#</code> at the end of the id</dd><dt>Entity ID Filter Types <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Values: <code>exact|list|substring|regex</code></li><li>Default: <code>exact</code></li></ul><dt>Wait Until <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><dd>The <code>property</code> field will be checked against the <code>value</code> field using the comparator.</dd><dt>Timeout<span class="property-type">number</span></dt><dd>The amount of time to wait for the condition to become true before deactivating the node and passing the message object to the second output. If the timeout is equal to zero the node will wait indefinitely for the condition to be met.</dd><dt>Entity Location<span class="property-type">string</span></dt><dd>The entity object can also be passed with the message object.</dd><dt>Check against the current state<span class="property-type">boolean</span></dt><dd>When an input is received it will check the comparator against the current state instead of waiting for a state change.</dd></dl><h3>Input</h3><dl class="message-properties"><dt>reset<span class="property-type"></span></dt><dd>If the received message has this property set to any value the node will be set to inactive and the timeout cleared.</dd><dt>payload<span class="property-type">object</span></dt><dd>Override config values by passing in a property with a valid value.</dd><ul><li><code>entity_id</code></li><li><code>entityId</code> <span type="warning" text="deprecated" class="home-assistant-badge warning">deprecated</span></li><li><code>entityIdFilterType</code></li><li><code>property</code></li><li><code>comparator</code></li><li><code>value</code></li><li><code>valueType</code></li><li><code>timeout</code></li><li><code>timeoutUnits</code></li><li><code>entityLocation</code></li><li><code>entityLocationType</code></li><li><code>checkCurrentState</code></li></ul></dl><h3>Output</h3><dl class="message-properties"><dd>Will output the last received message when the condition is true or the timeout occurs. If the condition becomes true the message will be passed to the first output. If the timeout passes the message will be sent to the second output.</dd></dl></script>
<script type="text/html" data-help-name="ha-webhook"><p>Outputs the data received from the created webhook in Home Assistant</p><div class="home-assistant-custom-block warning"><p class="custom-block-title">WARNING</p><p><em>Needs <a href="https://github.com/zachowj/hass-node-red">Custom Integration</a> installed in Home Assistant for this node to function</em></p></div><h3>Configuration</h3><dl class="message-properties"><dt>ID<span class="property-type">string</span></dt><dd>A string to be used for the webhook URL in Home Assistant.</dd><dt>Payload<span class="property-type">string</span></dt><dd>Customizable location for the webhook payload. Defaults to msg.payload</dd><dt>Headers<span class="property-type">number</span></dt><dd>Customizable location for the webhook request headers.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>received data</code>: The parsed body from the webhook request</li><li><code>trigger id</code>: webhook id</li><li><code>headers</code>: entity state of the triggered entity</li><li><code>params</code>: Query string parameters</li><li><code>config</code>: config properties of the node</li></ul></dl></script>
<script type="text/html" data-help-name="ha-zone"><p>Outputs when one of the configured entities enter or leaves one of the defined zones.</p><h3>Configuration</h3><dl class="message-properties"><dt>Entities<span class="property-type">array</span></dt><dd>An array of entity ids to monitor for zone changes.</dd><dt>Event<span class="property-type">string</span></dt><dd>Set when to check an entity. Either entering or leaving a zone.</dd><dt>Zones<span class="property-type">array</span></dt><dd>An array of zone ids to check when a configured entity updates.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>topic<span class="property-type">string</span></dt><dd>The entity id of the device/person that triggered the update.</dd><dt>payload<span class="property-type">string</span></dt><dd>The state of the device/person entity that triggered the update.</dd><dt>data<span class="property-type">object</span></dt><dd>The entity object of the device/person that triggered the update.</dd><dt>zones<span class="property-type">array</span></dt><dd>An array of zone entities where the device/person entity entered/left after an update of location.</dd></dl></script>